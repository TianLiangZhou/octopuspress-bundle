{"version":3,"file":"589.adad7808273df94b.js","mappings":"4KAAO,MAIMA,EAAwB,+FCkBzBC,gBAAgJA,SAAeA,kCAA3FA,yDAA4EA,gEASpJA,qBAAyDA,6EAASA,wBAAoB,GAAEA,wBAAEA,kCAQ1FA,gBAA8FA,SAAiBA,kCAAlFA,+BAAiEA,iDADhGA,6BACEA,sBACFA,wCAD6EA,6EA3BjFA,iBAA8E,YAA9EA,CAA8E,oBAE1DA,SAAeA,QAC/BA,wBACEA,SACFA,QACAA,0BAAgB,UAAhBA,CAAgB,UAENA,yBAAGA,QACTA,iBACEA,uBACFA,UAEFA,kBAAiD,WACzCA,0BAAGA,QACTA,iBAAMA,UAAkBA,YAG5BA,8BACEA,4BACAA,sBAEQA,qEAASA,gBAAiBC,sBAA2BA,oBAAsB,GACjFD,UACFA,UAEFA,oCAGFA,SAAU,6BA3BQA,uBAEdA,sCAMsDA,mCAK9CA,0BAICA,kCAEDA,sDAENA,gEAGoDA,mFAO5DA,mBAAS,oBACSA,oCAAIA,QACpBA,wBACEA,uBACFA,QACAA,6BAAuD,eACrBA,2DAASA,gBAAW,GAAEA,wBAAEA,QACxDA,qBAAkCA,gFAASA,gCAA4B,GAAEA,yBAAEA,WAAS,oCCvCnF,IAAME,EAAkB,MAAzB,MAAOA,EAMXC,YACUC,EACAC,EACAC,EACDC,GAHCC,YACAA,aACAA,aACDA,cARTA,aAAoB,GAEpBA,WAAgB,EAShB,CAEAC,WACED,KAAKE,aACLF,KAAKF,MAAMK,KAAKC,UAAWD,IACzBH,KAAKK,MAAQF,EAAKE,OAEtB,CAEQH,aACNF,KAAKJ,KAAKU,IFlC0B,qBEkCaF,UAAUG,IACrDA,EAAIC,QAAQC,OAAS,IACvBT,KAAKU,QAAUH,EAAIC,UAGzB,CAEAG,WAAWC,GACTZ,KAAKJ,KAAKiB,KFtC2B,4BEsCW,CAACD,KAAMA,IAAOR,UAAUG,IACtEP,KAAKE,YAAU,EAEnB,CAEAY,SAASF,GACPZ,KAAKJ,KAAKiB,KF7CyB,0BE6CW,CAACD,KAAMA,IAAOR,UAAUG,IACpEP,KAAKE,YAAU,EAEnB,CAEAa,OAAOC,GACDA,EAAMP,OAAS,EACjBT,KAAKH,MAAMoB,OAAO,yDAAa,4BAGjCjB,KAAKJ,KAAKiB,KAAmBtB,EAAe,CAAC2B,IAAKF,EAAMG,QAAQf,UAAUG,IACxEP,KAAKE,YAAU,EAEnB,CAEAkB,aAAaC,EAAaC,GACV,wGAAwGC,KAAKF,GAK3HrB,KAAKJ,KAAKiB,KAAmBtB,EAAe,CAAC2B,IAAKG,IAAMjB,UAAUG,IAChEe,EAAIE,QACJxB,KAAKE,YAAU,GALfF,KAAKH,MAAMoB,OAAQ,0CAAa,2BAOpC,CAEAQ,OAAOC,GACL1B,KAAKJ,KAAKiB,KF3EqB,sBE2EW,CAACD,KAAMc,IAAQtB,UAAUG,IACjEP,KAAKE,YAAU,EAEnB,+CApEWR,GAAkBiC,4EAAlBjC,EAAkBkC,slCDb/BpC,iBAAiB,UAAjBA,CAAiB,YAAjBA,CAAiB,qBAAjBA,CAAiB,UAIHA,sDAAOA,QACbA,iBAAoB,cAC4BA,2DAASA,uBAAsB,GAAEA,oCAAIA,QACnFA,wBAAYA,kCAAUqC,WAAc,GAA0CrC,gBAKtFA,yBA+BFA,QACAA,kDArCgDA,oCAAkB,oBAKEA,yHCCvDE,CAAkB,0CCDvBF,0DAAKA,oBAAsBA,gHAJjCA,iBAA8E,YAA9EA,CAA8E,oBAE1DA,SAAeA,QAC/BA,wBACEA,uBACFA,QACAA,4BAAmD,cACfA,qEAASA,uBAAmB,GAA8BA,SAAqCA,aAAS,6BAL5HA,uBAE6EA,+BAG3BA,qCAA4BA,2ECF7F,IAAMsC,EAAe,MAAtB,MAAOA,EAKXnC,YACUC,EACAC,EACAC,EACDiC,GAHC/B,YACAA,aACAA,aACDA,iBARTA,aAAoB,GAEpBA,WAAgB,EAShB,CACAC,WACED,KAAKE,aACLF,KAAKF,MAAMK,KAAKC,UAAWD,IACzBH,KAAKK,MAAQF,EAAKE,OAEtB,CAEQH,aACNF,KAAKJ,KAAKU,IJlCuB,kBIkCaF,UAAUG,IAClDA,EAAIC,QAAQC,OAAS,IACvBT,KAAKU,QAAUH,EAAIC,UAGzB,CAEAwB,MAAMpB,GACJZ,KAAKJ,KAAKiB,KJzCsB,uBIyCW,CAACD,KAAMA,IAAOR,UAAUG,IACjEP,KAAKE,YAAU,EAEnB,+CAhCW4B,GAAeH,2EAAfG,EAAeF,gYDb5BpC,iBAAiB,UAAjBA,CAAiB,YAAjBA,CAAiB,oBAITA,sCACFA,YAGJA,uBAWFA,eAXoEA,+GCKvDsC,CAAe,yFCJZtC,kCAGiBA,2DAAUA,iBAAQ,EAAlBA,CAAmB,oDACXA,gBAAY,EADpBA,CAAmB,sDAETA,kBAAc,GACzCA,iDALiBA,gCAA6B,gDAYxCA,qBAAgGA,SAAwBA,yCAAxBA,2EANtGA,kBAAoFA,6FAAUA,qCAAgC,GAC5HA,gCACAA,kBACEA,oBACAA,eAA0E,eACiDA,SAAyBA,QAClJA,2BACFA,WAAM,4DAPJA,8BAA2B,4BACZA,6CAAiC,sBAAjCA,CAAiC,4BAC/CA,qDACIA,iEACFA,kEACmCA,uEAAmFA,mCACnFA,8DAfhDA,oBACEA,WACEA,wCAOAA,yBAUFA,QACFA,4CApBgDA,0BAAsB,aAAtBA,CAAsB,cACtDA,uCACWA,uCAOYA,gEAVzCA,qBACEA,0BAqBFA,8BArB0BA,0EAsB1BA,kCAGGA,0DAAUA,iBAAQ,EAAlBA,CAAmB,mDACXA,gBAAY,EADpBA,CAAmB,qDAETA,kBAAc,GAC3BA,gCALGA,gCAA6B,gDAY1BA,qBAAiGA,SAAyBA,+BAAzBA,4EANvGA,kBAAqFA,0DAAUA,eAAO,EAACyC,oBAAyB,GAC9HzC,gCACAA,kBACEA,oBACAA,eAA2E,eACiDA,SAA0BA,QACpJA,2BACFA,WAAM,yBAPJA,8BAA4B,4BACbA,6CAAkC,sBAAlCA,CAAkC,4BAChDA,qDACIA,iEACFA,kEACmCA,uEAAoFA,mCACpFA,qCC3B/C,IAAM0C,GAAgB,MAAvB,MAAOA,EAmBXvC,YACUC,EACAC,EACAC,GAFAE,YACAA,aACAA,aApBVA,WAAgB,GAEhBA,eAAoB,GAEpBA,UAAkB,GAKlBA,cAAuB,GACvBA,YAA6B,GAG7BA,eAAyB,EAUzB,CAEAC,WACED,KAAKF,MAAMqC,SAAS/B,UAAU+B,YAC5B,IAAIC,EAAmC,QAAtBC,IAAS/B,IAAI,iBAAS,QAAI,GACvCgC,EAA8B,QAApBC,IAASjC,IAAI,eAAO,QAAI,GACtCN,KAAKJ,KAAKU,INvCsB,oBMuCkB,CAACkC,OAAQ,CAAC5B,KAAMwB,EAAYE,QAASA,KACpFlC,UAAUG,UAGT,OAFAP,KAAKK,MAAQE,EAAIF,MACjBL,KAAKyC,UAAYlC,EAAIkC,UACbzC,KAAKyC,WACX,IAAK,OACHzC,KAAK0C,KAAOnC,EAAImC,KAChB1C,KAAK0C,KAAKC,QAAQ,CAACC,EAAKC,aACD,SAAjBD,EAAIH,WACNzC,KAAK8C,OAAOD,GAAS7C,KAAK+C,UAAmB,QAATV,IAAIW,aAAK,eAAEF,QAC/C9C,KAAKiD,SAASJ,GAAS7C,KAAKkD,YAAYN,EAAII,QAE5ChD,KAAKmD,UAAUN,IAAK,EAAIO,KAAuB,QAARb,IAAIc,YAAI,eAAEC,SAAS,GAG9D,MACF,IAAK,OACHtD,KAAKmD,UAAU,IAAC,EAAIC,KAAwB,QAATf,OAAKgB,YAAI,eAAEC,UAC9CtD,KAAKqD,KAAO9C,EAAI8C,KAChB,MACF,IAAK,QACHrD,KAAKgD,MAAQzC,EAAIyC,MACjBhD,KAAK8C,OAAO,GAAK9C,KAAK+C,UAAU/C,KAAKgD,MAAMF,QAC3C9C,KAAKiD,SAAS,GAAKjD,KAAKkD,YAAYlD,KAAKgD,OACnC,EAEX,EAEP,CAEAO,SAEA,CAEAC,KAAKC,GAEL,CAEAC,OAAOD,GAEP,CAEAP,YAAYF,GACV,MAAO,CACLW,QAAS,CACPC,SAAU,QACVC,IAAKb,EAAMW,QAAQJ,OACnBC,KAAMR,EAAMW,QAAQH,KACpBE,OAAQV,EAAMW,QAAQD,OACtBI,YAAa,gBAEfD,IAAK,CACHE,iBAAkB,0BAClBC,oBAAqB,+BACrBC,oBAAqB,4BAEvBT,KAAM,CACJU,kBAAmB,0BACnBC,kBAAmB,+BACnBF,oBAAqB,4BAEvBP,OAAQ,CACNU,oBAAqB,2BACrBC,eAAe,GAEjBC,MAAO,CACLC,QAAS,IAEXC,KAAM,WACNC,QAASzB,EAAMyB,QAEnB,CAEA1B,UAAU2B,GACR,OAAO,IAAIC,KAAiB3E,KAAKJ,KAAM,CACrCgF,SAAUF,EACVG,QAAS,UACTC,SAAU,QACVC,aAAc,OACdC,cAAe,QACfC,eAAgB,WAEpB,CAGAC,OAAOrC,EAAesC,GAChBnF,KAAKmD,UAAUN,GAAOuC,SAG1BpF,KAAKJ,KAAKiB,KAAKsE,EAAMnF,KAAKmD,UAAUN,GAAOwC,OAAOjF,UAAUG,MAG9D,+CA3HW2B,GAAgBP,+DAAhBO,EAAgBN,m0BDf7BpC,iBAAiB,UAAjBA,CAAiB,YAAjBA,CAAiB,oBAGKA,SAASA,QACzBA,wBACEA,WACEA,6BAuBAA,wCAOAA,0BAUFA,QACFA,qBA5CgBA,wBAEAA,uCACAA,sCAuBWA,uCAOaA,8JCrBjC0C,CAAgB,oBCF7B,MAAMoD,GAAiB,CACrB,CACEC,KAAM,SACNlF,MAAO,2BACPmF,UAAW1D,GAEb,CACEyD,KAAM,YACNlF,MAAO,iCACPmF,UAAW9F,GAEb,CACE6F,KAAM,gBACNC,UAAWtD,KAkBR,IAAMuD,GAAY,MAAnB,MAAOA,kDAAY,0BAAZA,gCATTC,KACAC,cAAsBL,IACtBM,IACAC,IACAC,MACAC,KACAC,QAGSP,CAAY","names":["PLUGIN_UPLOAD","i0","ctx_r14","InstalledComponent","constructor","http","toast","route","dialog","this","ngOnInit","getPlugins","data","subscribe","title","get","res","records","length","plugins","inactivate","name","post","activate","upload","files","danger","uri","pop","openDownload","url","ref","test","close","remove","alias","core","selectors","ctx","MarketComponent","sanitizer","setup","ctx_r24","FeatureComponent","paramMap","pluginName","_a","feature","_b","params","container","tabs","forEach","tab","index","source","getSource","table","settings","getSettings","formGroup","buildFormGroup","form","controls","create","edit","$event","delete","actions","position","add","columnTitle","addButtonContent","createButtonContent","cancelButtonContent","editButtonContent","saveButtonContent","deleteButtonContent","confirmDelete","pager","perPage","mode","columns","endpoint","ServerDataSource","endPoint","dataKey","totalKey","pagerPageKey","pagerLimitKey","filterFieldKey","submit","link","invalid","value","routes","path","component","PluginModule","CommonModule","RouterModule","ThemeModule","UploadModule","NbListModule","Angular2SmartTableModule","ControlModule"],"sourceRoot":"webpack:///","sources":["./dashboard/app/@core/definition/plugin/api.ts","./dashboard/app/pages/plugin/installed/installed.component.html","./dashboard/app/pages/plugin/installed/installed.component.ts","./dashboard/app/pages/plugin/market/market.component.html","./dashboard/app/pages/plugin/market/market.component.ts","./dashboard/app/pages/plugin/feature/feature.component.html","./dashboard/app/pages/plugin/feature/feature.component.ts","./dashboard/app/pages/plugin/plugin.module.ts"],"sourcesContent":["export const PLUGIN_MARKET: string = \"/plugin/market\";\nexport const PLUGIN_SETUP: string = \"/plugin/{name}/setup\";\nexport const PLUGIN_INSTALLED: string = \"/plugin/installed\";\nexport const PLUGIN_DOWN: string = \"/plugin/{name}/down\";\nexport const PLUGIN_UPLOAD: string = \"/plugin/upload\";\nexport const PLUGIN_ACTIVATE: string = \"/plugin/{name}/activate\";\nexport const PLUGIN_DEACTIVATE: string = \"/plugin/{name}/deactivate\";\nexport const PLUGIN_FEATURE: string = \"/{name}/{feature}\";\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header class=\"d-flex justify-content-between align-items-center\">\n        <span>已安装插件列表</span>\n        <div class=\"d-flex\">\n          <button nbButton class=\"me-2\" status=\"danger\" (click)=\"dialog.open(dialogTpl)\">在线下载</button>\n          <app-upload (finish)=\"upload($event)\" [suffix]=\"['zip']\" [status]=\"'primary'\"></app-upload>\n        </div>\n      </nb-card-header>\n    </nb-card>\n  </div>\n  <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\" *ngFor=\"let plugin of plugins\">\n    <nb-card>\n      <nb-card-header>{{plugin.name}}</nb-card-header>\n      <nb-card-body>\n        {{plugin.description}}\n      </nb-card-body>\n      <nb-card-footer>\n        <div class=\"d-flex py-3 justify-content-between\">\n          <span>作者:</span>\n          <span>\n            <a class=\"d-inline-block mr-1\" *ngFor=\"let author of plugin.author\" [href]=\"author.homepage ? author.homepage : 'javascript:;'\" target=\"_blank\">{{author.name}}</a>\n          </span>\n        </div>\n        <div class=\"d-flex py-3 justify-content-between\">\n          <span>版本:</span>\n          <span>{{plugin.version}}</span>\n        </div>\n      </nb-card-footer>\n      <nb-card-footer class=\"d-flex justify-content-between\">\n        <button *ngIf=\"!plugin.enabled\" nbButton status=\"danger\" (click)=\"remove(plugin.alias)\">移除</button>\n        <button nbButton\n                [status]=\"plugin.enabled ? 'danger' : 'primary'\"\n                (click)=\"plugin.enabled ? inactivate(plugin.alias) : activate(plugin.alias)\">\n          {{ plugin.enabled ? '禁用' : '启用' }}\n        </button>\n      </nb-card-footer>\n      <nb-card-footer class=\"d-flex justify-content-between\" *ngIf=\"plugin.actions.length > 0\">\n        <a nbButton status=\"primary\" [href]=\"'#' + action.link\" *ngFor=\"let action of plugin.actions\">{{ action.name }}</a>\n      </nb-card-footer>\n    </nb-card>\n  </div>\n</div>\n<ng-template #dialogTpl let-data let-ref=\"dialogRef\">\n  <nb-card>\n    <nb-card-header>在线下载</nb-card-header>\n    <nb-card-body>\n      <input nbInput name=\"url\" type=\"url\" #url placeholder=\"下载地址\" />\n    </nb-card-body>\n    <nb-card-footer class=\"d-flex justify-content-between\">\n      <button nbButton status=\"basic\" (click)=\"ref.close()\">取消</button>\n      <button nbButton status=\"primary\" (click)=\"openDownload(url.value, ref)\">下载</button>\n    </nb-card-footer>\n  </nb-card>\n</ng-template>\n\n","import { Component, OnInit } from '@angular/core';\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {Records, ResponseBody} from \"../../../@core/definition/common\";\nimport {Plugin} from \"../../../@core/definition/plugin/type\";\nimport {PLUGIN_ACTIVATE, PLUGIN_DOWN, PLUGIN_DEACTIVATE, PLUGIN_INSTALLED, PLUGIN_UPLOAD} from \"../../../@core/definition/plugin/api\";\nimport {NbDialogService, NbToastrService} from \"@nebular/theme\";\nimport {DialogRef} from \"@angular/cdk/dialog\";\n\n@Component({\n  selector: 'app-plugin-installed',\n  templateUrl: './installed.component.html',\n})\nexport class InstalledComponent implements OnInit {\n\n  plugins: Plugin[] = [];\n\n  title: string = \"\";\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n    public dialog: NbDialogService,\n  ) {\n\n  }\n\n  ngOnInit(): void {\n    this.getPlugins();\n    this.route.data.subscribe((data) => {\n      this.title = data['title'];\n    });\n  }\n\n  private getPlugins() {\n    this.http.get<Records<Plugin>>(PLUGIN_INSTALLED).subscribe(res => {\n      if (res.records.length > 0) {\n        this.plugins = res.records\n      }\n    });\n  }\n\n  inactivate(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_DEACTIVATE, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n\n  activate(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_ACTIVATE, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n\n  upload(files: string[]) {\n    if (files.length < 1) {\n      this.toast.danger('上传的插件文件为空', '上传插件');\n      return ;\n    }\n    this.http.post<ResponseBody>(PLUGIN_UPLOAD, {uri: files.pop()}).subscribe(res => {\n      this.getPlugins()\n    });\n  }\n\n  openDownload(url: string, ref: DialogRef) {\n    let isMatch = /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/.test(url);\n    if (!isMatch) {\n      this.toast.danger( '不合法的url链接', '在线下载');\n      return\n    }\n    this.http.post<ResponseBody>(PLUGIN_UPLOAD, {uri: url}).subscribe(res => {\n      ref.close();\n      this.getPlugins()\n    });\n  }\n\n  remove(alias: string) {\n    this.http.post<ResponseBody>(PLUGIN_DOWN, {name: alias}).subscribe(res => {\n      this.getPlugins()\n    });\n  }\n}\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header>\n        插件市场\n      </nb-card-header>\n    </nb-card>\n  </div>\n  <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\" *ngFor=\"let plugin of plugins\">\n    <nb-card>\n      <nb-card-header>{{plugin.name}}</nb-card-header>\n      <nb-card-body>\n        <img alt=\"{{plugin.name}}\" [src]=\"sanitizer.bypassSecurityTrustResourceUrl(plugin.image)\" *ngIf=\"plugin.image\" width=\"100%\"/>\n      </nb-card-body>\n      <nb-card-footer class=\"d-flex justify-content-end\">\n        <button nbButton status=\"primary\" (click)=\"setup(plugin.alias)\" [disabled]=\"plugin.enabled\">{{ plugin.enabled ? '已安装' : '现在安装' }}</button>\n      </nb-card-footer>\n    </nb-card>\n  </div>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport {Records, ResponseBody} from \"../../../@core/definition/common\";\nimport {Plugin} from \"../../../@core/definition/plugin/type\";\nimport {PLUGIN_MARKET, PLUGIN_SETUP} from \"../../../@core/definition/plugin/api\";\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {NbToastrService} from \"@nebular/theme\";\n\n@Component({\n  selector: 'app-plugin-market',\n  templateUrl: './market.component.html',\n})\nexport class MarketComponent implements OnInit {\n  plugins: Plugin[] = [];\n\n  title: string = \"\";\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n    public sanitizer: DomSanitizer\n  ) {\n\n  }\n  ngOnInit(): void {\n    this.getPlugins();\n    this.route.data.subscribe((data) => {\n      this.title = data['title'];\n    });\n  }\n\n  private getPlugins() {\n    this.http.get<Records<Plugin>>(PLUGIN_MARKET).subscribe(res => {\n      if (res.records.length > 0) {\n        this.plugins = res.records\n      }\n    });\n  }\n\n  setup(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_SETUP, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n}\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header>{{title}}</nb-card-header>\n      <nb-card-body>\n        <ng-container [ngSwitch]=\"this.container\">\n          <nb-tabset *ngSwitchCase=\"'tabs'\">\n            <nb-tab *ngFor=\"let tab of tabs; let i = index\" [tabTitle]=\"tab.title\" [tabIndex]=\"i\" [tabId]=\"''+i\">\n              <ng-container [ngSwitch]=\"tab.container\">\n                <angular2-smart-table *ngSwitchCase=\"'table'\"\n                                 [settings]=\"this.settings[i]\"\n                                 [source]=\"this.source[i]\"\n                                 (create)=\"create()\"\n                                 (edit)=\"edit($event)\"\n                                 (delete)=\"delete($event)\">\n                </angular2-smart-table>\n                <form [ngClass]=\"tab.form!.class\" *ngSwitchCase=\"'form'\" [formGroup]=\"formGroup[i]\" (submit)=\"submit(i, tab.form!.submit.link)\">\n                  <control-container [direction]=\"tab.form!.direction\" [form]=\"formGroup[i]\" [controls]=\"tab.form!.controls\"></control-container>\n                  <div [class]=\"tab.form!.direction !== 'column' ? 'row' : ''\"  class=\"form-group\">\n                    <label [class]=\"tab.form!.direction !== 'column' ? 'col-12 col-md-2' : ''\" class=\"label col-form-label\"></label>\n                    <div [class]=\"tab.form!.direction !== 'column' ? 'col-12 col-md-10' : ''\">\n                      <button status=\"primary\" size=\"small\" [disabled]=\"tab.form!.submit.valid && formGroup[i].invalid\" nbButton type=\"submit\">{{tab.form!.submit.name}}</button>\n                      <button status=\"danger\" class=\"ms-2\" *ngIf=\"tab.form!.reset\" size=\"small\" type=\"reset\" nbButton>{{tab.form!.reset.name}}</button>\n                    </div>\n                  </div>\n                </form>\n              </ng-container>\n            </nb-tab>\n          </nb-tabset>\n          <angular2-smart-table *ngSwitchCase=\"'table'\"\n             [settings]=\"this.settings[0]\"\n             [source]=\"this.source[0]\"\n             (create)=\"create()\"\n             (edit)=\"edit($event)\"\n             (delete)=\"delete($event)\">\n          </angular2-smart-table>\n          <form [ngClass]=\"this.form!.class\" *ngSwitchCase=\"'form'\" [formGroup]=\"formGroup[0]\" (submit)=\"submit(0, this.form!.submit.link)\">\n            <control-container [direction]=\"this.form!.direction\" [form]=\"formGroup[0]\" [controls]=\"this.form!.controls\"></control-container>\n            <div [class]=\"this.form!.direction !== 'column' ? 'row' : ''\" class=\"form-group\">\n              <label [class]=\"this.form!.direction !== 'column' ? 'col-12 col-md-2' : ''\" class=\"label col-form-label\"></label>\n              <div [class]=\"this.form!.direction !== 'column' ? 'col-12 col-md-10' : ''\">\n                <button status=\"primary\" size=\"small\" [disabled]=\"this.form!.submit.valid && formGroup[0].invalid\" type=\"submit\" nbButton>{{this.form!.submit.name}}</button>\n                <button status=\"danger\" class=\"ms-2\" *ngIf=\"this.form!.reset\" size=\"small\" type=\"reset\" nbButton>{{this.form!.reset.name}}</button>\n              </div>\n            </div>\n          </form>\n        </ng-container>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n\n","import { Component, OnInit } from '@angular/core';\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {PLUGIN_FEATURE} from \"../../../@core/definition/plugin/api\";\nimport {PluginDrawResponse, DrawTab, DrawTable, DrawForm} from \"../../../@core/definition/plugin/type\";\nimport {buildFormGroup} from \"../../../shared/control/type\";\nimport {FormGroup} from \"@angular/forms\";\nimport {NbToastrService} from \"@nebular/theme\";\nimport {ServerDataSource} from \"angular2-smart-table\";\nimport {Settings} from \"angular2-smart-table/lib/lib/settings\";\n\n@Component({\n  selector: 'app-plugin-feature',\n  templateUrl: './feature.component.html',\n})\nexport class FeatureComponent implements OnInit {\n\n  title: string = \"\";\n\n  container: string = \"\";\n\n  tabs: DrawTab[] = [];\n\n  form: DrawForm | undefined;\n\n  table: DrawTable | undefined;\n  settings: Settings[] = []\n  source: ServerDataSource[] = [];\n\n\n  formGroup: FormGroup[] = [];\n\n\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n  ) {\n\n  }\n\n  ngOnInit(): void {\n    this.route.paramMap.subscribe(paramMap => {\n      let pluginName = paramMap.get('plugin') ?? '';\n      let feature = paramMap.get('page') ?? '';\n      this.http.get<PluginDrawResponse>(PLUGIN_FEATURE, {params: {name: pluginName, feature: feature}})\n        .subscribe(res => {\n          this.title = res.title;\n          this.container = res.container;\n          switch (this.container) {\n            case 'tabs':\n              this.tabs = res.tabs!;\n              this.tabs.forEach((tab, index) => {\n                if (tab.container == 'table') {\n                  this.source[index] = this.getSource(tab.table?.source!);\n                  this.settings[index] = this.getSettings(tab.table!);\n                } else {\n                  this.formGroup[index] = buildFormGroup(tab.form?.controls!);\n                }\n              });\n              break;\n            case 'form':\n              this.formGroup[0] = buildFormGroup(this.form?.controls!)\n              this.form = res.form;\n              break;\n            case 'table':\n              this.table = res.table!;\n              this.source[0] = this.getSource(this.table.source);\n              this.settings[0] = this.getSettings(this.table);\n              break;\n          }\n        });\n    });\n  }\n\n  create() {\n\n  }\n\n  edit($event: any) {\n\n  }\n\n  delete($event: any) {\n\n  }\n\n  getSettings(table: DrawTable): Settings {\n    return {\n      actions: {\n        position: 'right',\n        add: table.actions.create,\n        edit: table.actions.edit,\n        delete: table.actions.delete,\n        columnTitle: '操作',\n      },\n      add: {\n        addButtonContent: '<i class=\"nb-plus\"></i>',\n        createButtonContent: '<i class=\"nb-checkmark\"></i>',\n        cancelButtonContent: '<i class=\"nb-close\"></i>',\n      },\n      edit: {\n        editButtonContent: '<i class=\"nb-edit\"></i>',\n        saveButtonContent: '<i class=\"nb-checkmark\"></i>',\n        cancelButtonContent: '<i class=\"nb-close\"></i>',\n      },\n      delete: {\n        deleteButtonContent: '<i class=\"nb-trash\"></i>',\n        confirmDelete: true,\n      },\n      pager: {\n        perPage: 30,\n      },\n      mode: 'external',\n      columns: table.columns,\n    };\n  }\n\n  getSource(endpoint: string) {\n    return new ServerDataSource(this.http, {\n      endPoint: endpoint,\n      dataKey: 'records',\n      totalKey: 'total',\n      pagerPageKey: 'page',\n      pagerLimitKey: 'limit',\n      filterFieldKey: '#field#',\n    });\n  }\n\n\n  submit(index: number, link: string) {\n    if (this.formGroup[index].invalid) {\n      return ;\n    }\n    this.http.post(link, this.formGroup[index].value).subscribe(res => {\n\n    });\n  }\n}\n","import {NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\n\nimport {ThemeModule} from \"../../@theme/theme.module\";\nimport {UploadModule} from \"../../shared/upload/upload.module\";\nimport {InstalledComponent} from \"./installed/installed.component\";\nimport {MarketComponent} from \"./market/market.component\";\nimport {NbListModule} from \"@nebular/theme\";\nimport {FeatureComponent} from \"./feature/feature.component\";\nimport {ControlModule} from \"../../shared/control/control.module\";\nimport {Angular2SmartTableModule} from \"angular2-smart-table\";\nimport {RouterModule, Routes} from \"@angular/router\";\n\nconst routes: Routes = [\n  {\n    path: \"market\",\n    title: '插件市场',\n    component: MarketComponent,\n  },\n  {\n    path: \"installed\",\n    title: '已安装插件',\n    component: InstalledComponent,\n  },\n  {\n    path: \":plugin/:page\",\n    component: FeatureComponent,\n  },\n];\n\n@NgModule({\n  declarations: [\n    InstalledComponent, MarketComponent, FeatureComponent,\n  ],\n  imports: [\n    CommonModule,\n    RouterModule.forChild(routes),\n    ThemeModule,\n    UploadModule,\n    NbListModule,\n    Angular2SmartTableModule,\n    ControlModule,\n  ]\n})\nexport class PluginModule {\n}\n"],"x_google_ignoreList":[]}