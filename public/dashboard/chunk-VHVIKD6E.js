import{c as b,d as y,w as j,x as k,y as T}from"./chunk-QJO7QQNE.js";import{$b as v,D as u,J as m,M as l,Mb as f,P as r,Qb as p,Rb as d,Sb as S,ye as g}from"./chunk-J7X6RXHA.js";var R=new f(()=>{}),W=(()=>{class o{constructor(t,a,s,h,i,n){this.router=t,this.authService=a,this.sharedService=s,this.toastService=h,this.menuService=i,this.tokenService=n,this.token="",this.authService.onTokenChange().subscribe(e=>{this.token=e.toString()})}intercept(t,a){let s=t.url.startsWith("http")||t.url.startsWith("/authorize/")?t.url:j.gateway+t.url,h=s.matchAll(new RegExp("{([a-zA-Z]+)}","g")),i=s;for(let e of h)e.length===2&&(t.body&&t.body.hasOwnProperty(e[1])?i=i.replace(e[0],t.body[e[1]]):t.params&&t.params.has(e[1])&&(i=i.replace(e[0],t.params.get(e[1])||e[0])));t=t.clone({url:i,withCredentials:!1,setHeaders:{"X-Requested-With":"XMLHttpRequest",Authorization:this.token},responseType:"json"});let n=t.context.get(R);return n!==void 0?n.onSpinner(!0):this.sharedService.loading(!0),a.handle(t).pipe(u(()=>{n?n.onSpinner(!1):this.sharedService.loading(!1)}),m({error:e=>{if(!(e instanceof d))return;if(e.status===S.Unauthorized){this.tokenService.clear(),this.sharedService.lastPage=this.router.url,this.router.navigate(["/auth/login"]).then(w=>{});return}let c=this.menuService.find(s);this.toastService.danger(e.error.message?e.error.message:e.message,c?c.name:"\u672A\u77E5\u4E3B\u9898")},next:e=>{if(e instanceof p){if(!["POST","PUT","DELETE"].includes(t.method))return;let c=this.menuService.find(s);if(!c)return;this.toastService.success(e.body&&e.body.message?e.body.message:"\u64CD\u4F5C\u6210\u529F",c.name)}}}))}static{this.\u0275fac=function(a){return new(a||o)(r(v),r(y),r(T),r(g),r(k),r(b))}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{R as a,W as b};
