import{a as Ce,b as Se,c as we,d as W,e as ye,f as Fe,g as _e}from"./chunk-ZAPO4IBC.js";import{a as ce,b as fe,c as be}from"./chunk-WBGQSBW6.js";import{b as Ee}from"./chunk-5ZHBY33V.js";import{c as he,g as ge,h as ve}from"./chunk-EAKQQOR6.js";import{a as w}from"./chunk-VHVIKD6E.js";import{B as de,t as T}from"./chunk-QJO7QQNE.js";import{$a as $,$b as ee,Aa as O,Ae as P,Be as G,Db as Z,De as se,Ea as n,Ee as me,Fa as o,Ga as m,La as g,Ma as L,N as H,Nb as S,Tb as F,Xa as a,Ya as b,Yb as _,Za as z,ab as J,ac as j,ae as le,bb as Q,bc as te,dc as ie,ec as f,fa as y,fb as X,fc as N,gc as M,hc as q,ia as l,ic as ne,jc as p,kc as oe,ke as ue,lc as B,na as d,nd as D,ne as R,oc as re,of as pe,pa as E,pd as I,qa as V,qc as ae,qd as k,sd as x,ua as v,vb as C,vd as A,wb as Y,xa as K,ya as u}from"./chunk-J7X6RXHA.js";function Re(r,h){if(r&1&&(n(0,"nb-option",10),a(1),o()),r&2){let e=h.$implicit;u("value",e.value),l(),b(e.label)}}var Pe=r=>({author:r});function Ge(r,h){if(r&1&&m(0,"img",4),r&2){let e=L();u("src",e.rowData.avatar,y)}}function Te(r,h){if(r&1&&(n(0,"a",5),a(1),o()),r&2){let e=h.$implicit,i=h.index,t=L();O("ms-0",i==0),u("routerLink","/app/content/"+e.type)("queryParams",X(5,Pe,t.rowData.id)),l(),b(e.label)}}var Me=(()=>{class r{constructor(e,i,t){this.http=e,this.activatedRoute=i,this.configService=t,this.settings={columns:{}},this.batches=[{label:"\u6279\u91CF\u64CD\u4F5C",value:""},{label:"\u5220\u9664",value:"delete"},{label:"\u53D1\u9001\u5BC6\u7801\u91CD\u7F6E\u90AE\u4EF6",value:"reset"}],this.batchMode="",this.roles=[],this.spinner=!1,this.route=i.snapshot}ngOnInit(){this.roles=this.configService.roles(),this.settings=this.buildSettings(),this.source=new be(this.http,{endPoint:Ce,dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}buildSettings(){return{selectMode:"multi",actions:{position:"right",add:!1,edit:!1,delete:!0,columnTitle:"\u64CD\u4F5C"},edit:{editButtonContent:'<i class="nb-edit"></i>',saveButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},delete:{deleteButtonContent:'<i class="nb-trash"></i>',confirmDelete:!0},pager:{perPage:30},mode:"external",rowClassFunction:()=>"text-break",columns:{account:{title:"\u7528\u6237\u540D",type:"custom",isFilterable:!0,renderComponent:Ue,componentInitFunction:(e,i)=>{e.value=i.getValue(),e.rowData=i.getRow().getData(),e.postTypeSettings=this.configService.postTypes()}},nickname:{title:"\u663E\u793A\u540D\u79F0",type:"text",isFilterable:!0,valuePrepareFunction:(e,i)=>e==i.getRow().getData().account?"-":e},roles:{title:"\u89D2\u8272",type:"text",isFilterable:!1,valuePrepareFunction:(e,i)=>{if(e.length<1)return"-";let t=[];return e.forEach(s=>{this.roles[s-1]&&t.push(this.roles[s-1].label)}),t.join(",")}},email:{title:"\u90AE\u7BB1",type:"html",isFilterable:!0,valuePrepareFunction:(e,i)=>`<a href="mailto:${e}">${e}</a>`},registeredAt:{title:"\u52A0\u5165\u65F6\u95F4",type:"text",isFilterable:!1}}}}delete(e){let i=e.data;if(i.id==1){window.alert("\u6B64\u7528\u6237\u4E0D\u80FD\u88AB\u5220\u9664!");return}window.confirm("\u786E\u8BA4\u5220\u9664\u7528\u6237: "+i.account)&&(this.deleteUser([i.id]),this.http.post(W,{id:i.id}).subscribe(t=>{this.source?.refresh()}))}batch(){let e=[];switch(this.source?.getSelectedItems().forEach(i=>{e.push(i.id)}),this.batchMode){case"delete":e.length>0&&window.confirm("\u786E\u8BA4\u5220\u9664\u5DF2\u9009\u62E9\u7684\u7528\u6237?")&&this.deleteUser(e);break;case"reset":e.length>0&&window.confirm("\u786E\u8BA4\u7ED9\u5DF2\u9009\u62E9\u7684\u7528\u6237\u53D1\u9001\u91CD\u7F6E\u5BC6\u7801\u90AE\u4EF6?")&&this.resetEmail(e);break}}deleteUser(e){this.http.post(W,{id:e},{context:new S().set(w,this)}).subscribe(i=>{this.source?.refresh()})}resetEmail(e){this.http.post(_e,{id:e},{context:new S().set(w,this)}).subscribe()}onSpinner(e){this.spinner=e}static{this.\u0275fac=function(i){return new(i||r)(d(F),d(_),d(T))}}static{this.\u0275cmp=E({type:r,selectors:[["app-user"]],standalone:!1,decls:15,vars:7,consts:[[1,"d-flex","justify-content-between","align-items-center"],["routerLink","/app/user/new","nbButton","","size","small","status","primary"],["icon","plus-outline"],[1,"mb-2",3,"ngSubmit"],[1,"row"],["name","batchMode",1,"col-auto",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto","ms-2"],["nbButton","","status","primary","type","submit",3,"disabled","nbSpinner"],[3,"delete","settings","source"],[3,"value"]],template:function(i,t){i&1&&(n(0,"nb-card")(1,"nb-card-header",0)(2,"span"),a(3),o(),n(4,"a",1),m(5,"nb-icon",2),o()(),n(6,"nb-card-body")(7,"form",3),g("ngSubmit",function(){return t.batch()}),n(8,"div",4)(9,"nb-select",5),Q("ngModelChange",function(c){return J(t.batchMode,c)||(t.batchMode=c),c}),v(10,Re,2,2,"nb-option",6),o(),n(11,"div",7)(12,"button",8),a(13,"\u5E94\u7528"),o()()()(),n(14,"angular2-smart-table",9),g("delete",function(c){return t.delete(c)}),o()()()),i&2&&(l(3),b(t.route.title),l(6),$("ngModel",t.batchMode),l(),u("ngForOf",t.batches),l(2),u("disabled",!t.batchMode||t.spinner)("nbSpinner",t.spinner),l(2),u("settings",t.settings)("source",t.source))},dependencies:[C,B,N,M,oe,ne,x,k,I,A,R,G,P,D,j,ce],encapsulation:2})}}return r})(),Ue=(()=>{class r{constructor(){this.postTypeSettings={},this.links=[]}ngOnInit(){let e=[];for(let i in this.postTypeSettings){let t=this.postTypeSettings[i];t.visibility.showUi&&e.push({label:t.label,type:i})}e&&(this.links=e)}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=E({type:r,selectors:[["app-user-action"]],inputs:{value:"value",rowData:"rowData"},standalone:!1,decls:6,vars:6,consts:[[1,"d-flex","flex-row"],["width","50","alt","",3,"src",4,"ngIf"],["queryParamsHandling","merge",3,"routerLink"],["class","mx-2","queryParamsHandling","merge",3,"ms-0","routerLink","queryParams",4,"ngFor","ngForOf"],["width","50","alt","",3,"src"],["queryParamsHandling","merge",1,"mx-2",3,"routerLink","queryParams"]],template:function(i,t){i&1&&(n(0,"div",0),v(1,Ge,1,1,"img",1),n(2,"a",2),a(3),o()(),n(4,"div"),v(5,Te,2,7,"a",3),o()),i&2&&(l(),u("ngIf",t.rowData.avatar),l(),O("ms-2",t.rowData.avatar),u("routerLink","/app/user/"+t.rowData.id),l(),b(t.value),l(2),u("ngForOf",t.links))},dependencies:[C,Y,j],encapsulation:2})}}return r})();function Oe(r,h){if(r&1&&(n(0,"nb-option",32),a(1),o()),r&2){let e=h.$implicit;u("value",e.value),l(),b(e.label)}}var U=(()=>{class r{constructor(e,i,t,s,c){this.http=e,this.activatedRoute=i,this.router=t,this.ckfinder=s,this.configService=c,this.formGroup=new q({id:new p(0),account:new p("",[f.required]),email:new p("",[f.required,f.email]),nickname:new p(""),url:new p("",[f.pattern("")]),password:new p("",[f.required,f.minLength(6),f.maxLength(32)]),roles:new p([]),avatar:new p(""),meta:new q({})}),this.spinner=!1,this.roles=[{value:"",label:"\u65E0"}],this.controls=[],this.showPassword=!0,this.route=i.snapshot}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}ngOnInit(){this.roles.push(...this.configService.roles()),this.subscription=this.ckfinder.onChoose().subscribe(i=>{i.length<1||this.formGroup.controls.avatar.setValue(i[0].url)}),this.metaGroup.addControl("description",new p("")),this.metaGroup.addControl("rich_editing",new p(!1));let e=[];if(this.configService.userMeta().forEach(i=>{i.control&&e.push(i.control)}),e.length>0){let i=he(e);for(let t in i)this.metaGroup.addControl(t,i[t]);this.controls=e}this.activatedRoute.paramMap.subscribe(i=>{if(this.activatedRoute.snapshot.url[0].path!=="new"){let t=Fe;if(i.has("id")){let s=parseInt(i.get("id")||"0",10);if(isNaN(s)||s<1){this.router.navigateByUrl("/app/user").then();return}t=ye.replace("{id}",s+"")}this.http.get(t).subscribe(s=>{this.buildEditorForm(s)})}})}onSpinner(e){this.spinner=e}onSubmit(e){let i=this.formGroup.getRawValue(),t=Se;i.id>0&&(t=we),this.http.post(t,i,{context:new S().set(w,this)}).subscribe(()=>{this.router.navigateByUrl("/app/user").then()})}getInputType(){return this.showPassword?"text":"password"}toggleShowPassword(){this.showPassword=!this.showPassword}get metaGroup(){return this.formGroup.controls.meta}buildEditorForm(e){this.formGroup.controls.password.removeValidators(f.required),this.formGroup.controls.account.disable(),this.formGroup.patchValue({id:e.id,avatar:e.avatar,account:e.account,nickname:e.nickname,email:e.email,url:e.url,password:e.password,roles:e.roles,meta:e.meta})}getBtnName(){return this.formGroup.controls.id.value<1?"\u6DFB\u52A0\u65B0\u7528\u6237":"\u66F4\u65B0"+this.route.title?.replace("\u7F16\u8F91","")}avatar(){this.ckfinder.popup({resourceType:"Images",multi:!1})}static{this.\u0275fac=function(i){return new(i||r)(d(F),d(_),d(ee),d(pe),d(T))}}static{this.\u0275cmp=E({type:r,selectors:[["app-user-new"]],standalone:!1,decls:79,vars:14,consts:[[3,"ngSubmit","formGroup"],[1,"mb-3","row"],["for","inputName",1,"label","col-form-label","col-12","col-md-2"],[1,"col-12","col-md-5"],["nbInput","","id","inputName","fullWidth","","status","primary","formControlName","account"],[1,"label","offset-md-2","col-form-label"],["for","inputEmail",1,"label","col-form-label","col-12","col-md-2"],["nbInput","","id","inputEmail","fullWidth","","status","primary","type","email","formControlName","email"],["for","inputNickname",1,"label","col-form-label","col-12","col-md-2"],["nbInput","","id","inputNickname","fullWidth","","status","primary","formControlName","nickname"],["for","inputUrl",1,"label","col-form-label","col-12","col-md-2"],["nbInput","","id","inputUrl","fullWidth","","status","primary","type","url","formControlName","url"],["for","inputPassword",1,"label","col-form-label","col-12","col-md-2"],["nbInput","","id","inputPassword","fullWidth","","status","primary","formControlName","password",3,"type"],["nbSuffix","","nbButton","","ghost","","type","button",3,"click"],["pack","eva",3,"icon"],[1,"label","col-form-label","col-12","col-md-2"],[1,"d-flex","justify-content-between","align-items-center"],["alt","\u5934\u50CF","width","128",3,"src"],["type","button","size","medium","nbButton","",3,"click"],["for","inputRole",1,"label","col-form-label","col-12","col-md-2"],["multiple","","id","inputRole","fullWidth","","formControlName","roles"],[3,"value",4,"ngFor","ngForOf"],[1,"px-0","border-0"],[1,"px-0"],[1,"mb-3","row",3,"formGroup"],["for","inputEditor",1,"label","col-form-label","col-12","col-md-2"],["id","inputEditor","formControlName","rich_editing"],["for","inputDescription",1,"label","col-form-label","col-12","col-md-2"],["id","inputDescription","formControlName","description","fullWidth","","rows","5","nbInput",""],["direction","row",3,"controls","form"],["nbButton","","status","primary","type","submit",3,"disabled","nbSpinner"],[3,"value"]],template:function(i,t){i&1&&(n(0,"nb-card")(1,"nb-card-header"),a(2),o(),n(3,"nb-card-body")(4,"form",0),g("ngSubmit",function(c){return t.onSubmit(c)}),n(5,"div",1)(6,"label",2),a(7,"\u7528\u6237\u540D"),o(),n(8,"div",3),m(9,"input",4),o(),n(10,"label",5),a(11,"\u7528\u6237\u540D\u5728\u7AD9\u70B9\u767B\u9646\u4E2D\u4F7F\u7528\uFF0C\u4E0D\u53EF\u4EE5\u4FEE\u6539\u3002"),o()(),n(12,"div",1)(13,"label",6),a(14,"\u90AE\u7BB1"),o(),n(15,"div",3),m(16,"input",7),o(),n(17,"label",5),a(18,"\u5728\u5FD8\u8BB0\u5BC6\u7801\u7684\u65F6\u5019\u53EF\u4EE5\u901A\u8FC7\u90AE\u7BB1\u627E\u56DE\u5BC6\u7801\u3002"),o()(),n(19,"div",1)(20,"label",8),a(21,"\u663E\u793A\u540D\u79F0"),o(),n(22,"div",3),m(23,"input",9),o(),n(24,"label",5),a(25,"\u663E\u793A\u5728\u7AD9\u70B9\u7684\u4EFB\u4F55\u5730\u65B9\u3002"),o()(),n(26,"div",1)(27,"label",10),a(28,"\u7F51\u7AD9\u5730\u5740"),o(),n(29,"div",3),m(30,"input",11),o(),n(31,"label",5),a(32,"\u4E2A\u4EBA\u7F51\u9875\u5730\u5740\u3002"),o()(),n(33,"div",1)(34,"label",12),a(35,"\u5BC6\u7801"),o(),n(36,"div",3)(37,"nb-form-field"),m(38,"input",13),n(39,"button",14),g("click",function(){return t.toggleShowPassword()}),m(40,"nb-icon",15),o()()(),n(41,"label",5),a(42," \u5FC5\u987B\u662F\u6570\u5B57\u5B57\u6BCD\u7EC4\u5408\uFF0C\u4E0D\u4FEE\u6539\u5BC6\u7801\u4FDD\u6301\u4E3A\u7A7A\u5373\u53EF\u3002 "),o()(),n(43,"div",1)(44,"label",16),a(45,"\u4E2A\u6027\u5934\u50CF"),o(),n(46,"div",3)(47,"div",17),m(48,"img",18),n(49,"button",19),g("click",function(){return t.avatar()}),a(50,"\u9009\u62E9\u5934\u50CF"),o()()(),n(51,"label",5),a(52,"\u8BF7\u4F7F\u7528\u76F8\u540C\u6BD4\u4F8B\u6B63\u65B9\u5F62\u56FE\u7247\u3002"),o()(),n(53,"div",1)(54,"label",20),a(55,"\u89D2\u8272"),o(),n(56,"div",3)(57,"nb-select",21),v(58,Oe,2,2,"nb-option",22),o()()(),n(59,"nb-card",23)(60,"nb-card-header",24),a(61,"\u5176\u5B83\u8BBE\u7F6E"),o()(),n(62,"div",25)(63,"label",26),a(64,"\u53EF\u89C6\u5316\u7F16\u8F91\u5668"),o(),n(65,"div",3)(66,"nb-checkbox",27),a(67,"\u64B0\u5199\u6587\u7AE0\u65F6\u4E0D\u4F7F\u7528\u53EF\u89C6\u5316\u7F16\u8F91\u5668"),o()()(),n(68,"div",25)(69,"label",28),a(70,"\u4E2A\u4EBA\u8BF4\u660E"),o(),n(71,"div",3),m(72,"textarea",29),o()(),m(73,"control-container",30),n(74,"div",1),m(75,"label",16),n(76,"div",3)(77,"button",31),a(78),o()()()()()()),i&2&&(l(2),b(t.route.title),l(2),u("formGroup",t.formGroup),l(34),u("type",t.getInputType()),l(2),u("icon",t.showPassword?"eye-outline":"eye-off-2-outline"),K("aria-label",t.showPassword?"hide password":"show password"),l(8),u("src",t.formGroup.controls.avatar.value,y),l(10),u("ngForOf",t.roles),l(4),u("formGroup",t.metaGroup),l(6),u("formGroup",t.metaGroup),l(5),u("controls",t.controls)("form",t.metaGroup),l(4),u("disabled",t.formGroup.invalid||t.spinner)("nbSpinner",t.spinner),l(),z(" ",t.getBtnName()," "))},dependencies:[C,B,ie,N,M,re,ae,x,k,I,le,A,ue,R,G,P,D,me,se,ge],encapsulation:2})}}return r})();var Le=[{path:"",title:"\u6240\u6709\u7528\u6237",component:Me},{path:"new",title:"\u6DFB\u52A0\u65B0\u7528\u6237",pathMatch:"full",component:U},{path:"profile",title:"\u4E2A\u4EBA\u8D44\u6599",component:U},{path:":id",title:"\u7F16\u8F91\u7528\u6237",component:U}],pt=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=V({type:r})}static{this.\u0275inj=H({imports:[Z,de,te.forChild(Le),fe,ve,Ee]})}}return r})();export{pt as UserModule};
