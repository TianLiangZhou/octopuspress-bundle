import{a as de,b as ce,c as ge}from"./chunk-WBGQSBW6.js";import{a as he}from"./chunk-VHVIKD6E.js";import{B as ue,t as pe}from"./chunk-QJO7QQNE.js";import{$a as C,Aa as H,Ae as re,Be as le,Ca as K,Db as Y,Ea as o,Fa as a,Ha as G,Ia as z,Ka as k,La as S,Lb as Z,Ma as M,N as A,Nb as $,Qe as me,Re as se,S as g,T as h,Tb as F,Wa as I,Xa as l,Y as j,Ya as c,Yb as P,ab as f,ac as w,bb as _,bc as ee,dc as te,eb as U,fb as J,fc as D,gb as Q,gc as x,ia as r,ic as B,jc as ne,kc as T,ke as oe,lc as L,na as v,ne as ae,pa as y,pd as O,qa as q,qd as V,rb as X,rd as ie,sd as W,ua as b,vb as E,vd as R,wb as N,ya as s}from"./chunk-J7X6RXHA.js";var _e=(i,u)=>({"fs-6":i,"text-primary":u}),ye=()=>["./"],Se=i=>({status:i});function Me(i,u){if(i&1&&(G(0),o(1,"a",7),l(2),a(),z()),i&2){let e=u.$implicit,t=M();r(),K(Q(5,_e,e.value==t.radioFilter.value,e.value==t.radioFilter.value)),s("routerLink",U(8,ye))("queryParams",J(9,Se,e.value)),r(),c(e.label)}}function we(i,u){if(i&1&&(o(0,"nb-option",8),l(1),a()),i&2){let e=u.$implicit;s("value",e.value),r(),c(e.label)}}function Ee(i,u){if(i&1){let e=k();o(0,"a",3),S("click",function(){let n=g(e).$implicit,p=M();return h(p.click(n.value))}),l(1),a()}if(i&2){let e=u.$implicit,t=u.index;H("ps-0",t==0),s("routerLink",e.link)("queryParams",e.query),r(),c(e.title)}}function Fe(i,u){if(i&1&&(o(0,"nb-radio",19),l(1),a()),i&2){let e=u.$implicit;s("value",e.value),r(),c(e.label)}}function ke(i,u){if(i&1&&(o(0,"div",10)(1,"label",14),l(2,"\u56DE\u5E94\u7ED9: "),a(),o(3,"h6",11)(4,"a",20),l(5),a()()()),i&2){let e=M();r(4),s("routerLink","/app/content/edit-post/"+e.comment.post.id),r(),c(e.comment.post.title)}}function Ie(i,u){if(i&1&&(o(0,"a",1),l(1,"\u67E5\u770B\u6587\u7AE0"),a()),i&2){let e=M();s("routerLink","/app/content/edit-post/"+e.value.id)}}var be=(()=>{class i{constructor(e,t,n){this.http=e,this.activatedRoute=t,this.configService=n,this.radioFilter=new ne("all"),this.radios=[],this.settings={columns:{}},this.batches=[{label:"\u6279\u91CF\u64CD\u4F5C",value:""},{label:"\u9A73\u56DE",value:"unapproved"},{label:"\u6279\u51C6",value:"approved"},{label:"\u6807\u8BB0\u4E3A\u5783\u573E",value:"spam"},{label:"\u79FB\u81F3\u56DE\u6536\u7AD9",value:"trash"}],this.batchMode="",this.spinner=!1,this.route=t.snapshot}ngOnInit(){this.settings=this.buildSettings(),this.activatedRoute.queryParams.subscribe(e=>{let t=Object.assign({status:this.radioFilter.value},e);this.radioFilter.setValue(t.status),this.loadSource(t)})}loadSource(e){let t=new Z({fromObject:e});this.http.get("/comment/statistics",{params:t}).subscribe(n=>{this.radios=[{label:`\u5168\u90E8 (${n.all})`,value:"all"},{label:`\u6211\u7684 (${n.my})`,value:"my"},{label:`\u5F85\u5BA1 (${n.unapproved})`,value:"unapproved"},{label:`\u5DF2\u6279\u51C6 (${n.approved})`,value:"approved"},{label:`\u5783\u573E (${n.spam})`,value:"spam"},{label:`\u56DE\u6536\u7AD9 (${n.trash})`,value:"trash"}]}),this.source=new ge(this.http,{endPoint:"/comment?"+t.toString(),dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}edit(e){}batch(){if(this.batchMode=="")return;let e=[];this.source.getSelectedItems().forEach(t=>{e.push(t.id)}),!(e.length<1)&&this.updateStatus(this.batchMode,e)}updateStatus(e,t){this.http.post("/comment/"+e,{id:t},{context:new $().set(he,this)}).subscribe(()=>{this.loadSource(this.activatedRoute.snapshot.queryParams)})}buildSettings(){return{selectMode:"multi",actions:{position:"right",add:!1,edit:!1,delete:!1,columnTitle:"\u64CD\u4F5C"},pager:{perPage:30},mode:"external",columns:{author:{title:"\u4F5C\u8005",isFilterable:!1},content:{title:"\u8BC4\u8BBA",isFilterable:!0,type:"custom",renderComponent:Ne,componentInitFunction:(e,t)=>{e.value=t.getValue(),e.rowData=t.getRow().getData(),e.onClick().subscribe(n=>{this.updateStatus(n.action,[n.id])})}},post:{title:"\u56DE\u590D\u81F3",type:"custom",renderComponent:ve,componentInitFunction:ve.initComponent,isFilterable:!1},createdAt:{title:"\u8BC4\u8BBA\u4E8E",isFilterable:!1}}}}onSpinner(e){this.spinner=e}static{this.\u0275fac=function(t){return new(t||i)(v(F),v(P),v(pe))}}static{this.\u0275cmp=y({type:i,selectors:[["app-comment"]],standalone:!1,decls:12,vars:8,consts:[[4,"ngFor","ngForOf"],[1,"row","mb-2",3,"ngSubmit"],["name","batchMode",1,"col-auto",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto"],["nbButton","","status","primary","type","submit",3,"disabled","nbSpinner"],[3,"edit","settings","source"],["nbButton","","queryParamsHandling","merge",1,"mx-2","bg-transparent","border-0","ps-0",2,"color","var(--text-basic-color)",3,"routerLink","queryParams"],[3,"value"]],template:function(t,n){t&1&&(o(0,"nb-card")(1,"nb-card-header"),l(2),a(),o(3,"nb-card-body"),b(4,Me,3,11,"ng-container",0),o(5,"form",1),S("ngSubmit",function(){return n.batch()}),o(6,"nb-select",2),_("ngModelChange",function(d){return f(n.batchMode,d)||(n.batchMode=d),d}),b(7,we,2,2,"nb-option",3),a(),o(8,"div",4)(9,"button",5),l(10,"\u5E94\u7528"),a()()(),o(11,"angular2-smart-table",6),S("edit",function(d){return n.edit(d)}),a()()()),t&2&&(r(2),c(n.route.title),r(2),s("ngForOf",n.radios),r(2),C("ngModel",n.batchMode),r(),s("ngForOf",n.batches),r(2),s("disabled",!n.batchMode||n.spinner)("nbSpinner",n.spinner),r(2),s("settings",n.settings)("source",n.source))},dependencies:[E,w,L,D,x,T,B,W,V,O,R,ae,le,re,de],encapsulation:2})}}return i})(),Ne=(()=>{class i{constructor(e){this.http=e,this.actionClick=new j,this.actions=[]}onClick(){return this.actionClick}click(e){return e==="edit"||this.actionClick.emit({action:e,id:this.rowData.id}),!1}ngOnInit(){let e=this.rowData.approved,t=[];switch(e){case"approved":t.push({title:"\u9A73\u56DE",icon:"slash-outline",value:"unapproved"},{title:"\u7F16\u8F91",icon:"edit-2-outline",value:"edit"},{title:"\u6807\u8BB0\u4E3A\u5783\u573E",icon:"bookmark-outline",value:"spam"},{title:"\u79FB\u81F3\u56DE\u6536\u7AD9",icon:"trash-2-outline",value:"trash"});break;case"unapproved":t.push({title:"\u6279\u51C6",icon:"checkmark-circle-outline",value:"approved"},{title:"\u7F16\u8F91",icon:"edit-2-outline",value:"edit"},{title:"\u6807\u8BB0\u4E3A\u5783\u573E",icon:"bookmark-outline",value:"spam"},{title:"\u79FB\u81F3\u56DE\u6536\u7AD9",icon:"trash-2-outline",value:"trash"});break;case"spam":t.push({title:"\u4E0D\u662F\u5783\u573E\u8BC4\u8BBA",icon:"undo-outline",value:"unapproved"},{title:"\u6C38\u4E45\u5220\u9664",icon:"trash-outline",value:"delete"});break;case"trash":t.push({title:"\u6807\u8BB0\u4E3A\u5783\u573E",icon:"bookmark-outline",value:"spam"},{title:"\u8FD8\u539F",icon:"undo-outline",value:"unapproved"},{title:"\u6C38\u4E45\u5220\u9664",icon:"trash-outline",value:"delete"});break}this.actions=t}static{this.\u0275fac=function(t){return new(t||i)(v(F))}}static{this.\u0275cmp=y({type:i,selectors:[["app-comment-actions"]],inputs:{value:"value",rowData:"rowData"},standalone:!1,decls:4,vars:2,consts:[[1,"py-3"],["id","actions"],["class","px-2","queryParamsHandling","merge",3,"ps-0","routerLink","queryParams","click",4,"ngFor","ngForOf"],["queryParamsHandling","merge",1,"px-2",3,"click","routerLink","queryParams"]],template:function(t,n){t&1&&(o(0,"div",0),l(1),a(),o(2,"div",1),b(3,Ee,2,5,"a",2),a()),t&2&&(r(),c(n.value),r(2),s("ngForOf",n.actions))},dependencies:[E,w],styles:["[_nghost-%COMP%]   #actions[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]:hover   #actions[_ngcontent-%COMP%]{visibility:visible}"]})}}return i})(),Ce=(()=>{class i{constructor(e,t,n){this.http=e,this.route=t,this.location=n,this.comment={},this.options=[]}ngOnInit(){this.route.paramMap.subscribe(e=>{let t=parseInt(e.get("id"),10);t>0&&this.http.get("/comment/"+t).subscribe(n=>{this.comment=n,this.options=[{label:"\u6279\u51C6",value:"approved"},{label:this.comment.approved==="unapproved"?"\u5F85\u5BA1":"\u9A73\u56DE",value:"unapproved"},{label:"\u6807\u8BB0\u4E3A\u5783\u573E",value:"spam"}],(this.comment.approved=="spam"||this.comment.approved=="trash")&&this.location.back()})})}onSubmit(e){console.log(e.invalid,e.valid),!e.invalid&&this.comment.id&&this.http.post("/comment/{id}/update",this.comment).subscribe(()=>{this.location.back()})}getStatus(e){return this.options.find(t=>t.value==e)?.label}static{this.\u0275fac=function(t){return new(t||i)(v(F),v(P),v(X))}}static{this.\u0275cmp=y({type:i,selectors:[["app-comment-edit"]],standalone:!1,decls:44,vars:10,consts:[["f","ngForm"],[1,"row",3,"ngSubmit"],[1,"col-9"],[1,"mb-3"],[1,"label","form-label"],["nbInput","","fullWidth","","name","author","status","primary",3,"ngModelChange","ngModel"],["nbInput","","fullWidth","","name","email","type","email","status","primary",3,"ngModelChange","ngModel"],["nbInput","","fullWidth","","name","url","type","url","status","primary",3,"ngModelChange","ngModel"],["nbInput","","fullWidth","","name","content","rows","5","status","primary",3,"ngModelChange","ngModel"],[1,"col-3"],[1,"d-flex","align-items-center"],[1,"ms-2"],["name","approved",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"label"],["class","d-flex align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between"],["href","#"],["nbButton","","status","primary","size","small","type","submit",3,"disabled"],[3,"value"],[3,"routerLink"]],template:function(t,n){if(t&1){let p=k();o(0,"form",1,0),S("ngSubmit",function(){g(p);let m=I(1);return h(n.onSubmit(m))}),o(2,"div",2)(3,"nb-card")(4,"nb-card-body")(5,"div",3)(6,"label",4),l(7,"\u4F5C\u8005\u663E\u793A\u540D\u79F0:"),a(),o(8,"input",5),_("ngModelChange",function(m){return g(p),f(n.comment.author,m)||(n.comment.author=m),h(m)}),a()(),o(9,"div",3)(10,"label",4),l(11,"\u4F5C\u8005\u7535\u5B50\u90AE\u7BB1\u5730\u5740:"),a(),o(12,"input",6),_("ngModelChange",function(m){return g(p),f(n.comment.email,m)||(n.comment.email=m),h(m)}),a()(),o(13,"div",3)(14,"label",4),l(15,"\u4F5C\u8005URL:"),a(),o(16,"input",7),_("ngModelChange",function(m){return g(p),f(n.comment.url,m)||(n.comment.url=m),h(m)}),a()(),o(17,"div",3)(18,"label",4),l(19,"\u8BC4\u8BBA:"),a(),o(20,"textarea",8),_("ngModelChange",function(m){return g(p),f(n.comment.content,m)||(n.comment.content=m),h(m)}),a()()()()(),o(21,"div",9)(22,"nb-card")(23,"nb-card-header"),l(24,"\u4FDD\u5B58"),a(),o(25,"nb-card-body")(26,"div",10)(27,"label",4),l(28,"\u72B6\u6001: "),a(),o(29,"h6",11),l(30),a()(),o(31,"nb-radio-group",12),_("ngModelChange",function(m){return g(p),f(n.comment.approved,m)||(n.comment.approved=m),h(m)}),b(32,Fe,2,2,"nb-radio",13),a(),o(33,"div",10)(34,"label",14),l(35,"\u63D0\u4EA4\u4E8E: "),a(),o(36,"div",11),l(37),a()(),b(38,ke,6,2,"div",15),a(),o(39,"nb-card-footer",16)(40,"a",17),l(41,"\u79FB\u81F3\u56DE\u6536\u7AD9"),a(),o(42,"button",18),l(43,"\u66F4\u65B0"),a()()()()()}if(t&2){let p=I(1);r(8),C("ngModel",n.comment.author),r(4),C("ngModel",n.comment.email),r(4),C("ngModel",n.comment.url),r(4),C("ngModel",n.comment.content),r(10),c(n.getStatus(n.comment.approved)),r(),C("ngModel",n.comment.approved),r(),s("ngForOf",n.options),r(5),c(n.comment.createdAt),r(),s("ngIf",n.comment.post),r(4),s("disabled",p.invalid)}},dependencies:[E,N,w,L,te,D,x,T,B,W,V,ie,O,R,oe,me,se],encapsulation:2})}}return i})(),ve=(()=>{class i{constructor(){this.value=null}ngOnInit(){}static initComponent(e,t){e.value=t.getRawValue(),e.rowData=t.getRow().getData()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["app-comment-post"]],inputs:{value:"value",rowData:"rowData"},standalone:!1,decls:1,vars:1,consts:[[3,"routerLink",4,"ngIf"],[3,"routerLink"]],template:function(t,n){t&1&&b(0,Ie,2,1,"a",0),t&2&&s("ngIf",n.value)},dependencies:[N,w],encapsulation:2})}}return i})();var Ze=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=q({type:i})}static{this.\u0275inj=A({imports:[Y,ee.forChild([{path:"",component:be,pathMatch:"full"},{path:":id",title:"\u7F16\u8F91\u8BC4\u8BBA",component:Ce}]),ue,ce]})}}return i})();export{Ze as CommentModule};
