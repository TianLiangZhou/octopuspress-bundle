import{a as ie,b as ae,c as re}from"./chunk-OCZHAON4.js";import{a as te,b as oe,c as ne}from"./chunk-WBGQSBW6.js";import"./chunk-EAKQQOR6.js";import"./chunk-VHVIKD6E.js";import{B as ee,t as F}from"./chunk-QJO7QQNE.js";import{$a as h,$b as K,Ae as D,Be as N,Db as P,Ea as i,Fa as r,Ga as f,La as p,Ma as O,N as k,Ra as B,Tb as R,Xa as m,Y as E,Ya as y,Yb as W,Za as A,Zd as G,_d as q,ab as C,af as Q,bb as v,bc as L,ef as Z,fc as _,ff as $,gc as U,ia as l,ic as V,kc as S,lc as X,na as d,pa as b,pd as H,qa as I,qd as T,rd as Y,sd as M,ua as g,vb as x,vd as w,ve as z,wb as j,we as J,ya as s}from"./chunk-J7X6RXHA.js";function me(n,u){if(n&1&&(i(0,"nb-option",11),m(1),r()),n&2){let e=u.$implicit;s("value",e.value),l(),y(e.label)}}function ce(n,u){if(n&1&&(i(0,"strong",9),m(1),r()),n&2){let e=O();l(),y(e.taxonomy.name)}}function de(n,u){if(n&1&&(i(0,"nb-option",10),m(1),r()),n&2){let e=u.$implicit;s("value",e.value),l(),y(e.label)}}var le=(()=>{class n{constructor(e,t,o,a,c){this.http=e,this.route=t,this.router=o,this.config=a,this.dialog=c,this.taxonomy="",this.settings={columns:{}},this.spinner=!1,this.batches=[{label:"\u6279\u91CF\u64CD\u4F5C",value:""},{label:"\u5220\u9664",value:"delete"}],this.batchMode=""}onSpinner(e){this.spinner=e}ngOnInit(){let e=this.config.taxonomies();this.route.paramMap.subscribe(t=>{let o=t.get("taxonomy")??"";if(!o||!Object.keys(e).includes(o)){this.router.navigateByUrl("/404").then();return}if(!e[o].visibility.showUi)return;this.taxonomy=o;let a=e[o]||{};a.visibility.showUi&&(this.taxonomySetting=a,this.buildSetting())})}delete(e){this.deleteTaxonomy([e.id],"\u786E\u8BA4\u5220\u9664\u7C7B\u76EE: "+e.name+"?")}buildSetting(){this.settings=this.buildSettings(),this.source=new ne(this.http,{endPoint:Q.replace("{taxonomy}",this.taxonomy),dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}buildSettings(){return{selectMode:"multi",actions:{position:"right",add:!1,edit:!1,delete:!1,columnTitle:"\u64CD\u4F5C"},pager:{perPage:30},mode:"external",rowClassFunction:()=>"text-break",columns:{name:{title:"\u540D\u79F0",type:"custom",isFilterable:!0,renderComponent:pe,componentInitFunction:(e,t)=>{e.value=t.getValue(),e.rowData=t.getRow().getData(),e.onClick().subscribe(o=>{switch(o.action){case"delete":this.delete(o.taxonomy);break;case"convert":this.convertDialog(o.taxonomy);break}})},isSortable:!1},slug:{title:"\u522B\u540D",type:"text",isFilterable:!0,isSortable:!1},description:{title:"\u5185\u5BB9\u63CF\u8FF0",type:"text",isFilterable:!1,isSortable:!1},count:{title:"\u603B\u6570",type:"text",isFilterable:!1}}}}batch(){let e=this.source?.getSelectedItems().map(t=>t.id);if(!(e===void 0||e.length<1))switch(this.batchMode){case"delete":this.deleteTaxonomy(e,"\u786E\u8BA4\u5220\u9664\u5DF2\u9009\u62E9\u7684\u7C7B\u76EE?");break}}deleteTaxonomy(e,t){window.confirm(t)&&this.http.post(Z.replace("{taxonomy}",this.taxonomy),{sets:e}).subscribe(()=>{this.source?.refresh()})}convertDialog(e){this.dialog.open(ue,{context:{taxonomy:e}}).onClose.subscribe(t=>{t!==void 0&&t&&this.convert(e.id,t)})}convert(e,t){this.http.post($,{id:e,toTaxonomy:t}).subscribe(()=>{this.source?.refresh()})}static{this.\u0275fac=function(t){return new(t||n)(d(R),d(W),d(K),d(F),d(J))}}static{this.\u0275cmp=b({type:n,selectors:[["app-taxonomy"]],standalone:!1,decls:13,vars:6,consts:[[1,"row"],[1,"col-12","col-md-4"],[3,"setting"],[1,"col-12","col-md-8"],[1,"border-0"],[1,"row","mb-2",3,"ngSubmit"],["name","batchMode",1,"col-auto",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto"],["nbButton","","status","primary","type","submit",3,"disabled"],[3,"settings","source"],[3,"value"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1),f(2,"app-taxonomy-create",2),r(),i(3,"div",3)(4,"nb-card")(5,"nb-card-body",4)(6,"form",5),p("ngSubmit",function(){return o.batch()}),i(7,"nb-select",6),v("ngModelChange",function(c){return C(o.batchMode,c)||(o.batchMode=c),c}),g(8,me,2,2,"nb-option",7),r(),i(9,"div",8)(10,"button",9),m(11,"\u5E94\u7528"),r()()(),f(12,"angular2-smart-table",10),r()()()()),t&2&&(l(2),s("setting",o.taxonomySetting),l(5),h("ngModel",o.batchMode),l(),s("ngForOf",o.batches),l(2),s("disabled",!o.batchMode),l(2),s("settings",o.settings)("source",o.source))},dependencies:[x,te,X,_,U,S,V,M,T,w,N,D,ie],encapsulation:2})}}return n})(),pe=(()=>{class n{constructor(){this.actionClick=new E}ngOnInit(){this.rowData.level!=null&&this.rowData.level>0&&(this.value="--".repeat(this.rowData.level)+this.value)}onClick(){return this.actionClick}delete(){this.actionClick.next({action:"delete",taxonomy:this.rowData})}convert(){this.actionClick.next({action:"convert",taxonomy:this.rowData})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=b({type:n,selectors:[["app-taxonomy-actions"]],inputs:{value:"value",rowData:"rowData"},standalone:!1,decls:6,vars:4,consts:[[1,"py-3","text-break","fs-6"],["title","\u7F16\u8F91","icon","edit-2-outline",1,"ps-0",3,"link"],["title","\u5220\u9664","icon","trash-outline",3,"click"],["title","\u8FC1\u79FB","icon","swap-outline",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0),m(1),r(),i(2,"nb-actions"),f(3,"nb-action",1),i(4,"nb-action",2),p("click",function(){return o.delete()}),r(),i(5,"nb-action",3),p("click",function(){return o.convert()}),r()()),t&2&&(l(),A(" ",o.value," "),l(2),B("link","/app/taxonomy/",o.rowData.taxonomy,"/",o.rowData.id,""))},dependencies:[G,q],styles:["[_nghost-%COMP%]   nb-actions[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]:hover   nb-actions[_ngcontent-%COMP%]{visibility:visible}"]})}}return n})(),ue=(()=>{class n{constructor(e,t){this.dialogRef=e,this.config=t,this.options=[],this.selectedTaxonomy=""}ngOnInit(){let e=this.config.taxonomies(),t=[{label:"--\u9009\u62E9--",value:""}];for(let o in e){let a=e[o];a.visibility.showUi&&a.slug!=this.taxonomy?.taxonomy&&t.push({label:a.label,value:a.slug})}this.options=t}convert(){this.dialogRef.close(this.selectedTaxonomy)}static{this.\u0275fac=function(t){return new(t||n)(d(z),d(F))}}static{this.\u0275cmp=b({type:n,selectors:[["app-taxonomy-convert-dialog"]],standalone:!1,decls:16,vars:4,consts:[["class","fw-bolder text-danger",4,"ngIf"],[1,"mb-3","d-flex","align-items-center"],[1,"label","col-form-label"],[1,"px-2"],["fullWidth","","id","taxonomies",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"click","disabled"],[1,"fw-bolder","text-danger"],[3,"value"]],template:function(t,o){t&1&&(i(0,"nb-card")(1,"nb-card-header"),g(2,ce,2,1,"strong",0),m(3,"--\u6B63\u5728\u8F6C\u6362\u7C7B\u522B "),r(),i(4,"nb-card-body")(5,"div",1)(6,"label",2),m(7,"\u9009\u62E9\u9700\u8981\u8F6C\u6362\u7684\u7C7B\u522B: "),r(),i(8,"div",3)(9,"nb-select",4),v("ngModelChange",function(c){return C(o.selectedTaxonomy,c)||(o.selectedTaxonomy=c),c}),g(10,de,2,2,"nb-option",5),r()()()(),i(11,"nb-card-footer",6)(12,"button",7),p("click",function(){return o.dialogRef.close()}),m(13,"\u53D6\u6D88"),r(),i(14,"button",8),p("click",function(){return o.convert()}),m(15,"\u8F6C\u6362"),r()()()),t&2&&(l(2),s("ngIf",o.taxonomy),l(7),h("ngModel",o.selectedTaxonomy),l(),s("ngForOf",o.options),l(4),s("disabled",o.selectedTaxonomy.length<1))},dependencies:[x,j,_,S,M,T,Y,H,w,N,D],encapsulation:2})}}return n})();var be=[{path:":taxonomy",component:le},{path:":taxonomy/:id",component:ae}],Re=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=I({type:n})}static{this.\u0275inj=k({imports:[P,L.forChild(be),oe,ee,re]})}}return n})();export{Re as TaxonomyModule};
