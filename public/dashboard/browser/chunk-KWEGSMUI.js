import{a as yt,b as It}from"./chunk-5ZHBY33V.js";import{c as ae,d as vt,e as xt,f as Ct,g as Ie,h as wt}from"./chunk-EAKQQOR6.js";import{a as D}from"./chunk-VHVIKD6E.js";import{B as bt,t as _t}from"./chunk-QJO7QQNE.js";import{$a as M,Aa as Y,Ae as ct,Bb as _e,Be as lt,C as Le,Cb as he,Da as $e,Db as qe,De as pt,Ea as r,Ee as mt,Fa as a,Ga as C,H as Re,Ha as le,Ia as pe,Ie as ut,Ja as ee,Je as gt,Ka as v,La as f,Ma as u,N as He,Nb as N,Qa as q,Rd as L,S as g,T as _,Ta as Q,Tb as S,Ua as K,Ud as ne,Va as Z,Vd as oe,Wa as y,Xa as l,Xb as X,Ya as w,Yb as ie,Za as I,_ as We,ab as V,ac as fe,ae as at,af as ht,bb as O,bc as Qe,ce as Fe,dc as Ke,eb as ze,fa as se,fb as te,fc as Ze,fe as dt,gb as Ue,gc as Xe,gf as ft,hb as me,hc as J,ia as d,ib as ue,ic as Je,ja as Ge,jc as De,kb as j,kc as Ye,ke as re,lc as et,na as b,nd as z,ne as be,oc as tt,p as H,pa as E,pb as ge,pd as B,pe as ve,q as Te,qa as je,qc as it,qd as A,qe as xe,r as Ae,rd as U,re as Ce,sd as P,se as we,tc as nt,u as F,ua as h,vb as T,vd as W,wb as $,we as st,x as Pe,xa as ce,ya as s,yd as ot,ye,z as Ne,zd as rt}from"./chunk-J7X6RXHA.js";var kt="/navigate/structure",Et="/navigate/{id}",St="/navigate/{id}/delete",Tt="/navigate/save",Nt="/navigate/save/location",Wt="/theme/installed",Dt="/theme/market",Ft="/theme/{name}/setup",Mt="/theme/{name}/activate",Vt="/theme/{name}/upgrade",Ot="/theme/{name}/delete",Me="/theme/upload",Bt="/theme/customize",At="/theme/customized",Pt="/widget/registered",Lt="/widget/blocks",Rt="/widget/{name}/rendered",Ht="/widget/saved";var Gt=o=>({node:o});function Jt(o,p){if(o&1&&(r(0,"nb-option",45),l(1),a()),o&2){let e=p.$implicit;s("value",e.id),d(),w(e.name)}}function Yt(o,p){if(o&1){let e=v();r(0,"div",41)(1,"nb-select",42),O("ngModelChange",function(t){g(e);let n=u();return V(n.nav.id,t)||(n.nav.id=t),_(t)}),h(2,Jt,2,2,"nb-option",43),a(),r(3,"button",44),f("click",function(){g(e);let t=u();return _(t.editor())}),l(4,"\u7F16\u8F91"),a()()}if(o&2){let e=u();d(),M("ngModel",e.nav.id),d(),s("ngForOf",e.navigate),d(),s("disabled",e.nav.id<1)}}function ei(o,p){if(o&1){let e=v();r(0,"nb-checkbox",53),O("checkedChange",function(t){let n=g(e).$implicit;return V(n.checked,t)||(n.checked=t),_(t)}),l(1),a()}if(o&2){let e=p.$implicit,i=u().$implicit;M("checked",e.checked),d(),I(" ",i.type=="post"?e.title:e.name," ")}}function ti(o,p){if(o&1&&(r(0,"nb-option",45),l(1),a()),o&2){let e=p.$implicit;s("value",e),d(),I(" ",e.title||e.name," ")}}function ii(o,p){if(o&1){let e=v();r(0,"nb-accordion-item")(1,"nb-accordion-item-header"),l(2),a(),r(3,"nb-accordion-item-body")(4,"form")(5,"div",46)(6,"nb-tabset")(7,"nb-tab",47)(8,"div",48),h(9,ei,2,2,"nb-checkbox",36),a()(),r(10,"nb-tab",49)(11,"div")(12,"label"),C(13,"input",50),a(),r(14,"nb-autocomplete",51,4),f("selectedChange",function(t){let n=g(e).$implicit,c=u();return _(c.selectSearchItem(n.typeName,t))}),h(16,ti,2,2,"nb-option",43),me(17,"async"),a()()()()(),r(18,"div",52)(19,"button",21),f("click",function(){let t=g(e).$implicit,n=u();return _(n.addToNav(t.typeName))}),l(20,"\u6DFB\u52A0\u5230\u5BFC\u822A"),a()()()()()}if(o&2){let e=p.$implicit,i=y(15),t=u();d(2),I(" ",e.label," "),d(7),s("ngForOf",e.defaultOptions),d(),s("formGroup",t.searchGroups),d(3),s("formControlName",e.typeName)("nbAutocomplete",i),d(),s("handleDisplayFn",t.displaySearch),d(2),s("ngForOf",ue(17,8,t.searchGroupResult[e.typeName])),d(3),s("disabled",t.disabled(e.typeName))}}function ni(o,p){o&1&&(r(0,"p",55),l(1," \u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A! "),a())}function oi(o,p){if(o&1&&(le(0),h(1,ni,2,0,"p",54),pe()),o&2){u();let e=y(48);d(),s("ngIf",e.errors==null?null:e.errors.required)}}function ri(o,p){o&1&&ee(0)}function ai(o,p){if(o&1){let e=v();r(0,"div",56),f("cdkDragMoved",function(t){g(e);let n=u();return _(n.dragMoved(t))}),h(1,ri,1,0,"ng-container",57),a()}if(o&2){let e=p.$implicit;u();let i=y(70);s("cdkDragData",e.nodeId),d(),s("ngTemplateOutlet",i)("ngTemplateOutletContext",te(3,Gt,e))}}function di(o,p){if(o&1){let e=v();r(0,"nb-checkbox",53),O("checkedChange",function(t){let n=g(e).$implicit,c=u();return V(c.nav.themeNavigationLocation[n.alias],t)||(c.nav.themeNavigationLocation[n.alias]=t),_(t)}),l(1),a()}if(o&2){let e=p.$implicit,i=u();M("checked",i.nav.themeNavigationLocation[e.alias]),d(),w(e.name)}}function si(o,p){if(o&1&&(r(0,"nb-option",45),l(1),a()),o&2){let e=p.$implicit;s("value",e.id),d(),w(e.name)}}function ci(o,p){if(o&1){let e=v();r(0,"div",58)(1,"label",64),l(2),a(),r(3,"div",65)(4,"nb-select",66),O("ngModelChange",function(t){let n=g(e).$implicit,c=u(2);return V(c.themeNavigationLocation[n.alias],t)||(c.themeNavigationLocation[n.alias]=t),_(t)}),h(5,si,2,2,"nb-option",43),a()()()}if(o&2){let e=p.$implicit,i=p.index,t=u(2);d(),q("for","nav_location_",i,""),d(),w(e.name),d(2),q("name","nav_location_",i,""),M("ngModel",t.themeNavigationLocation[e.alias]),d(),s("ngForOf",t.navigate)}}function li(o,p){if(o&1){let e=v();r(0,"form",24),f("ngSubmit",function(){g(e);let t=u();return _(t.saveLocation())}),r(1,"nb-card")(2,"nb-card-header"),l(3,"\u83DC\u5355\u4F4D\u7F6E"),a(),r(4,"nb-card-body")(5,"div",58)(6,"label",59),l(7,"\u4E3B\u9898\u83DC\u5355\u4F4D\u7F6E"),a(),r(8,"label",60),l(9,"\u5DF2\u6307\u6D3E\u7684\u83DC\u5355"),a()(),h(10,ci,6,7,"div",61),a(),r(11,"nb-card-footer",62)(12,"button",63),l(13,"\u4FDD\u5B58\u8BBE\u7F6E"),a()()()()}if(o&2){let e=u();d(10),s("ngForOf",e.themeNavigation),d(2),s("disabled",e.submitted)}}function pi(o,p){if(o&1){let e=v();r(0,"div",72)(1,"label",73),l(2,"URL"),a(),r(3,"input",74),O("ngModelChange",function(t){g(e);let n=u().node;return V(n.url,t)||(n.url=t),_(t)}),a()()}if(o&2){let e=u().node;d(),q("for","custom_link_id_",e.nodeId,""),d(2),q("id","custom_link_id_",e.nodeId,""),s("name",e.nodeId+"_url"),M("ngModel",e.url)}}function mi(o,p){o&1&&ee(0)}function ui(o,p){if(o&1){let e=v();r(0,"div",56),f("cdkDragMoved",function(t){g(e);let n=u(3);return _(n.dragMoved(t))}),h(1,mi,1,0,"ng-container",57),a()}if(o&2){let e=p.$implicit;u(3);let i=y(70);s("cdkDragData",e.nodeId),d(),s("ngTemplateOutlet",i)("ngTemplateOutletContext",te(3,Gt,e))}}function gi(o,p){if(o&1){let e=v();r(0,"div",78),f("cdkDropListDropped",function(t){g(e);let n=u(2);return _(n.drop(t))}),h(1,ui,2,5,"div",32),a()}if(o&2){let e=u().node,i=u();s("cdkDropListData",e.children)("id",e.nodeId)("cdkDropListConnectedTo",i.dropTargetIds)("cdkDropListSortingDisabled",!0),d(),s("ngForOf",e.children)}}function _i(o,p){if(o&1){let e=v();r(0,"div",67)(1,"nb-accordion")(2,"nb-accordion-item")(3,"nb-accordion-item-header",68)(4,"div"),l(5),a(),r(6,"div",69),l(7),a()(),r(8,"nb-accordion-item-body")(9,"form",70),h(10,pi,4,6,"div",71),r(11,"div",72)(12,"label",73),l(13,"\u5BFC\u822A\u540D\u79F0"),a(),r(14,"input",74),O("ngModelChange",function(t){let n=g(e).node;return V(n.title,t)||(n.title=t),_(t)}),a()(),r(15,"div")(16,"button",75),f("click",function(){let t=g(e).node,n=u();return _(n.remove(t.nodeId))}),l(17,"\u79FB\u9664"),a(),l(18," \xA0|\xA0 "),r(19,"button",76),l(20,"\u53D6\u6D88"),a()()()()()(),h(21,gi,2,5,"div",77),a()}if(o&2){let e=p.node,i=u();ce("data-id",e.nodeId)("id","node-"+e.nodeId),d(5),w(e.title),d(2),w(i.typeMapName[e.type]),d(3),s("ngIf",e.type=="custom"),d(2),q("for","custom_link_name_",e.nodeId,""),d(2),q("id","custom_link_name_",e.nodeId,""),s("name",e.nodeId),M("ngModel",e.title),d(7),s("ngIf",e.children.length>0)}}var jt=(()=>{class o{constructor(e,i,t,n,c){this.route=e,this.http=i,this.document=t,this.config=n,this.sidebar=c,this.searchResult={},this.navigate=[],this.themeNavigation=[],this.themeNavigationLocation={},this.dropTargetIds=[],this.nodeLookup={},this.submitted=!1,this.custom={link:"",title:""},this.typeMapName={page:"\u9875\u9762",post:"\u6587\u7AE0",custom:"\u81EA\u5B9A\u4E49\u94FE\u63A5",category:"\u5206\u7C7B"},this.defaultNode={nodeId:"demo",title:"\u793A\u4F8B1",type:"custom",children:[]},this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.searchGroups=new J({}),this.searchGroupResult={},this.accordionItems=[]}ngAfterViewInit(){F(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(i=>{i=="expanded"&&this.sidebar.compact("menu-sidebar")})})}onSpinner(e){this.submitted=e}ngOnInit(){let e=this.config.taxonomies(),i=this.config.postTypes(),t=[];for(let n in i)i[n].visibility.showNavigation&&(t.push({label:i[n].label,type:"post",name:n,typeName:"post_"+n,defaultOptions:[]}),this.searchGroups.addControl("post_"+n,new De("")));for(let n in e)e[n].visibility.showNavigation&&(t.push({label:e[n].label,type:"taxonomy",name:n,typeName:"taxonomy_"+n,defaultOptions:[]}),this.searchGroups.addControl("taxonomy_"+n,new De("")));for(let n of t){let c=this.searchGroups.controls[n.typeName];this.searchGroupResult[n.typeName]=c.valueChanges.pipe(Le(),Ne(500),Pe(m=>!!m),Re(m=>this.getObjects(m,n.name,n.type)))}this.accordionItems=t,this.http.get(kt).subscribe(n=>{for(let c in n.dataSet)this.accordionItems.forEach(m=>{m.typeName===c&&(m.defaultOptions=n.dataSet[c])});this.themeNavigation=n.themeNavigation,this.themeNavigationLocation=n.themeNavigationLocation,this.navigate=n.navigate}),this.prepareDragDrop(this.nav.nodes)}editor(){this.http.get(Et,{params:{id:this.nav.id}}).subscribe(e=>{this.nav=e.navigation,this.nav.nodes.length<1&&this.nav.nodes.push(this.defaultNode),this.nav.themeNavigationLocation={},this.themeNavigation.forEach(i=>{this.nav.themeNavigationLocation[i.alias]=this.themeNavigationLocation[i.alias]==this.nav.id}),this.prepareDragDrop(this.nav.nodes)})}prepareDragDrop(e){e.forEach(i=>{this.dropTargetIds.includes(i.nodeId)||this.dropTargetIds.push(i.nodeId),this.nodeLookup[i.nodeId]=i,this.prepareDragDrop(i.children)})}dragMoved(e){H(e).pipe(Ne(50)).subscribe(i=>{let t=this.document.elementFromPoint(i.pointerPosition.x,i.pointerPosition.y);if(!t){this.clearDragInfo();return}let n=t.classList.contains("node-item")?t:t.closest(".node-item");if(!n){this.clearDragInfo();return}this.dropActionTodo={targetId:n.getAttribute("data-id")??""};let c=n.getBoundingClientRect(),m=c.height/3;i.pointerPosition.y-c.top<m?this.dropActionTodo.action="before":i.pointerPosition.y-c.top>2*m?this.dropActionTodo.action="after":this.dropActionTodo.action="inside",this.showDragInfo()})}drop(e){if(!this.dropActionTodo)return;let i=e.item.data,t=e.previousContainer.id,n=this.getParentNodeId(this.dropActionTodo.targetId,this.nav.nodes,"main");console.log(`
moving
[`+i+"] from list ["+t+"]",`
[`+this.dropActionTodo.action+`]
[`+this.dropActionTodo.targetId+"] from list ["+n+"]");let c=this.nodeLookup[i],m=t!="main"?this.nodeLookup[t].children:this.nav.nodes,x=n!="main"?this.nodeLookup[n].children:this.nav.nodes,G=m.findIndex(R=>R.nodeId===i);switch(m.splice(G,1),this.dropActionTodo.action){case"before":case"after":let R=x.findIndex(k=>k.nodeId===this.dropActionTodo?.targetId);this.dropActionTodo.action=="before"?x.splice(R,0,c):x.splice(R+1,0,c);break;case"inside":this.nodeLookup[this.dropActionTodo.targetId].children.push(c),this.nodeLookup[this.dropActionTodo.targetId].isExpanded=!0;break}this.clearDragInfo(!0)}getParentNodeId(e,i,t){for(let n of i){if(n.nodeId==e)return t;let c=this.getParentNodeId(e,n.children,n.nodeId);if(c)return c}return""}showDragInfo(){this.clearDragInfo(),this.dropActionTodo&&document.getElementById("node-"+this.dropActionTodo.targetId)?.classList.add("drop-"+this.dropActionTodo.action)}clearDragInfo(e=!1){e&&(this.dropActionTodo=void 0),this.document.querySelectorAll(".drop-before").forEach(i=>i.classList.remove("drop-before")),this.document.querySelectorAll(".drop-after").forEach(i=>i.classList.remove("drop-after")),this.document.querySelectorAll(".drop-inside").forEach(i=>i.classList.remove("drop-inside"))}delete(){window.confirm("\u786E\u8BA4\u5220\u9664\u83DC\u5355 ["+this.nav.name+"]\u5417\uFF1F")&&this.http.post(St,this.nav).subscribe(e=>{this.create()})}save(){this.http.post(Tt,this.nav,{context:new N().set(D,this)}).subscribe(e=>{})}saveLocation(){this.http.post(Nt,{location:this.themeNavigationLocation},{context:new N().set(D,this)}).subscribe(e=>{})}addToNav(e){if(e==="custom"){let i="custom-"+this.custom.title,t={nodeId:i,title:this.custom.title,type:e,url:this.custom.link,children:[]};this.custom.title="",this.custom.link="",this.nav.nodes.push(t),this.dropTargetIds.push(i),this.nodeLookup[i]=t}else this.accordionItems.forEach(i=>{i.typeName==e&&i.defaultOptions.forEach(t=>{t.checked&&(this.selectedItem(t),t.checked=!1)})}),this.searchResult[e]&&(this.selectedItem(this.searchResult[e]),this.searchResult[e]=void 0,this.searchGroups.controls[e].setValue(""))}selectedItem(e){let i=e.type||e.taxonomy,t="node-"+i+"-"+e.id;if(this.nodeLookup[t]==null){let n={nodeId:t,title:e.title||e.name,type:i,objectId:e.id,children:[]};this.nav.nodes.push(n),this.dropTargetIds.push(t),this.nodeLookup[t]=n}}remove(e){this.removeNode(e,this.nav.nodes),delete this.dropTargetIds[this.dropTargetIds.indexOf(e)],delete this.nodeLookup[e]}removeNode(e,i){i.forEach((t,n)=>{t.nodeId==e?i.splice(n,1):t.children.length>0&&this.removeNode(e,t.children)})}create(){this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.dropTargetIds=[],this.nodeLookup={},this.prepareDragDrop(this.nav.nodes)}getObjects(e,i,t){switch(t){case"taxonomy":return this.http.get(ht,{params:{taxonomy:i,name:e,page:1,size:50}}).pipe(Te(n=>n.records));case"post":return this.http.get(ft,{params:{type:i,title:e,page:1,size:50}}).pipe(Te(n=>n.records));default:return H([])}}navigationLocation(e){console.log(e)}displaySearch(e){return typeof e=="string"?e:e.title||e.name}selectSearchItem(e,i){this.searchResult[e]=i}disabled(e){let i=!0;return this.accordionItems.forEach(t=>{t.defaultOptions.forEach(n=>{n.checked&&(i=!1)})}),this.searchResult[e]&&(i=!1),i}static{this.\u0275fac=function(i){return new(i||o)(b(ie),b(S),b(ge),b(_t),b(L))}}static{this.\u0275cmp=E({type:o,selectors:[["app-navigation"]],standalone:!1,decls:71,vars:17,consts:[["customForm","ngForm"],["navForm","ngForm"],["navName","ngModel"],["tmplNode",""],["searchAuto",""],[1,"row"],[1,"col-12"],[1,"d-flex","flex-md-row","justify-content-between"],["class","d-flex",4,"ngIf"],[1,""],["nbButton","","status","primary"],["icon","plus-outline"],[1,"col-12","col-xl-5"],["multi","true",1,"interface-complementary-area"],[1,"mb-3","row"],["for","custom_link",1,"label","col-sm-3","col-form-label"],[1,"col-sm-9"],["id","custom_link","required","","name","link","placeholder","https://","fullWidth","","status","primary","nbInput","",3,"ngModelChange","ngModel"],["for","custom_link_name",1,"label","col-sm-3","col-form-label"],["id","custom_link_name","required","","name","link_name","fullWidth","","status","primary","nbInput","",3,"ngModelChange","ngModel"],[1,"mb-3","text-right"],["nbButton","","status","primary",3,"click","disabled"],[4,"ngFor","ngForOf"],[1,"col-12","col-xl-7"],[3,"ngSubmit"],[1,"form-group","row"],["for","nav_name",1,"label","col-sm-2","col-form-label"],[1,"col-sm-10"],["id","nav_name","required","required","name","navName","status","primary","nbInput","",3,"ngModelChange","status","ngModel"],[4,"ngIf"],[1,"pt-4","label"],["cdkDropList","",1,"node_container",3,"cdkDropListDropped","cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled"],["cdkDrag","",3,"cdkDragData","cdkDragMoved",4,"ngFor","ngForOf"],[1,"py-2",2,"font-size","15px","font-weight","bold"],["for","nav_location",1,"label","col-sm-2","col-form-label"],["id","nav_location",1,"col-sm-10","d-flex","flex-column"],[3,"checked","checkedChange",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","type","button","status","danger",3,"click","disabled"],["type","submit","nbButton","","status","primary",3,"disabled"],[3,"ngSubmit",4,"ngIf"],[1,"d-flex"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["nbButton","","status","control",1,"mx-2",3,"click","disabled"],[3,"value"],[1,"form-group"],["tabTitle","\u6700\u8FD1",1,"px-0"],[1,"d-flex","flex-column"],["tabTitle","\u641C\u7D22",1,"px-0",3,"formGroup"],["nbInput","","status","primary","fullWidth","",3,"formControlName","nbAutocomplete"],[3,"selectedChange","handleDisplayFn"],[1,"form-group","text-right"],[3,"checkedChange","checked"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],["cdkDrag","",3,"cdkDragMoved","cdkDragData"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"row","mb-3"],[1,"label","col-2","col-form-label"],[1,"label","col-10","col-form-label"],["class","row mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary","type","submit",3,"disabled"],[1,"label","col-2","col-form-label",3,"for"],[1,"col-10"],[3,"ngModelChange","name","ngModel"],[1,"node-item"],[1,"justify-content-between"],[1,"mr-4"],["ngForm",""],["class","mb-2",4,"ngIf"],[1,"mb-2"],[1,"label","col-form-label",3,"for"],["nbInput","","fullWidth","","status","primary",3,"ngModelChange","id","name","ngModel"],["nbButton","","size","tiny","status","danger",3,"click"],["nbButton","","size","tiny","status","primary"],["class","node-children","cdkDropList","",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped",4,"ngIf"],["cdkDropList","",1,"node-children",3,"cdkDropListDropped","cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled"]],template:function(i,t){if(i&1){let n=v();r(0,"div",5)(1,"div",6)(2,"nb-card")(3,"nb-card-body")(4,"div",7),h(5,Yt,5,3,"div",8),r(6,"div",9)(7,"button",10),C(8,"nb-icon",11),l(9," \u521B\u5EFA\u65B0\u5BFC\u822A "),a()()()()()(),r(10,"div",12)(11,"nb-card")(12,"nb-card-header"),l(13," \u6DFB\u52A0\u5BFC\u822A\u9879 "),a(),r(14,"nb-card-body")(15,"nb-accordion",13)(16,"nb-accordion-item")(17,"nb-accordion-item-header"),l(18," \u81EA\u5B9A\u4E49\u94FE\u63A5 "),a(),r(19,"nb-accordion-item-body")(20,"form",null,0)(22,"div",14)(23,"label",15),l(24,"\u94FE\u63A5"),a(),r(25,"div",16)(26,"input",17),O("ngModelChange",function(m){return g(n),V(t.custom.link,m)||(t.custom.link=m),_(m)}),a()()(),r(27,"div",14)(28,"label",18),l(29,"\u94FE\u63A5\u540D\u79F0"),a(),r(30,"div",16)(31,"input",19),O("ngModelChange",function(m){return g(n),V(t.custom.title,m)||(t.custom.title=m),_(m)}),a()()(),r(32,"div",20)(33,"button",21),f("click",function(){return g(n),_(t.addToNav("custom"))}),l(34,"\u6DFB\u52A0\u5230\u5BFC\u822A"),a()()()()(),h(35,ii,21,10,"nb-accordion-item",22),a()()()(),r(36,"div",23)(37,"form",24,1),f("ngSubmit",function(){return g(n),_(t.save())}),r(39,"nb-card")(40,"nb-card-header"),l(41," \u5BFC\u822A\u7ED3\u6784 "),a(),r(42,"nb-card-body")(43,"div",25)(44,"label",26),l(45,"\u83DC\u5355\u540D\u79F0"),a(),r(46,"div",27)(47,"input",28,2),O("ngModelChange",function(m){return g(n),V(t.nav.name,m)||(t.nav.name=m),_(m)}),a(),h(49,oi,2,1,"ng-container",29),a()(),r(50,"p",30),l(51,"\u62D6\u653E\u5404\u4E2A\u9879\u76EE\u5230\u60A8\u559C\u6B22\u7684\u987A\u5E8F\uFF0C\u70B9\u51FB\u53F3\u4FA7\u7684\u7BAD\u5934\u53EF\u8FDB\u884C\u66F4\u8BE6\u7EC6\u7684\u8BBE\u7F6E\u3002"),a(),r(52,"div",31),f("cdkDropListDropped",function(m){return g(n),_(t.drop(m))}),h(53,ai,2,5,"div",32),a()(),r(54,"nb-card-footer")(55,"div",33),l(56,"\u83DC\u5355\u8BBE\u7F6E"),a(),r(57,"div",25)(58,"label",34),l(59,"\u663E\u793A\u4F4D\u7F6E"),a(),r(60,"div",35),h(61,di,2,2,"nb-checkbox",36),a()()(),r(62,"nb-card-footer")(63,"div",37)(64,"button",38),f("click",function(){return g(n),_(t.delete())}),l(65,"\u5220\u9664\u5BFC\u822A"),a(),r(66,"button",39),l(67,"\u4FDD\u5B58\u5BFC\u822A"),a()()()()(),h(68,li,14,2,"form",40),a()(),h(69,_i,22,12,"ng-template",null,3,j)}if(i&2){let n=y(21),c=y(38),m=y(48);d(5),s("ngIf",t.navigate.length>0),d(21),M("ngModel",t.custom.link),d(5),M("ngModel",t.custom.title),d(2),s("disabled",!n.valid),d(2),s("ngForOf",t.accordionItems),d(12),s("status",m.dirty?m.invalid?"danger":"success":"primary"),M("ngModel",t.nav.name),d(2),s("ngIf",m.invalid&&m.touched),d(3),s("cdkDropListData",t.nav.nodes)("id","main")("cdkDropListConnectedTo",t.dropTargetIds)("cdkDropListSortingDisabled",!0),d(),s("ngForOf",t.nav.nodes),d(8),s("ngForOf",t.themeNavigation),d(3),s("disabled",t.nav.id<1||t.nav.name.length<1),d(2),s("disabled",!c.valid||t.submitted),d(2),s("ngIf",t.themeNavigation.length>0)}},dependencies:[T,$,_e,et,Ke,Ze,Xe,nt,Ye,Je,tt,it,P,A,U,B,oe,ne,at,W,re,ve,xe,we,Ce,lt,ct,z,ut,gt,xt,vt,he],styles:[`.node_container{padding:var(--accordion-padding);border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}.node_container .cdk-drag-placeholder{display:none}.node_container .cdk-drag-preview{box-sizing:border-box;box-shadow:0 3px 3px -2px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#fff;opacity:.3}.node_container .drop-inside{border-width:var(--accordion-header-border-width)!important;border-style:var(--accordion-header-border-style)!important;border-color:var(--text-success-color)!important}.node_container .drop-before{border-top-width:var(--accordion-header-border-width)!important;border-top-style:var(--accordion-header-border-style)!important;border-top-color:var(--text-success-color)!important}.node_container .drop-after{border-bottom-width:var(--accordion-header-border-width)!important;border-bottom-style:var(--accordion-header-border-style)!important;border-bottom-color:var(--text-success-color)!important}.node_container .node-item{background-color:var(--accordion-item-background-color);cursor:move}.node_container .node-children{position:relative;transition:height .2s;margin-left:40px}.node_container .item-notes{margin-left:20px;color:#aaa}.node_container nb-icon{cursor:pointer!important}.node_container nb-accordion-item-header{cursor:move}.node_container nb-accordion{margin:5px;border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}
/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
`],encapsulation:2})}}return o})();var fi=["widgetSidebarBtn"],bi=["quickInsertWidgetDialog"],zt=["widgetItemComponent"],Ut=o=>({products:o}),vi=(o,p)=>({item:o,name:p});function xi(o,p){if(o&1&&(r(0,"label",47),l(1),a()),o&2){let e=u(2).$implicit;d(),w(e.label)}}function Ci(o,p){if(o&1){let e=v();r(0,"div",48),f("click",function(){let t=g(e).$implicit,n=u(3);return _(n.insertWidget(t.name))}),C(1,"nb-icon",49),r(2,"span",50),l(3),a()()}if(o&2){let e=p.$implicit,i=u(3);d(),s("pack",i.pack(e))("icon",e.icon),d(2),w(e.label)}}function wi(o,p){if(o&1&&(r(0,"div",43),h(1,xi,2,1,"label",44),r(2,"div",45),h(3,Ci,4,3,"div",46),a()()),o&2){let e=u().$implicit;d(),s("ngIf",e.slug),d(2),s("ngForOf",e.widgets)}}function yi(o,p){if(o&1&&(le(0),h(1,wi,4,2,"div",42),pe()),o&2){let e=p.$implicit;d(),s("ngIf",e.widgets&&e.widgets.length>0)}}function Ii(o,p){if(o&1){let e=v();r(0,"widget-item",55,4),f("focus",function(){g(e);let t=y(1),n=u(2);return _(n.selectorWidget(t))})("blur",function(t){g(e);let n=u(2);return _(n.unselectWidget(t))}),a()}if(o&2){let e=p.$implicit,i=p.index,t=u().index;Y("selected",e.selected),s("id",e.id)("product",e)("blockIndex",t)("index",i)}}function ki(o,p){if(o&1){let e=v();r(0,"nb-accordion",51),f("focus",function(){let t=g(e).index,n=u();return _(n.selectorBlock(t))}),r(1,"nb-accordion-item")(2,"nb-accordion-item-header",52),f("focus",function(){let t=g(e).index,n=u();return _(n.selectorBlock(t))}),l(3),a(),r(4,"nb-accordion-item-body"),h(5,Ii,2,6,"widget-item",53),r(6,"button",54),f("nbPopoverShowStateChange",function(t){let n=g(e).index,c=u();return _(c.quickToggle(t,n))}),C(7,"nb-icon",10),a()()()()}if(o&2){let e=p.$implicit,i=u(),t=y(50);d(3),I(" ",e.label," "),d(2),s("ngForOf",i.getBlockWidgets(e.name)),d(),s("nbPopover",t)}}function Ei(o,p){if(o&1&&(r(0,"nb-tab",56),ee(1,57),a()),o&2){let e=u(),i=y(48);s("tabTitle",e.blocks[e.selectBlockIndex].label||""),d(),s("ngTemplateOutlet",i)("ngTemplateOutletContext",te(3,Ut,e.getBlockWidgetsForIndex()))}}function Si(o,p){if(o&1&&(r(0,"nb-card-header",58),C(1,"nb-icon",49),r(2,"div",59)(3,"span"),l(4),a(),r(5,"label",60),l(6),a()()()),o&2){let e=u();d(),s("pack",e.pack(e.lastedWidget.product.widget))("icon",e.lastedWidget.product.widget.icon),d(3),w(e.lastedWidget.product.widget.label),d(2),w(e.lastedWidget.product.widget.description)}}function Ti(o,p){if(o&1&&(r(0,"nb-accordion-item")(1,"nb-accordion-item-header"),l(2),a(),r(3,"nb-accordion-item-body"),C(4,"control-container",62),a()()),o&2){let e=p.$implicit,i=u(2);d(2),w(e.label),d(2),s("form",i.lastedWidget.product.form)("controls",e.controls)}}function Ni(o,p){if(o&1&&(r(0,"nb-accordion",61),h(1,Ti,5,3,"nb-accordion-item",25),a()),o&2){let e=u();d(),s("ngForOf",e.lastedWidget.product.widget.sections)}}function Wi(o,p){if(o&1&&ee(0,57),o&2){let e=u().$implicit;u(2);let i=y(48);s("ngTemplateOutlet",i)("ngTemplateOutletContext",te(2,Ut,e.children))}}function Di(o,p){if(o&1){let e=v();r(0,"nb-list-item",65)(1,"a",66),f("click",function(){let t=g(e).$implicit,n=u(2);return _(n.selected(t))}),r(2,"div",67)(3,"span"),C(4,"nb-icon",49),a(),r(5,"span",68),l(6),a()(),r(7,"button",69),C(8,"nb-icon",70),a()(),h(9,Wi,1,4,"ng-container",71),a()}if(o&2){let e=p.$implicit,i=u(2),t=y(52);Y("selected",e.selected),d(),s("fragment",e.id),d(3),s("pack",i.pack(e.widget))("icon",e.widget.icon),d(2),w(e.widget.label),d(),s("nbPopover",t)("nbPopoverContext",Ue(9,vi,e,i.blocks[i.selectBlockIndex].name)),d(2),s("ngIf",e.children.length>0)}}function Fi(o,p){if(o&1&&(r(0,"nb-list",63),h(1,Di,10,12,"nb-list-item",64),a()),o&2){let e=p.products;d(),s("ngForOf",e)}}function Mi(o,p){if(o&1){let e=v();r(0,"div",48),f("click",function(){let t=g(e).$implicit,n=u(2);return _(n.insertWidget(t.name,!0))}),C(1,"nb-icon",49),r(2,"span",50),l(3),a()()}if(o&2){let e=p.$implicit,i=u(2);d(),s("pack",i.pack(e))("icon",e.icon),d(2),w(e.label)}}function Vi(o,p){if(o&1){let e=v();r(0,"nb-card",72)(1,"nb-card-header",73)(2,"nb-form-field")(3,"input",22),f("keyup",function(t){g(e);let n=u();return _(n.search(t))}),a(),C(4,"nb-icon",23),a()(),r(5,"nb-card-body",74)(6,"div",45),h(7,Mi,4,3,"div",46),a()(),r(8,"nb-card-footer",73)(9,"button",75),f("click",function(){g(e);let t=u();return _(t.widgetSidebarBtnRef.nativeElement.click())}),l(10,"\u6D4F\u89C8\u5168\u90E8 "),a()()()}if(o&2){let e=u();d(7),s("ngForOf",e.historyWidgets)}}function Oi(o,p){if(o&1){let e=v();r(0,"nb-card",72)(1,"nb-card-body",74)(2,"nb-list",74)(3,"nb-list-item")(4,"a",76),f("click",function(){let t=g(e).$implicit,n=u();return _(n.onPrevious(t.item))}),l(5,"\u5411\u4E0A\u79FB\u52A8"),a()(),r(6,"nb-list-item")(7,"a",76),f("click",function(){let t=g(e).$implicit,n=u();return _(n.onNext(t.item))}),l(8,"\u5411\u4E0B\u79FB\u52A8"),a()(),r(9,"nb-list-item")(10,"a",76),f("click",function(){let t=g(e).$implicit,n=u();return _(n.onRemove(t.item))}),l(11,"\u5220\u9664"),a()()()()()}}var Bi=["groupComponent"],Ai=["container"];function Pi(o,p){if(o&1&&C(0,"nb-icon",6),o&2){let e=u(2);s("pack",e.pack())("icon",e.product.widget.icon)}}function Li(o,p){if(o&1&&(r(0,"div",4)(1,"div",null,0),h(3,Pi,1,2,"nb-icon",5),a()()),o&2){let e=u();d(),$e("widget-",e.product.widget.name,""),d(2),s("ngIf",e.isMedia())}}function Ri(o,p){if(o&1&&C(0,"widget-group",7,1),o&2){let e=u();s("widgets",e.product.children)("parent",e)}}function Hi(o,p){if(o&1){let e=v();r(0,"widget-item",4,0),f("focus",function(){g(e);let t=y(1),n=u();return _(n.parent.parent.selectorWidget(t))})("blur",function(t){g(e);let n=u();return _(n.parent.parent.unselectWidget(t))}),a()}if(o&2){let e=p.$implicit,i=p.index,t=u();Y("selected",e.selected),s("id",e.id)("product",e)("blockIndex",t.parent.blockIndex)("index",i)("pre",t.parent)}}function Gi(o,p){if(o&1){let e=v();r(0,"div",5)(1,"button",6),f("nbPopoverShowStateChange",function(t){g(e);let n=u();return _(n.parent.parent.quickToggle(t,n.parent.blockIndex))}),C(2,"nb-icon",7),a()()}if(o&2){let e=u();d(),s("nbPopover",e.parent.parent.quickInsertWidgetDialog)}}var qt=o=>o.icon.startsWith("fa-")?"fa":o.icon.startsWith("op-")?"op":"",Oe=(()=>{class o{constructor(e,i,t){this.http=e,this.sidebar=i,this.document=t,this.widgets=[],this.widgetCategories=[],this.leftSidebarCompact=!1,this.blocks=[],this.hasHiddenWidgetSidebar=!0,this.hasHiddenSettingSidebar=!0,this.filterWidgetCategories=H([]),this.blockWidgets={},this.historyWidgets=[],this.selectBlockIndex=-1,this.leftSidebarCollapse=!1}ngOnInit(){let e=this.http.get(Pt),i=this.http.get(Lt);Ae([e,i]).subscribe(([t,n])=>{this.widgets=t.widgets,t.categories.forEach(m=>{m.widgets=this.widgets.filter(x=>x.category==m.slug),m.widgets.forEach(x=>{x.icon||(x.icon=m.icon)})}),this.widgetCategories=t.categories,this.filterWidgetCategories=H(this.widgetCategories),this.historyWidgets=this.widgets.slice(0,6),this.blocks=n,n.length>0&&(this.selectBlockIndex=0);let c=m=>{let x=this.widgets.find(k=>{if(k.name==m.name)return k});if(!x)return;let G=x.sections.map(k=>k.controls),R={id:m.id,widget:Object.assign({},x),form:new J(ae(G.flat(1))),name:x.name,selected:!1,children:[]};for(let k in m.attributes)R.form.contains(k)&&R.form.controls[k].setValue(m.attributes[k],{emitEvent:!1});return m.children.length>0&&m.children.forEach(k=>{let Be=c(k);Be&&R.children.push(Be)}),R};n.forEach(m=>{this.blockWidgets[m.name]=[],m.widgets.length>0&&m.widgets.forEach(x=>{let G=c(x);G&&this.blockWidgets[m.name].push(G)})})})}ngAfterViewInit(){F(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(i=>{i=="compacted"?(this.leftSidebarCollapse=!1,this.leftSidebarCompact=!0):i=="collapsed"?(this.leftSidebarCompact=!1,this.leftSidebarCollapse=!0):this.sidebar.compact("menu-sidebar")})}),this.widgetItems.changes.subscribe(e=>{this.selectorWidget(e.last)})}toggleWidgetSidebar(e){this.hasHiddenWidgetSidebar=!this.hasHiddenWidgetSidebar,this.hasHiddenWidgetSidebar||this.rollbackFilterWidgetCategories(),this.hasHiddenWidgetSidebar||(this.hasHiddenSettingSidebar=!0)}toggleSettingSidebar(e){this.hasHiddenSettingSidebar=!this.hasHiddenSettingSidebar,this.hasHiddenSettingSidebar||(this.hasHiddenWidgetSidebar=!0)}search(e){let i=e?e.target.value:"";if(i==""){this.filterWidgetCategories=H(this.widgetCategories);return}let t=this.widgets.filter(n=>n.label.includes(i)||n.keywords.flat().includes(i));this.filterWidgetCategories=H([{slug:"",label:"",icon:"",widgets:t}])}quickToggle(e,i){e.isShown?(this.selectBlockIndex=i,this.hasHiddenWidgetSidebar||this.toggleWidgetSidebar(null)):this.rollbackFilterWidgetCategories()}selectorBlock(e){this.selectBlockIndex=e,this.lastedWidget!==void 0&&(this.lastedWidget.product.selected=!1),this.lastedWidget=void 0}selectorWidget(e){this.lastedWidget&&this.lastedWidget.Id==e.Id||(this.lastedWidget!==void 0&&(this.lastedWidget.product.selected=!1),e.product.selected=!0,this.lastedWidget=e)}selectedWidgetComponent(e,i){for(let t of i){if(this.lastedWidget!=null&&this.lastedWidget.Id==e)break;if(t.Id==e){this.lastedWidget!=null&&(this.lastedWidget.product.selected=!1),t.product.selected=!0,this.lastedWidget=t;break}t.groupComponent!=null&&this.selectedWidgetComponent(e,t.groupComponent.widgetItems)}for(let t of this.widgetItems)if(e==t.Id){if(this.lastedWidget&&this.lastedWidget.Id==e)break;this.lastedWidget!==void 0&&(this.lastedWidget.product.selected=!1),t.product.selected=!0,this.lastedWidget=t;break}}unselectWidget(e){}insertWidget(e,i=!1,t=0){let n=this.widgets.filter(c=>c.name===e).pop();if(this.selectBlockIndex>-1&&n){let c=n.sections.map(G=>G.controls),m=this.blocks[this.selectBlockIndex].name,x={id:this.generateUUID(),widget:Object.assign({},n),form:new J(ae(c.flat(1))),selected:!0,name:n.name,children:[]};this.lastedWidget?this.lastedWidget.isGroup()?this.lastedWidget.addChildren(x):this.lastedWidget.pre&&this.lastedWidget.pre.isGroup()&&this.lastedWidget.pre.addChildren(x):this.blockWidgets[m].push(x),i||(this.historyWidgets.unshift(n),this.historyWidgets.length>6&&this.historyWidgets.pop())}}getBlockWidgetsForIndex(){return this.getBlockWidgets(this.blocks[this.selectBlockIndex].name)}getBlockWidgets(e){return this.blockWidgets[e]??[]}save(e){let i={blocks:{},widgets:{}},t=1,n=c=>{if(c.length<1)return[];let m=[];return c.forEach(x=>{m.push({id:x.id,name:x.widget.name,attributes:x.form.getRawValue(),children:n(x.children)})}),m};Object.keys(this.blockWidgets).forEach(c=>{i.blocks[c]=[],this.blockWidgets[c].forEach(m=>{let x="widget-"+m.widget.name+"-"+t;i.blocks[c].push(x),i.widgets[x]={id:m.id,name:m.widget.name,attributes:m.form.getRawValue(),children:n(m.children)},t++})}),this.http.post(Ht,i).subscribe({})}rollbackFilterWidgetCategories(){this.filterWidgetCategories.subscribe(e=>{e.length!=this.widgetCategories.length&&(this.filterWidgetCategories=H(this.widgetCategories))})}generateUUID(){let e=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(e+=performance.now()),"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){let t=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(i==="x"?t:t&3|8).toString(16)})}selected(e){e.selected||this.selectedWidgetComponent(e.id,this.widgetItems)}onNext(e){let i=t=>{for(let n=0;n<t.length;n++)if(t[n].id==e.id){let c=t[n+1]||null;c&&(t[n+1]=t[n],t[n]=c);break}else t[n].children.length>0&&i(t[n].children)};i(this.getBlockWidgetsForIndex())}onPrevious(e){let i=t=>{for(let n=0;n<t.length;n++)if(t[n].id==e.id){let c=t[n-1]||null;c&&(t[n-1]=t[n],t[n]=c);break}else t[n].children.length>0&&i(t[n].children)};i(this.getBlockWidgetsForIndex())}onRemove(e){let i=t=>{for(let n=0;n<t.length;n++)if(t[n].id==e.id){t.splice(n,1);break}else t[n].children.length>0&&i(t[n].children)};i(this.getBlockWidgetsForIndex())}pack(e){return qt(e)}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(L),b(ge))}}static{this.\u0275cmp=E({type:o,selectors:[["app-widget"]],viewQuery:function(i,t){if(i&1&&(Q(fi,5,We),Q(bi,5,Ge),Q(zt,5)),i&2){let n;K(n=Z())&&(t.widgetSidebarBtnRef=n.first),K(n=Z())&&(t.quickInsertWidgetDialog=n.first),K(n=Z())&&(t.widgetItems=n)}},standalone:!1,decls:53,vars:16,consts:[["widgetSidebarBtn",""],["rightSidebarWidgets",""],["quickInsertWidgetDialog",""],["itemMore",""],["widgetItemComponent",""],[1,"component-skeleton"],[1,"component-skeleton-body"],[1,"mb-0","position-relative"],[1,"d-flex","border-0","justify-content-between","align-items-center"],["nbButton","","id","widgetSidebarBtn",3,"click","status"],["icon","plus-outline"],[1,"d-flex","justify-content-end"],["nbButton","","status","success",3,"click"],[1,"mx-2"],["nbButton","","status","primary","type","button","id","settingSidebarBtn",3,"click"],["icon","settings-2"],[1,"d-flex","flex-grow-1","overflow-auto",2,"overscroll-behavior-y","none"],[1,"col-12","col-xl-4","p-0","position-relative",3,"hidden"],[1,"d-flex","flex-column","h-100"],[1,"h-100"],[1,"position-relative","overflow-hidden","h-100"],[1,"h-100","mb-0","border-0","rounded-0","position-relative"],["nbInput","","fullWidth","",3,"keyup"],["nbSuffix","","icon","search-outline"],[1,"d-flex","flex-column","flex-grow-1"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-column","flex-grow-1","overflow-hidden","mx-auto"],[1,"block-list","h-100","position-relative"],[1,"p-0","rounded-0","border-0","bg-transparent","h-100"],[1,"row"],[1,"col-12","col-lg-10","col-xl-8","mx-auto"],["tabindex","0","class","mt-5",3,"focus",4,"ngFor","ngForOf"],["tabindex","0",1,"col-12","col-xl-3","p-0","position-relative","sidebar-setting",3,"blur","hidden"],[1,"position-relative","h-100"],[1,"h-100","mb-0","border-0","rounded-0"],[1,"p-0","h-100","overflow-hidden"],["class","p-0 h-100",3,"tabTitle",4,"ngIf"],["tabTitle","\u6302\u4EF6",1,"p-0","h-100","overflow-hidden"],[1,"p-0","h-100","d-flex","border-0","flex-column"],["class","d-flex",4,"ngIf"],[1,"d-flex","p-0","flex-column","h-100","flex-grow-1"],["multi","",4,"ngIf"],["class","sidebar-category",4,"ngIf"],[1,"sidebar-category"],["class","label col-form-label py-4",4,"ngIf"],[1,"d-flex","flex-row","flex-wrap"],["class","sidebar-widget-item",3,"click",4,"ngFor","ngForOf"],[1,"label","col-form-label","py-4"],[1,"sidebar-widget-item",3,"click"],[3,"pack","icon"],[1,"py-4"],["tabindex","0",1,"mt-5",3,"focus"],["tabindex","0",3,"focus"],["tabindex","0",3,"selected","id","product","blockIndex","index","focus","blur",4,"ngFor","ngForOf"],["nbButton","","fullWidth","","status","basic","nbPopoverTrigger","click",3,"nbPopoverShowStateChange","nbPopover"],["tabindex","0",3,"focus","blur","id","product","blockIndex","index"],[1,"p-0","h-100",3,"tabTitle"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"d-flex"],[1,"d-flex","flex-column","ps-3"],[1,"label"],["multi",""],["tabindex","0",1,"control-container",3,"form","controls"],[1,"p-0","sidebar-setting-widgets-list","w-100"],["class","d-flex flex-column align-items-start","tabindex","0",3,"selected",4,"ngFor","ngForOf"],["tabindex","0",1,"d-flex","flex-column","align-items-start"],["routerLink","./",1,"d-flex","w-100","justify-content-between","text-decoration-none","flex-grow-1",3,"click","fragment"],[1,"d-flex","align-items-center"],[1,"ms-2"],["nbButton","","outline","","nbPopoverPlacement","bottom",1,"more",3,"nbPopover","nbPopoverContext"],["icon","more-vertical-outline"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[1,"border-0","mb-0",2,"width","22rem"],[1,"border-0"],[1,"p-0"],["status","primary","outline","","fullWidth","","nbButton","",1,"rounded-0",3,"click"],["role","button",1,"d-block","text-basic","text-decoration-none","w-100",3,"click"]],template:function(i,t){if(i&1){let n=v();r(0,"div",5)(1,"div",6)(2,"nb-card",7)(3,"nb-card-header",8)(4,"button",9,0),f("click",function(m){return g(n),_(t.toggleWidgetSidebar(m))}),C(6,"nb-icon",10),a(),r(7,"div",11)(8,"button",12),f("click",function(m){return g(n),_(t.save(m))}),l(9,"\u66F4\u65B0"),a(),C(10,"div",13),r(11,"button",14),f("click",function(m){return g(n),_(t.toggleSettingSidebar(m))}),C(12,"nb-icon",15),a()()()(),r(13,"div",16)(14,"div",17)(15,"div",18)(16,"div",19)(17,"div",20)(18,"nb-card",21)(19,"nb-card-header")(20,"nb-form-field")(21,"input",22),f("keyup",function(m){return g(n),_(t.search(m))}),a(),C(22,"nb-icon",23),a()(),r(23,"nb-card-body",24),h(24,yi,2,1,"ng-container",25),me(25,"async"),a()()()()()(),r(26,"div",26)(27,"div",18)(28,"div",27)(29,"nb-card",28)(30,"nb-card-body")(31,"div",29)(32,"div",30),h(33,ki,8,3,"nb-accordion",31),a()()()()()()(),r(34,"div",32),f("blur",function(m){return g(n),_(t.unselectWidget(m))}),r(35,"div",18)(36,"div",19)(37,"div",33)(38,"nb-card",34)(39,"nb-card-body",35)(40,"nb-tabset",19),h(41,Ei,2,5,"nb-tab",36),r(42,"nb-tab",37)(43,"nb-card",38),h(44,Si,7,4,"nb-card-header",39),r(45,"nb-card-body",40),h(46,Ni,2,1,"nb-accordion",41),a()()()()()()()()()()()()(),h(47,Fi,2,1,"ng-template",null,1,j)(49,Vi,11,1,"ng-template",null,2,j)(51,Oi,12,0,"ng-template",null,3,j)}i&2&&(Y("sidebar-compact",t.leftSidebarCompact)("sidebar-collapse",t.leftSidebarCollapse),d(4),s("status",t.hasHiddenWidgetSidebar?"primary":"control"),d(2),Y("sidebar-widget-toggle-animation",!t.hasHiddenWidgetSidebar),d(8),s("hidden",t.hasHiddenWidgetSidebar),d(10),s("ngForOf",ue(25,14,t.filterWidgetCategories)),d(9),s("ngForOf",t.blocks),d(),s("hidden",t.hasHiddenSettingSidebar),d(7),s("ngIf",t.blocks.length>0),d(3),s("ngIf",t.lastedWidget&&t.lastedWidget.product.selected),d(2),s("ngIf",t.lastedWidget&&t.lastedWidget.product.selected))},dependencies:()=>[T,$,_e,P,A,U,B,oe,ne,Fe,W,re,ve,xe,we,Ce,z,mt,pt,ot,rt,fe,Ie,Qt,he],styles:['.sidebar-widget-item[_ngcontent-%COMP%]{width:33.3%;color:var(--text-basic-color);display:flex;flex-direction:column;align-items:center;cursor:pointer}.sidebar-widget-item[_ngcontent-%COMP%]:focus   span[_ngcontent-%COMP%], .sidebar-widget-item[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:var(--text-hint-color);font-weight:700}[_nghost-%COMP%]{min-height:calc(100vh - var(--header-height) - 60px);overflow:hidden;position:absolute;inset:0}[_nghost-%COMP%]     nb-layout nb-layout-column{padding:0!important}[_nghost-%COMP%]     nb-accordion:focus:after, [_nghost-%COMP%]     widget-item:focus:after, [_nghost-%COMP%]     nb-accordion-item-header:focus:after, [_nghost-%COMP%]     widget-item.selected:after{content:"";position:absolute;z-index:1;pointer-events:none;inset:1px;box-shadow:0 0 0 1.5px var(--color-success-focus);border-radius:var(--accordion-border-radius);outline:2px solid transparent}[_nghost-%COMP%]   .scrollable[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;flex:1}[_nghost-%COMP%]   .sidebar-expanded[_ngcontent-%COMP%]{left:var(--sidebar-width)!important}[_nghost-%COMP%]   .sidebar-compact[_ngcontent-%COMP%]{left:var(--sidebar-width-compact)!important}[_nghost-%COMP%]   .sidebar-collapse[_ngcontent-%COMP%]{left:0!important}[_nghost-%COMP%]   .component-skeleton[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:auto;max-height:100%;position:fixed;top:var(--header-height);right:0;bottom:0;left:var(--sidebar-width-compact)}[_nghost-%COMP%]   .component-skeleton-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden;flex:0 1 100%;padding-bottom:60px}[_nghost-%COMP%]   .sidebar-widget-toggle-animation[_ngcontent-%COMP%]{transition:transform .3s;transform:rotate(45deg)}[_nghost-%COMP%]   nb-tabset[_ngcontent-%COMP%]   nb-tab[_ngcontent-%COMP%]{padding-bottom:2.875rem!important}[_nghost-%COMP%]   nb-accordion[_ngcontent-%COMP%], [_nghost-%COMP%]   widget-item[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--text-basic-color)}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{visibility:hidden;background-color:inherit;border:none}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--text-primary-color)}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover   more[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]   nb-list-item.selected[_ngcontent-%COMP%]{background-color:var(--background-basic-color-3)}[_nghost-%COMP%]   nb-list-item.selected[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{visibility:visible}']})}}return o})(),Qt=(()=>{class o{get Id(){return this.product.id}constructor(e,i,t){this.http=e,this.ds=i,this.parent=t,this.blockIndex=0,this.index=0}pack(){return qt(this.product.widget)}ngOnInit(){this.render(this.product.form.getRawValue()),this.subscribeChange=this.product.form.valueChanges.subscribe(e=>{this.render(e)})}addChildren(e){this.product.children.push(e)}render(e){e.name=this.product.widget.name,this.http.post(Rt,e).subscribe(i=>{i.output&&(this.container?this.container.nativeElement.innerHTML=i.output:this.groupComponent&&(this.groupComponent.groupRenderClassName=i.output))})}ngAfterViewInit(){}isMedia(){return["image","file","video","audio","cover","gallery"].includes(this.product.widget.name)}isGroup(){return this.product.name==="group"}ngOnDestroy(){this.subscribeChange&&this.subscribeChange.unsubscribe(),this.subscribeChange=void 0}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(X),b(Oe))}}static{this.\u0275cmp=E({type:o,selectors:[["widget-item"]],viewQuery:function(i,t){if(i&1&&(Q(Bi,5),Q(Ai,5,We)),i&2){let n;K(n=Z())&&(t.groupComponent=n.first),K(n=Z())&&(t.container=n.first)}},hostVars:1,hostBindings:function(i,t){i&2&&ce("id",t.Id)},inputs:{product:"product",blockIndex:"blockIndex",index:"index",pre:"pre"},standalone:!1,decls:2,vars:2,consts:[["container",""],["groupComponent",""],["class","position-relative widget-container",4,"ngIf"],[3,"widgets","parent",4,"ngIf"],[1,"position-relative","widget-container"],["style","width: 100px; height: 100px",3,"pack","icon",4,"ngIf"],[2,"width","100px","height","100px",3,"pack","icon"],[3,"widgets","parent"]],template:function(i,t){i&1&&h(0,Li,4,4,"div",2)(1,Ri,2,2,"widget-group",3),i&2&&(s("ngIf",t.product.widget.name!=="group"),d(),s("ngIf",t.product.widget.name==="group"))},dependencies:()=>[$,z,ji],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;margin:1.25rem 0}"]})}}return o})(),ji=(()=>{class o{constructor(e,i){this.http=e,this.ds=i,this.widgets=[],this.groupRenderClassName=""}ngOnInit(){}ngOnDestroy(){}ngAfterViewInit(){this.widgetItems.changes.subscribe(e=>{this.parent.parent.selectorWidget(e.last)})}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(X))}}static{this.\u0275cmp=E({type:o,selectors:[["widget-group"]],viewQuery:function(i,t){if(i&1&&Q(zt,5),i&2){let n;K(n=Z())&&(t.widgetItems=n)}},inputs:{widgets:"widgets",parent:"parent",groupRenderClassName:"groupRenderClassName"},standalone:!1,decls:3,vars:3,consts:[["widgetItemComponent",""],[1,"op-widget-group",3,"className"],["tabindex","0",3,"selected","id","product","blockIndex","index","pre","focus","blur",4,"ngFor","ngForOf"],["class","d-flex flex-column py-5 px-3",4,"ngIf"],["tabindex","0",3,"focus","blur","id","product","blockIndex","index","pre"],[1,"d-flex","flex-column","py-5","px-3"],["nbButton","","fullWidth","","status","basic","nbPopoverTrigger","click",3,"nbPopoverShowStateChange","nbPopover"],["icon","plus-outline"]],template:function(i,t){i&1&&(r(0,"div",1),h(1,Hi,2,7,"widget-item",2),a(),h(2,Gi,3,1,"div",3)),i&2&&(s("className",t.groupRenderClassName),d(),s("ngForOf",t.widgets),d(),s("ngIf",t.widgets.length<1))},dependencies:[T,$,Fe,W,z,Qt],encapsulation:2})}}return o})();var $i=()=>["zip"];function zi(o,p){if(o&1&&(r(0,"a",19),l(1),a()),o&2){let e=p.$implicit;s("href",e.homepage?e.homepage:"#",se),d(),I(" ",e.name," ")}}function Ui(o,p){if(o&1){let e=v();r(0,"button",20),f("click",function(){g(e);let t=u().$implicit,n=u();return _(n.upgrade(t.packageName))}),C(1,"nb-icon",21),a()}}function qi(o,p){if(o&1){let e=v();r(0,"div",11)(1,"nb-card")(2,"nb-card-header"),l(3),a(),r(4,"nb-card-body")(5,"div",12),l(6),a(),r(7,"div",13)(8,"span"),l(9,"\u4F5C\u8005:"),a(),r(10,"span"),h(11,zi,2,2,"a",14),a()(),r(12,"div",13)(13,"span"),l(14,"\u7248\u672C:"),a(),r(15,"span"),l(16),a()()(),r(17,"nb-card-footer",15)(18,"button",16),f("click",function(){let t=g(e).$implicit,n=u();return _(n.delete(t.packageName))}),l(19,"\u5220\u9664"),a(),r(20,"div",7)(21,"button",17),f("click",function(){let t=g(e).$implicit,n=u();return _(n.activate(t.packageName))}),l(22,"\u542F\u7528"),a(),h(23,Ui,2,0,"button",18),a()()()()}if(o&2){let e=p.$implicit,i=u();d(3),w(e.name),d(3),I(" ",e.description," "),d(5),s("ngForOf",e.authors),d(5),w(e.version),d(2),s("disabled",e.enabled||i.spinner)("nbSpinner",i.spinner),d(3),s("nbSpinner",i.spinner)("disabled",i.spinner||e.enabled),d(2),s("ngIf",e.upgradeable)}}function Qi(o,p){if(o&1){let e=v();r(0,"nb-card")(1,"nb-card-header"),l(2,"\u5728\u7EBF\u4E0B\u8F7D"),a(),r(3,"nb-card-body"),C(4,"input",22,1),a(),r(6,"nb-card-footer",15)(7,"button",23),f("click",function(){let t=g(e).dialogRef;return _(t.close())}),l(8,"\u53D6\u6D88"),a(),r(9,"button",24),f("click",function(){let t=g(e).dialogRef,n=y(5),c=u();return _(c.openDownload(n.value,t))}),l(10,"\u4E0B\u8F7D"),a()()()}}var Kt=(()=>{class o{constructor(e,i,t,n,c,m){this.http=e,this.toast=i,this.route=t,this.sanitizer=n,this.dialog=c,this.sidebar=m,this.themes=[],this.title="",this.spinner=!1}onSpinner(e){this.spinner=e}ngOnInit(){this.getThemes(),this.route.data.subscribe(e=>{this.title=e.title})}getThemes(){this.http.get(Wt).subscribe(e=>{e.records.length>0&&(this.themes=e.records)})}activate(e){this.http.post(Mt,{name:e},{context:new N().set(D,this)}).subscribe(i=>{this.getThemes()})}upgrade(e){this.http.post(Vt,{name:e},{context:new N().set(D,this)}).subscribe(i=>{this.getThemes()})}upload(e){if(e.length<1){this.toast.danger("\u4E0A\u4F20\u7684\u4E3B\u9898\u6587\u4EF6\u4E3A\u7A7A","\u4E0A\u4F20\u4E3B\u9898");return}this.http.post(Me,{uri:e.pop()}).subscribe(i=>{this.getThemes()})}openDownload(e,i){if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(e)){this.toast.danger("\u4E0D\u5408\u6CD5\u7684url\u94FE\u63A5","\u4E0A\u4F20\u4E3B\u9898");return}this.http.post(Me,{uri:e}).subscribe(n=>{i.close()})}delete(e){this.http.post(Ot,{name:e},{context:new N().set(D,this)}).subscribe(i=>{this.getThemes()})}ngAfterViewInit(){F(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(i=>{i!=="compacted"&&this.sidebar.compact("menu-sidebar")})})}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(ye),b(ie),b(X),b(st),b(L))}}static{this.\u0275cmp=E({type:o,selectors:[["app-theme"]],standalone:!1,decls:16,vars:4,consts:[["dialogTpl",""],["url",""],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center"],["nbButton","","status","success","routerLink","/app/decoration/theme/market",1,"ms-2"],[1,"d-flex"],["nbButton","","status","danger",1,"mx-2",3,"click"],[3,"finish","suffix","status"],["class","col-12 col-md-6 col-lg-4 col-xxl-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4","col-xxl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","status","danger",3,"click","disabled","nbSpinner"],["nbButton","","status","primary",3,"click","nbSpinner","disabled"],["class","ms-2","nbButton","","status","control",3,"click",4,"ngIf"],["target","_blank",1,"d-inline-block","mr-1",3,"href"],["nbButton","","status","control",1,"ms-2",3,"click"],["icon","sync-outline"],["nbInput","","name","url","type","url","placeholder","\u4E0B\u8F7D\u5730\u5740"],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"click"]],template:function(i,t){if(i&1){let n=v();r(0,"div",2)(1,"div",3)(2,"nb-card")(3,"nb-card-header",4)(4,"div",5)(5,"span"),l(6,"\u4E3B\u9898\u5217\u8868"),a(),r(7,"a",6),l(8,"\u4E3B\u9898\u5E02\u573A"),a()(),r(9,"div",7)(10,"button",8),f("click",function(){g(n);let m=y(15);return _(t.dialog.open(m))}),l(11,"\u5728\u7EBF\u4E0B\u8F7D"),a(),r(12,"app-upload",9),f("finish",function(m){return g(n),_(t.upload(m))}),a()()()()(),h(13,qi,24,9,"div",10),a(),h(14,Qi,11,0,"ng-template",null,0,j)}i&2&&(d(12),s("suffix",ze(3,$i))("status","primary"),d(),s("ngForOf",t.themes))},dependencies:[T,$,P,A,U,B,W,re,be,z,fe,yt],encapsulation:2})}}return o})();function Ki(o,p){if(o&1&&(r(0,"nb-tab",3)(1,"div",4),C(2,"control-container",5),a()()),o&2){let e=p.$implicit,i=p.index,t=u();s("tabId",e.id)("lazyLoad",!1)("active",i==0)("tabTitle",e.label)("tabIndex",i),d(2),s("controls",e.controls)("form",t.formGroup)}}var Zt=(()=>{class o{constructor(e,i){this.http=e,this.sidebar=i,this.sections=[],this.spinner=!1,this.theme={},this.data={},this.values={},this.isChanged=!1}ngAfterViewInit(){F(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(i=>{i==="expanded"&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.http.get(Bt).subscribe(e=>{let i=[];e.sections.forEach(t=>{i.push(...t.controls)}),this.formGroup=new J(ae(i));for(let t in this.formGroup.controls)this.values[t]=this.formGroup.controls[t].value;this.formGroup.valueChanges.subscribe(t=>{let n=!1;for(let c in t)t[c]!=this.values[c]?(this.data[c]=t[c]||null,n=!0):this.data.hasOwnProperty(c)&&delete this.data[c];this.isChanged=n}),this.sections=e.sections,this.theme=e.theme})}save(e){this.isChanged&&this.http.post(At,{customized:this.data},{context:new N().set(D,this)}).subscribe(()=>{this.isChanged=!1;for(let i in this.data)this.values[i]=this.data[i]})}onSpinner(e){this.spinner=e}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(L))}}static{this.\u0275cmp=E({type:o,selectors:[["app-theme-custom"]],standalone:!1,decls:10,vars:3,consts:[[1,"d-flex","justify-content-between"],["size","small","status","success","nbButton","",3,"click","disabled"],["class","px-0",3,"tabId","lazyLoad","active","tabTitle","tabIndex",4,"ngFor","ngForOf"],[1,"px-0",3,"tabId","lazyLoad","active","tabTitle","tabIndex"],[1,"col-12","col-xl-6","mx-auto"],[3,"controls","form"]],template:function(i,t){i&1&&(r(0,"nb-card")(1,"nb-card-header")(2,"div",0)(3,"span"),l(4),a(),r(5,"button",1),f("click",function(c){return t.save(c)}),l(6,"\u4FDD\u5B58\u53D1\u5E03"),a()()(),r(7,"nb-card-body")(8,"nb-tabset"),h(9,Ki,3,7,"nb-tab",2),a()()()),i&2&&(d(4),I(" \u4F60\u6B63\u5728\u81EA\u4E49 ",t.theme.stylesheet," "),d(),s("disabled",t.spinner||!t.isChanged),d(4),s("ngForOf",t.sections))},dependencies:[T,P,A,B,oe,ne,W,Ie],encapsulation:2})}}return o})();function Zi(o,p){if(o&1&&(r(0,"a",9),l(1),a()),o&2){let e=p.$implicit;s("href",e.homepage?e.homepage:"#",se),d(),I(" ",e.name," ")}}function Xi(o,p){if(o&1){let e=v();r(0,"div",3)(1,"nb-card")(2,"nb-card-header"),l(3),a(),r(4,"nb-card-body")(5,"div",4),l(6),a(),r(7,"div",5)(8,"span"),l(9,"\u4F5C\u8005:"),a(),r(10,"span"),h(11,Zi,2,2,"a",6),a()(),r(12,"div",5)(13,"span"),l(14,"\u7248\u672C:"),a(),r(15,"span"),l(16),a()()(),r(17,"nb-card-footer",7)(18,"button",8),f("click",function(){let t=g(e).$implicit,n=u();return _(n.setup(t.packageName))}),l(19),a()()()()}if(o&2){let e=p.$implicit,i=u();d(3),w(e.name),d(3),I(" ",e.description," "),d(5),s("ngForOf",e.authors),d(5),w(e.version),d(2),s("disabled",e.installed||i.spinner)("nbSpinner",i.spinner),d(),w(e.installed?"\u5DF2\u5B89\u88C5":"\u5B89\u88C5")}}var Xt=(()=>{class o{constructor(e,i,t,n,c){this.http=e,this.toast=i,this.route=t,this.sanitizer=n,this.sidebar=c,this.themes=[],this.title="",this.spinner=!1}onSpinner(e){this.spinner=e}ngAfterViewInit(){F(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(i=>{i!=="compacted"&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.getThemes(),this.route.data.subscribe(e=>{this.title=e.title})}getThemes(){this.http.get(Dt).subscribe(e=>{e.records.length>0&&(this.themes=e.records)})}setup(e){this.http.post(Ft,{name:e},{context:new N().set(D,this)}).subscribe(i=>{this.getThemes()})}static{this.\u0275fac=function(i){return new(i||o)(b(S),b(ye),b(ie),b(X),b(L))}}static{this.\u0275cmp=E({type:o,selectors:[["app-theme-market"]],standalone:!1,decls:6,vars:1,consts:[[1,"row"],[1,"col-12"],["class","col-12 col-md-6 col-lg-4 col-xl-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary",3,"click","disabled","nbSpinner"],["target","_blank",1,"d-inline-block","mr-1",3,"href"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header"),l(4," \u4E3B\u9898\u5E02\u573A "),a()()(),h(5,Xi,20,7,"div",2),a()),i&2&&(d(5),s("ngForOf",t.themes))},dependencies:[T,P,A,U,B,W,be],encapsulation:2})}}return o})();var Ji=[{path:"navigation",title:"\u5BFC\u822A",component:jt},{path:"widget",title:"\u6302\u4EF6",component:Oe},{path:"theme",title:"\u4E3B\u9898",component:Kt},{path:"theme/market",title:"\u4E3B\u9898\u5E02\u573A",component:Xt},{path:"custom",title:"\u81EA\u5B9A\u4E49",component:Zt}],ro=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=je({type:o})}static{this.\u0275inj=He({imports:[qe,bt,Qe.forChild(Ji),Ct,It,wt,dt]})}}return o})();export{ro as DecorationModule};
