import{a as vt,b as St,c as It}from"./chunk-WBGQSBW6.js";import{a as wt,b as Tt}from"./chunk-5ZHBY33V.js";import{c as q,g as Et,h as yt}from"./chunk-EAKQQOR6.js";import{a as w}from"./chunk-VHVIKD6E.js";import{B as Ct}from"./chunk-QJO7QQNE.js";import{$b as ct,Ca as E,Db as st,Ea as s,Fa as a,Ga as S,Ha as $,Ia as z,Ka as x,La as h,Ma as c,N as J,Nb as y,Rd as R,S as d,T as _,Ta as Y,Tb as F,Ua as tt,Ud as ft,Va as et,Vd as U,Wa as H,Xa as m,Xb as lt,Ya as C,Yb as V,Za as I,ac as mt,bc as pt,eb as it,fa as O,gc as ut,hc as K,ia as o,kb as nt,ke as gt,lc as dt,na as b,nd as bt,ne as j,oc as _t,pa as T,pd as k,qa as X,qd as P,rd as M,sd as D,u as A,ua as g,ub as rt,ue as ht,vb as N,vd as G,wb as L,we as xt,xb as ot,ya as l,yb as at,ye as B}from"./chunk-J7X6RXHA.js";var Nt="/plugin/market",Ft="/plugin/{name}/setup",Vt="/plugin/installed",kt="/plugin/{name}/down",Q="/plugin/upload",Pt="/plugin/{name}/activate",Dt="/plugin/{name}/upgrade",Gt="/plugin/{name}/deactivate";var $t=()=>["zip"];function zt(n,u){if(n&1&&(s(0,"a",18),m(1),a()),n&2){let t=u.$implicit;l("href",t.homepage?t.homepage:"#",O),o(),C(t.name)}}function Ht(n,u){if(n&1){let t=x();s(0,"button",19),h("click",function(){d(t);let i=c().$implicit,r=c();return _(r.upgrade(i.packageName))}),S(1,"nb-icon",20),a()}}function Kt(n,u){if(n&1&&(s(0,"a",22),m(1),a()),n&2){let t=u.$implicit;l("routerLink",t.link)("queryParams",t.query),o(),I(" ",t.name||"\u8BBE\u7F6E"," ")}}function qt(n,u){if(n&1&&(s(0,"nb-card-footer",13),g(1,Kt,2,3,"a",21),a()),n&2){let t=c().$implicit;o(),l("ngForOf",t.actions)}}function Qt(n,u){if(n&1){let t=x();s(0,"div",9)(1,"nb-card")(2,"nb-card-header"),m(3),a(),s(4,"nb-card-body")(5,"div",10),m(6),a(),s(7,"div",11)(8,"span"),m(9,"\u4F5C\u8005:"),a(),s(10,"span"),g(11,zt,2,2,"a",12),a()(),s(12,"div",11)(13,"span"),m(14,"\u7248\u672C:"),a(),s(15,"span"),m(16),a()()(),s(17,"nb-card-footer",13)(18,"button",14),h("click",function(){let i=d(t).$implicit,r=c();return _(r.remove(i.packageName))}),m(19,"\u5220\u9664"),a(),s(20,"div",5)(21,"button",15),h("click",function(){let i=d(t).$implicit,r=c();return _(i.enabled?r.inactivate(i.packageName):r.activate(i.packageName))}),m(22),a(),g(23,Ht,2,0,"button",16),a()(),g(24,qt,2,1,"nb-card-footer",17),a()()}if(n&2){let t=u.$implicit,e=c();o(3),I(" ",t.name," "),o(3),I(" ",t.description," "),o(5),l("ngForOf",t.authors),o(5),C(t.version),o(2),l("disabled",t.enabled||e.spinner)("nbSpinner",e.spinner),o(3),l("disabled",e.spinner)("nbSpinner",e.spinner)("status",t.enabled?"control":"primary"),o(),I(" ",t.enabled?"\u7981\u7528":"\u542F\u7528"," "),o(),l("ngIf",t.upgradeable),o(),l("ngIf",t.enabled&&t.actions.length>0)}}function Wt(n,u){if(n&1){let t=x();s(0,"nb-card")(1,"nb-card-header"),m(2,"\u5728\u7EBF\u4E0B\u8F7D"),a(),s(3,"nb-card-body"),S(4,"input",23,1),a(),s(6,"nb-card-footer",13)(7,"button",24),h("click",function(){let i=d(t).dialogRef;return _(i.close())}),m(8,"\u53D6\u6D88"),a(),s(9,"button",25),h("click",function(){let i=d(t).dialogRef,r=H(5),p=c();return _(p.openDownload(r.value,i))}),m(10,"\u4E0B\u8F7D"),a()()()}}var Mt=(()=>{class n{constructor(t,e,i,r,p){this.http=t,this.toast=e,this.route=i,this.dialog=r,this.sidebar=p,this.plugins=[],this.title="",this.spinner=!1}onSpinner(t){this.spinner=t}ngAfterViewInit(){A(0).subscribe(t=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(e=>{e!=="compacted"&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.getPlugins(),this.route.data.subscribe(t=>{this.title=t.title})}getPlugins(){this.http.get(Vt).subscribe(t=>{t.records.length>0&&(this.plugins=t.records)})}inactivate(t){this.http.post(Gt,{name:t},{context:new y().set(w,this)}).subscribe(e=>{this.getPlugins()})}activate(t){this.http.post(Pt,{name:t},{context:new y().set(w,this)}).subscribe(e=>{this.getPlugins()})}upgrade(t){this.http.post(Dt,{name:t},{context:new y().set(w,this)}).subscribe(e=>{this.getPlugins()})}upload(t){if(t.length<1){this.toast.danger("\u4E0A\u4F20\u7684\u63D2\u4EF6\u6587\u4EF6\u4E3A\u7A7A","\u4E0A\u4F20\u63D2\u4EF6");return}this.http.post(Q,{uri:t.pop()}).subscribe(e=>{this.getPlugins()})}openDownload(t,e){if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(t)){this.toast.danger("\u4E0D\u5408\u6CD5\u7684url\u94FE\u63A5","\u5728\u7EBF\u4E0B\u8F7D");return}this.http.post(Q,{uri:t}).subscribe(r=>{e.close(),this.getPlugins()})}remove(t){this.http.post(kt,{name:t},{context:new y().set(w,this)}).subscribe(e=>{this.getPlugins()})}static{this.\u0275fac=function(e){return new(e||n)(b(F),b(B),b(V),b(xt),b(R))}}static{this.\u0275cmp=T({type:n,selectors:[["app-plugin-installed"]],standalone:!1,decls:13,vars:4,consts:[["dialogTpl",""],["url",""],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex"],["nbButton","","status","danger",1,"me-2",3,"click"],[3,"finish","suffix","status"],["class","col-12 col-md-6 col-lg-4 col-xl-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","status","danger",3,"click","disabled","nbSpinner"],["nbButton","",3,"click","disabled","nbSpinner","status"],["class","ms-2","nbButton","","status","control",3,"click",4,"ngIf"],["class","d-flex justify-content-between",4,"ngIf"],["target","_blank",1,"d-inline-block","mr-1",3,"href"],["nbButton","","status","control",1,"ms-2",3,"click"],["icon","sync-outline"],["nbButton","","status","primary",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["nbButton","","status","primary",3,"routerLink","queryParams"],["nbInput","","name","url","type","url","placeholder","\u4E0B\u8F7D\u5730\u5740"],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"click"]],template:function(e,i){if(e&1){let r=x();s(0,"div",2)(1,"div",3)(2,"nb-card")(3,"nb-card-header",4)(4,"span"),m(5,"\u5DF2\u5B89\u88C5\u63D2\u4EF6\u5217\u8868"),a(),s(6,"div",5)(7,"button",6),h("click",function(){d(r);let f=H(12);return _(i.dialog.open(f))}),m(8,"\u5728\u7EBF\u4E0B\u8F7D"),a(),s(9,"app-upload",7),h("finish",function(f){return d(r),_(i.upload(f))}),a()()()()(),g(10,Qt,25,12,"div",8),a(),g(11,Wt,11,0,"ng-template",null,0,nt)}e&2&&(o(9),l("suffix",it(3,$t))("status","primary"),o(),l("ngForOf",i.plugins))},dependencies:[N,L,mt,D,P,M,k,G,gt,j,bt,wt],encapsulation:2})}}return n})();function Zt(n,u){if(n&1&&(s(0,"a",9),m(1),a()),n&2){let t=u.$implicit;l("href",t.homepage?t.homepage:"#",O),o(),I(" ",t.name," ")}}function Jt(n,u){if(n&1){let t=x();s(0,"div",3)(1,"nb-card")(2,"nb-card-header"),m(3),a(),s(4,"nb-card-body")(5,"div",4),m(6),a(),s(7,"div",5)(8,"span"),m(9,"\u4F5C\u8005:"),a(),s(10,"span"),g(11,Zt,2,2,"a",6),a()(),s(12,"div",5)(13,"span"),m(14,"\u7248\u672C:"),a(),s(15,"span"),m(16),a()()(),s(17,"nb-card-footer",7)(18,"button",8),h("click",function(){let i=d(t).$implicit,r=c();return _(r.setup(i.packageName))}),m(19),a()()()()}if(n&2){let t=u.$implicit,e=c();o(3),C(t.name),o(3),I(" ",t.description," "),o(5),l("ngForOf",t.authors),o(5),C(t.version),o(2),l("disabled",t.installed||e.spinner)("nbSpinner",e.spinner),o(),C(t.installed?"\u5DF2\u5B89\u88C5":"\u5B89\u88C5")}}var Rt=(()=>{class n{constructor(t,e,i,r,p){this.http=t,this.toast=e,this.route=i,this.sanitizer=r,this.sidebar=p,this.plugins=[],this.title="",this.spinner=!1}onSpinner(t){this.spinner=t}ngAfterViewInit(){A(0).subscribe(t=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(e=>{e!=="compacted"&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.getPlugins(),this.route.data.subscribe(t=>{this.title=t.title})}getPlugins(){this.http.get(Nt).subscribe(t=>{t.records.length>0&&(this.plugins=t.records)})}setup(t){this.http.post(Ft,{name:t},{context:new y().set(w,this)}).subscribe(e=>{this.getPlugins()})}static{this.\u0275fac=function(e){return new(e||n)(b(F),b(B),b(V),b(lt),b(R))}}static{this.\u0275cmp=T({type:n,selectors:[["app-plugin-market"]],standalone:!1,decls:6,vars:1,consts:[[1,"row"],[1,"col-12"],["class","col-12 col-md-6 col-lg-4 col-xl-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary",3,"click","disabled","nbSpinner"],["target","_blank",1,"d-inline-block","mr-1",3,"href"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header"),m(4," \u63D2\u4EF6\u5E02\u573A "),a()()(),g(5,Jt,20,7,"div",2),a()),e&2&&(o(5),l("ngForOf",i.plugins))},dependencies:[N,D,P,M,k,G,j],encapsulation:2})}}return n})();var ve="/option";var Se="/role",Ie="/role/store",Ee="/role/{id}/update",ye="/role/{id}/delete",we="/site/basic",Te="/site/basic/save",Ne="/site/media",Fe="/site/media/save",Ve="/site/content",ke="/site/content/save",Pe="/site/editor",De="/site/editor/save",Ut="/site/general/save";var Xt=["nbTabsetComponent"];function Yt(n,u){if(n&1){let t=x();s(0,"angular2-smart-table",10),h("create",function(i){d(t);let r=c().index,p=c(2);return _(p.create(i,r))})("edit",function(i){d(t);let r=c().index,p=c(2);return _(p.edit(i,r))})("delete",function(i){d(t);let r=c().index,p=c(2);return _(p.delete(i,r))}),a()}if(n&2){let t=c().index,e=c(2);l("settings",e.settings[t])("source",e.source[t])}}function te(n,u){if(n&1&&(s(0,"button",17),m(1),a()),n&2){let t=c(2).$implicit;o(),C(t.form.reset.name)}}function ee(n,u){if(n&1){let t=x();s(0,"form",11),h("submit",function(){d(t);let i=c(),r=i.$implicit,p=i.index,f=c(2);return _(f.submit(p,r.form.submit.link))}),S(1,"control-container",12),s(2,"div",13),S(3,"label",14),s(4,"div")(5,"button",15),m(6),a(),g(7,te,2,1,"button",16),a()()()}if(n&2){let t=c(),e=t.$implicit,i=t.index,r=c(2);l("ngClass",e.form.class)("formGroup",r.formGroup[i]),o(),l("direction",e.form.direction)("form",r.formGroup[i])("controls",e.form.controls),o(),E(e.form.direction!=="column"?"row":""),o(),E(e.form.direction!=="column"?"col-12 col-md-2":""),o(),E(e.form.direction!=="column"?"col-12 col-md-10":""),o(),l("disabled",e.form.submit.valid&&r.formGroup[i].invalid),o(),C(e.form.submit.name),o(),l("ngIf",e.form.reset)}}function ie(n,u){if(n&1&&(s(0,"nb-tab",9),$(1,3),g(2,Yt,1,2,"angular2-smart-table",5)(3,ee,8,14,"form",6),z(),a()),n&2){let t=u.$implicit,e=u.index;l("active",e==0)("tabTitle",t.title)("tabIndex",e)("tabId",""+e),o(),l("ngSwitch",t.container),o(),l("ngSwitchCase","table"),o(),l("ngSwitchCase","form")}}function ne(n,u){if(n&1){let t=x();s(0,"nb-tabset",7,0),h("changeTab",function(i){d(t);let r=c();return _(r.changeTab(i))}),g(2,ie,4,7,"nb-tab",8),a()}if(n&2){let t=c();o(2),l("ngForOf",t.tabs)}}function re(n,u){if(n&1){let t=x();s(0,"angular2-smart-table",10),h("create",function(i){d(t);let r=c();return _(r.create(i,0))})("edit",function(i){d(t);let r=c();return _(r.edit(i,0))})("delete",function(i){d(t);let r=c();return _(r.delete(i,0))}),a()}if(n&2){let t=c();l("settings",t.settings[0])("source",t.source[0])}}function oe(n,u){if(n&1&&(s(0,"button",17),m(1),a()),n&2){let t=c(2);o(),C(t.form.reset.name)}}function ae(n,u){if(n&1){let t=x();s(0,"form",11),h("submit",function(){d(t);let i=c();return _(i.submit(0,i.form.submit.link))}),S(1,"control-container",12),s(2,"div",18),S(3,"label",14),s(4,"div")(5,"button",19),m(6),a(),g(7,oe,2,1,"button",16),a()()()}if(n&2){let t=c();l("ngClass",t.form.class)("formGroup",t.formGroup[0]),o(),l("direction",t.form.direction)("form",t.formGroup[0])("controls",t.form.controls),o(),E(t.form.direction!=="column"?"row":""),o(),E(t.form.direction!=="column"?"col-12 col-md-2":""),o(),E(t.form.direction!=="column"?"col-12 col-md-10":""),o(),l("disabled",t.form.submit.valid&&t.formGroup[0].invalid),o(),C(t.form.submit.name),o(),l("ngIf",t.form.reset)}}var jt=(()=>{class n{constructor(t,e,i,r){this.http=t,this.toast=e,this.route=i,this.router=r,this.title="",this.container="",this.tabs=[],this.settings=[],this.source=[],this.formGroup=[],this.controlDefaultValues=[],this.pluginLink="",this.editNotify=!1}ngOnInit(){this.route.queryParamMap.subscribe(t=>{let e=t.get("page")??"";if(!e){this.router.navigateByUrl("/404").then();return}this.pluginLink=e.replace("/backend",""),this.http.get(this.pluginLink).subscribe(i=>{switch(this.title=i.title,this.container=i.container,this.container){case"tabs":this.tabs=i.tabs,this.tabs.forEach((r,p)=>{if(r.container=="table")this.source[p]=this.getSource(r.table?.source.default),this.settings[p]=this.getSettings(r.table);else{this.formGroup[p]=new K(q(r.form?.controls));let f={};r.form?.controls.forEach(v=>{f[v.id]=v.value}),this.controlDefaultValues[p]=f}});break;case"form":this.form=i.form,this.formGroup[0]=new K(q(this.form?.controls));break;case"table":this.table=i.table,this.source[0]=this.getSource(this.table.source.default),this.settings[0]=this.getSettings(this.table);break}})})}create(t,e){this.tabSwitch(t,e,"add")}edit(t,e){this.tabSwitch(t,e,"edit")}tabSwitch(t,e,i){let r="";if(this.tabs.length>0?r=this.tabs[e].table?.source[i]:r=this.table?.source[i],r.startsWith("#/"))this.router.navigateByUrl(r);else if(r.startsWith("#")){let p=parseInt(r[1]),f=this.tabsetComponent?.tabs?.get(p);if(f){if(i=="edit")for(let v in this.formGroup[p].controls)this.formGroup[p].controls[v].setValue(t.data[v]);this.editNotify=!0,this.tabsetComponent?.selectTab(f)}}}delete(t,e){let i="";this.tabs.length>0?i=this.tabs[e].table?.source.delete:i=this.table?.source.delete,this.http.post(i,t.data).subscribe()}getSettings(t){let e=t.columns;for(let i in e)(e[i].type==="image"||e[i].type==="status")&&(e[i].type==="image"&&(e[i].valuePrepareFunction=(r,p)=>r?(console.log(p.getRow().getData()),`<img alt="" width="50" src="${p.getRow().getData()[i+"_url"]}" />`):""),e[i].type==="status"&&(e[i].valuePrepareFunction=(r,p)=>{let f=p.getRow().getData(),v=r,Z="primary";return f.hasOwnProperty(i+"_text")&&(v=f[i+"_text"]),f.hasOwnProperty(i+"_class")&&(Z=f[i+"_class"]),`<span class="badge text-bg-${Z}">${v}</span>`}),e[i].type="html");return{actions:{position:"right",add:t.actions.add,edit:t.actions.edit,delete:t.actions.delete,columnTitle:"\u64CD\u4F5C"},add:{addButtonContent:'<i class="nb-plus"></i>',createButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},edit:{editButtonContent:'<i class="nb-edit"></i>',saveButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},delete:{deleteButtonContent:'<i class="nb-trash"></i>',confirmDelete:!0},pager:{perPage:30},mode:"external",columns:e}}getSource(t){return new It(this.http,{endPoint:t,dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}changeTab(t){let e=parseInt(t.tabId);this.editNotify||this.formGroup[e]&&this.formGroup[e].setValue(this.controlDefaultValues[e]),this.editNotify=!1}submit(t,e){this.formGroup[t].invalid||((e==""||e=="#"||e=="/")&&(e=Ut),this.http.post(e,this.formGroup[t].getRawValue(),{params:{page:this.pluginLink}}).subscribe(i=>{}))}static{this.\u0275fac=function(e){return new(e||n)(b(F),b(B),b(V),b(ct))}}static{this.\u0275cmp=T({type:n,selectors:[["app-plugin-feature"]],viewQuery:function(e,i){if(e&1&&Y(Xt,5,U),e&2){let r;tt(r=et())&&(i.tabsetComponent=r.first)}},standalone:!1,decls:10,vars:5,consts:[["nbTabsetComponent",""],[1,"row"],[1,"col-12"],[3,"ngSwitch"],[3,"changeTab",4,"ngSwitchCase"],[3,"settings","source","create","edit","delete",4,"ngSwitchCase"],[3,"ngClass","formGroup","submit",4,"ngSwitchCase"],[3,"changeTab"],[3,"active","tabTitle","tabIndex","tabId",4,"ngFor","ngForOf"],[3,"active","tabTitle","tabIndex","tabId"],[3,"create","edit","delete","settings","source"],[3,"submit","ngClass","formGroup"],[3,"direction","form","controls"],[1,""],[1,"label","col-form-label"],["status","primary","size","small","nbButton","","type","submit",3,"disabled"],["status","danger","class","ms-2","size","small","type","reset","nbButton","",4,"ngIf"],["status","danger","size","small","type","reset","nbButton","",1,"ms-2"],[1,"form-group"],["status","primary","size","small","type","submit","nbButton","",3,"disabled"]],template:function(e,i){e&1&&(s(0,"div",1)(1,"div",2)(2,"nb-card")(3,"nb-card-header"),m(4),a(),s(5,"nb-card-body"),$(6,3),g(7,ne,3,1,"nb-tabset",4)(8,re,1,2,"angular2-smart-table",5)(9,ae,8,14,"form",6),z(),a()()()()),e&2&&(o(4),C(i.title),o(2),l("ngSwitch",i.container),o(),l("ngSwitchCase","tabs"),o(),l("ngSwitchCase","table"),o(),l("ngSwitchCase","form"))},dependencies:[rt,N,L,ot,at,dt,ut,_t,D,P,k,U,ft,G,vt,Et],styles:["[_nghost-%COMP%]     nb-tab{overflow:hidden!important}"]})}}return n})();var se=[{path:"market",title:"\u63D2\u4EF6\u5E02\u573A",component:Rt},{path:"installed",title:"\u5DF2\u5B89\u88C5\u63D2\u4EF6",component:Mt},{path:"feature",component:jt}],ti=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=X({type:n})}static{this.\u0275inj=J({imports:[st,pt.forChild(se),Ct,Tt,ht,St,yt]})}}return n})();export{ve as a,Se as b,Ie as c,Ee as d,ye as e,we as f,Te as g,Ne as h,Fe as i,Ve as j,ke as k,Pe as l,De as m,jt as n,ti as o};
