{"version":3,"file":"441.9171058ae651078f.js","mappings":"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","names":["OPTIONS","ROLES","ROLE_STORE","ROLE_UPDATE","ROLE_DELETE","SITE_BASIC","SITE_BASIC_SAVE","SITE_MEDIA","SITE_MEDIA_SAVE","SITE_CONTENT","SITE_CONTENT_SAVE","SITE_GENERAL_SAVE","UploadService","constructor","http","upload","files","status","forEach","file","formData","FormData","append","name","req","HttpRequest","UPLOAD_FILE","responseType","reportProgress","progress","Subject","response","startTime","Date","getTime","this","request","subscribe","next","event","type","HttpEventType","percentDone","Math","round","loaded","total","HttpResponse","body","complete","error","asObservable","_angular_core__WEBPACK_IMPORTED_MODULE_3__","factory","i0","ctx_r24","FeatureComponent","toast","route","router","ngOnInit","queryParamMap","paramMap","feature","_a","get","pluginLink","replace","res","title","container","tabs","tab","index","source","getSource","table","settings","getSettings","formGroup","buildFormGroup","_b","form","controls","navigateByUrl","then","create","edit","$event","delete","actions","position","add","columnTitle","addButtonContent","createButtonContent","cancelButtonContent","editButtonContent","saveButtonContent","deleteButtonContent","confirmDelete","pager","perPage","mode","columns","endpoint","ServerDataSource","endPoint","dataKey","totalKey","pagerPageKey","pagerLimitKey","filterFieldKey","submit","link","invalid","post","getRawValue","params","page","_angular_core__WEBPACK_IMPORTED_MODULE_0__","selectors","PLUGIN_UPLOAD","ctx_r14","InstalledComponent","dialog","getPlugins","data","records","length","plugins","inactivate","activate","danger","uri","pop","openDownload","url","ref","test","close","remove","alias","core","ctx","MarketComponent","sanitizer","setup","routes","path","component","PluginModule","CommonModule","RouterModule","ThemeModule","UploadModule","NbListModule","Angular2SmartTableModule","ControlModule","DialogComponent","dialogRef","uploadService","Set","onFilesAdded","nativeElement","errorMessage","key","isNaN","parseInt","console","log","nameArray","split","suffix","includes","toLowerCase","join","addFiles","click","closeDialog","uploadSuccessful","finish","emit","results","size","uploading","hasOwnProperty","messages","statusText","message","push","filename","allProgressObservables","primaryButtonText","canBeClosed","showCancelButton","forkJoin","end","decls","UploadComponent","EventEmitter","openUploadDialog","open","closeOnBackdropClick","closeOnEsc","componentRef","instance","multiple","imports","NbButtonModule","NbProgressBarModule","NbCardModule","NbIconModule"],"sourceRoot":"webpack:///","sources":["./dashboard/app/@core/definition/system/api.ts","./dashboard/app/@core/services/upload.service.ts","./dashboard/app/pages/plugin/feature/feature.component.html","./dashboard/app/pages/plugin/feature/feature.component.ts","./dashboard/app/@core/definition/plugin/api.ts","./dashboard/app/pages/plugin/installed/installed.component.html","./dashboard/app/pages/plugin/installed/installed.component.ts","./dashboard/app/pages/plugin/market/market.component.html","./dashboard/app/pages/plugin/market/market.component.ts","./dashboard/app/pages/plugin/plugin.module.ts","./dashboard/app/shared/upload/dialog/dialog.component.html","./dashboard/app/shared/upload/dialog/dialog.component.ts","./dashboard/app/shared/upload/upload.component.ts","./dashboard/app/shared/upload/upload.component.html","./dashboard/app/shared/upload/upload.module.ts"],"sourcesContent":["export const OPTIONS: string = '/option';\nexport const OPTION_STORE: string = '/option/store';\nexport const OPTION_UPDATE: string = '/option/{id}/update';\n\n\nexport const ROLES: string = '/role';\nexport const ROLE_STORE: string = '/role/store';\nexport const ROLE_UPDATE: string = '/role/{id}/update';\nexport const ROLE_DELETE: string = '/role/{id}/delete';\n\n\nexport const SITE_BASIC: string = '/site/basic';\nexport const SITE_BASIC_SAVE: string = '/site/basic/save';\nexport const SITE_MEDIA: string = '/site/media';\nexport const SITE_MEDIA_SAVE: string = '/site/media/save';\n\nexport const SITE_CONTENT: string = '/site/content';\nexport const SITE_CONTENT_SAVE: string = '/site/content/save';\n\nexport const SITE_GENERAL_SAVE: string = '/site/general/save';\n\n\n","import { Injectable } from '@angular/core';\nimport {HttpClient, HttpRequest, HttpResponse, HttpEventType} from '@angular/common/http';\nimport {Observable, Subject} from 'rxjs';\nimport {UPLOAD_FILE} from \"../definition/open/api\";\n\n@Injectable()\nexport class UploadService {\n\n  constructor(private http: HttpClient) {\n\n  }\n\n  // file from event.target.files[0]\n  upload(files: Set<File>): { [p: string]: { progress: Observable<number>, response: Observable<any> } } {\n\n    const status: { [key: string]: { progress: Observable<number>, response: Observable<any> } } = {};\n\n    files.forEach(file => {\n      // create a new multipart-form for every file\n      const formData: FormData = new FormData();\n      formData.append('file', file, file.name);\n\n      // create a http-post request and pass the form\n      // tell it to report the upload progress\n      const req = new HttpRequest('POST', UPLOAD_FILE, formData, {\n        responseType: 'json',\n        reportProgress: true\n      });\n\n      // create a new progress-subject for every file\n      const progress = new Subject<number>();\n      const response = new Subject<any>();\n\n      // send the http-request and subscribe for progress-updates\n\n      const startTime = new Date().getTime();\n      this.http.request(req).subscribe(\n      {\n          next(event) {\n            if (event.type === HttpEventType.UploadProgress) {\n              // calculate the progress percentage\n              const percentDone = Math.round((100 * event.loaded) / event.total!);\n              // pass the percentage into the progress-stream\n              progress.next(percentDone);\n            } else if (event instanceof HttpResponse) {\n              // Close the progress-stream if we get an answer form the API\n              // The upload is complete\n              response.next(event.body);\n              progress.complete();\n            }\n          },\n          error(error) {\n            response.next(error);\n            progress.complete();\n          }\n        }\n      );\n      // Save every progress-observable in a map of all observables\n      status[file.name] = {\n        response: response,\n        progress: progress.asObservable()\n      };\n    });\n\n    // return the map of progress.observables\n    return status;\n  }\n}\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header>{{title}}</nb-card-header>\n      <nb-card-body>\n        <ng-container [ngSwitch]=\"this.container\">\n          <nb-tabset *ngSwitchCase=\"'tabs'\">\n            <nb-tab *ngFor=\"let tab of tabs; let i = index\" [tabTitle]=\"tab.title\" [tabIndex]=\"i\" [tabId]=\"''+i\">\n              <ng-container [ngSwitch]=\"tab.container\">\n                <angular2-smart-table *ngSwitchCase=\"'table'\"\n                                 [settings]=\"this.settings[i]\"\n                                 [source]=\"this.source[i]\"\n                                 (create)=\"create()\"\n                                 (edit)=\"edit($event)\"\n                                 (delete)=\"delete($event)\">\n                </angular2-smart-table>\n                <form [ngClass]=\"tab.form!.class\" *ngSwitchCase=\"'form'\" [formGroup]=\"formGroup[i]\" (submit)=\"submit(i, tab.form!.submit.link)\">\n                  <control-container [direction]=\"tab.form!.direction\" [form]=\"formGroup[i]\" [controls]=\"tab.form!.controls\"></control-container>\n                  <div [class]=\"tab.form!.direction !== 'column' ? 'row' : ''\"  class=\"form-group\">\n                    <label [class]=\"tab.form!.direction !== 'column' ? 'col-12 col-md-2' : ''\" class=\"label col-form-label\"></label>\n                    <div [class]=\"tab.form!.direction !== 'column' ? 'col-12 col-md-10' : ''\">\n                      <button status=\"primary\" size=\"small\" [disabled]=\"tab.form!.submit.valid && formGroup[i].invalid\" nbButton type=\"submit\">{{tab.form!.submit.name}}</button>\n                      <button status=\"danger\" class=\"ms-2\" *ngIf=\"tab.form!.reset\" size=\"small\" type=\"reset\" nbButton>{{tab.form!.reset.name}}</button>\n                    </div>\n                  </div>\n                </form>\n              </ng-container>\n            </nb-tab>\n          </nb-tabset>\n          <angular2-smart-table *ngSwitchCase=\"'table'\"\n             [settings]=\"this.settings[0]\"\n             [source]=\"this.source[0]\"\n             (create)=\"create()\"\n             (edit)=\"edit($event)\"\n             (delete)=\"delete($event)\">\n          </angular2-smart-table>\n          <form [ngClass]=\"this.form!.class\" *ngSwitchCase=\"'form'\" [formGroup]=\"formGroup[0]\" (submit)=\"submit(0, this.form!.submit.link)\">\n            <control-container [direction]=\"this.form!.direction\" [form]=\"formGroup[0]\" [controls]=\"this.form!.controls\"></control-container>\n            <div [class]=\"this.form!.direction !== 'column' ? 'row' : ''\" class=\"form-group\">\n              <label [class]=\"this.form!.direction !== 'column' ? 'col-12 col-md-2' : ''\" class=\"label col-form-label\"></label>\n              <div [class]=\"this.form!.direction !== 'column' ? 'col-12 col-md-10' : ''\">\n                <button status=\"primary\" size=\"small\" [disabled]=\"this.form!.submit.valid && formGroup[0].invalid\" type=\"submit\" nbButton>{{this.form!.submit.name}}</button>\n                <button status=\"danger\" class=\"ms-2\" *ngIf=\"this.form!.reset\" size=\"small\" type=\"reset\" nbButton>{{this.form!.reset.name}}</button>\n              </div>\n            </div>\n          </form>\n        </ng-container>\n      </nb-card-body>\n    </nb-card>\n  </div>\n</div>\n\n","import { Component, OnInit } from '@angular/core';\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute, Router} from \"@angular/router\";\nimport {PluginDrawResponse, DrawTab, DrawTable, DrawForm} from \"../../../@core/definition/plugin/type\";\nimport {buildFormGroup} from \"../../../shared/control/type\";\nimport {FormGroup} from \"@angular/forms\";\nimport {NbToastrService} from \"@nebular/theme\";\nimport {ServerDataSource} from \"angular2-smart-table\";\nimport {Settings} from \"angular2-smart-table/lib/lib/settings\";\nimport {SITE_BASIC, SITE_GENERAL_SAVE} from \"../../../@core/definition/system/api\";\n\n@Component({\n  selector: 'app-plugin-feature',\n  templateUrl: './feature.component.html',\n})\nexport class FeatureComponent implements OnInit {\n\n  title: string = \"\";\n\n  container: string = \"\";\n\n  tabs: DrawTab[] = [];\n\n  form: DrawForm | undefined;\n\n  table: DrawTable | undefined;\n  settings: Settings[] = []\n  source: ServerDataSource[] = [];\n  formGroup: FormGroup[] = [];\n\n  private pluginLink = \"\";\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n    private router: Router,\n  ) {\n\n  }\n\n  ngOnInit(): void {\n    this.route.queryParamMap.subscribe(paramMap => {\n      let feature = paramMap.get('page') ?? '';\n      if (!feature) {\n        this.router.navigateByUrl('/404').then();\n        return ;\n      }\n      this.pluginLink = feature.replace(\"/backend\", \"\");\n      this.http.get<PluginDrawResponse>(this.pluginLink)\n        .subscribe(res => {\n          this.title = res.title;\n          this.container = res.container;\n          switch (this.container) {\n            case 'tabs':\n              this.tabs = res.tabs!;\n              this.tabs.forEach((tab, index) => {\n                if (tab.container == 'table') {\n                  this.source[index] = this.getSource(tab.table?.source!);\n                  this.settings[index] = this.getSettings(tab.table!);\n                } else {\n                  this.formGroup[index] = buildFormGroup(tab.form?.controls!);\n                }\n              });\n              break;\n            case 'form':\n              this.form = res.form;\n              this.formGroup[0] = buildFormGroup(this.form?.controls!)\n              break;\n            case 'table':\n              this.table = res.table!;\n              this.source[0] = this.getSource(this.table.source);\n              this.settings[0] = this.getSettings(this.table);\n              break;\n          }\n        });\n    });\n  }\n\n  create() {\n\n  }\n\n  edit($event: any) {\n\n  }\n\n  delete($event: any) {\n\n  }\n\n  getSettings(table: DrawTable): Settings {\n    return {\n      actions: {\n        position: 'right',\n        add: table.actions.create,\n        edit: table.actions.edit,\n        delete: table.actions.delete,\n        columnTitle: '操作',\n      },\n      add: {\n        addButtonContent: '<i class=\"nb-plus\"></i>',\n        createButtonContent: '<i class=\"nb-checkmark\"></i>',\n        cancelButtonContent: '<i class=\"nb-close\"></i>',\n      },\n      edit: {\n        editButtonContent: '<i class=\"nb-edit\"></i>',\n        saveButtonContent: '<i class=\"nb-checkmark\"></i>',\n        cancelButtonContent: '<i class=\"nb-close\"></i>',\n      },\n      delete: {\n        deleteButtonContent: '<i class=\"nb-trash\"></i>',\n        confirmDelete: true,\n      },\n      pager: {\n        perPage: 30,\n      },\n      mode: 'external',\n      columns: table.columns,\n    };\n  }\n\n  getSource(endpoint: string) {\n    return new ServerDataSource(this.http, {\n      endPoint: endpoint,\n      dataKey: 'records',\n      totalKey: 'total',\n      pagerPageKey: 'page',\n      pagerLimitKey: 'limit',\n      filterFieldKey: '#field#',\n    });\n  }\n\n\n  submit(index: number, link: string) {\n    if (this.formGroup[index].invalid) {\n      return ;\n    }\n    if (link == \"\" || link == \"#\" || link == \"/\") {\n      link = SITE_GENERAL_SAVE;\n    }\n    this.http.post(link, this.formGroup[index].getRawValue(), {\n      params: {page: this.pluginLink}\n    }).subscribe(res => {\n    });\n  }\n}\n","export const PLUGIN_MARKET: string = \"/plugin/market\";\nexport const PLUGIN_SETUP: string = \"/plugin/{name}/setup\";\nexport const PLUGIN_INSTALLED: string = \"/plugin/installed\";\nexport const PLUGIN_DOWN: string = \"/plugin/{name}/down\";\nexport const PLUGIN_UPLOAD: string = \"/plugin/upload\";\nexport const PLUGIN_ACTIVATE: string = \"/plugin/{name}/activate\";\nexport const PLUGIN_DEACTIVATE: string = \"/plugin/{name}/deactivate\";\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header class=\"d-flex justify-content-between align-items-center\">\n        <span>已安装插件列表</span>\n        <div class=\"d-flex\">\n          <button nbButton class=\"me-2\" status=\"danger\" (click)=\"dialog.open(dialogTpl)\">在线下载</button>\n          <app-upload (finish)=\"upload($event)\" [suffix]=\"['zip']\" [status]=\"'primary'\"></app-upload>\n        </div>\n      </nb-card-header>\n    </nb-card>\n  </div>\n  <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\" *ngFor=\"let plugin of plugins\">\n    <nb-card>\n      <nb-card-header>{{plugin.name}}</nb-card-header>\n      <nb-card-body>\n        {{plugin.description}}\n      </nb-card-body>\n      <nb-card-footer>\n        <div class=\"d-flex py-3 justify-content-between\">\n          <span>作者:</span>\n          <span>\n            <a class=\"d-inline-block mr-1\" *ngFor=\"let author of plugin.author\" [href]=\"author.homepage ? author.homepage : 'javascript:;'\" target=\"_blank\">{{author.name}}</a>\n          </span>\n        </div>\n        <div class=\"d-flex py-3 justify-content-between\">\n          <span>版本:</span>\n          <span>{{plugin.version}}</span>\n        </div>\n      </nb-card-footer>\n      <nb-card-footer class=\"d-flex justify-content-between\">\n        <button *ngIf=\"!plugin.enabled\" nbButton status=\"danger\" (click)=\"remove(plugin.alias)\">移除</button>\n        <button nbButton\n                [status]=\"plugin.enabled ? 'danger' : 'primary'\"\n                (click)=\"plugin.enabled ? inactivate(plugin.alias) : activate(plugin.alias)\">\n          {{ plugin.enabled ? '禁用' : '启用' }}\n        </button>\n      </nb-card-footer>\n      <nb-card-footer class=\"d-flex justify-content-between\" *ngIf=\"plugin.actions.length > 0\">\n        <a nbButton\n           status=\"primary\"\n           [routerLink]=\"action.link\"\n           [queryParams]=\"action.query\"\n           *ngFor=\"let action of plugin.actions\">\n          {{ action.name || \"设置\" }}\n        </a>\n      </nb-card-footer>\n    </nb-card>\n  </div>\n</div>\n<ng-template #dialogTpl let-data let-ref=\"dialogRef\">\n  <nb-card>\n    <nb-card-header>在线下载</nb-card-header>\n    <nb-card-body>\n      <input nbInput name=\"url\" type=\"url\" #url placeholder=\"下载地址\" />\n    </nb-card-body>\n    <nb-card-footer class=\"d-flex justify-content-between\">\n      <button nbButton status=\"basic\" (click)=\"ref.close()\">取消</button>\n      <button nbButton status=\"primary\" (click)=\"openDownload(url.value, ref)\">下载</button>\n    </nb-card-footer>\n  </nb-card>\n</ng-template>\n\n","import { Component, OnInit } from '@angular/core';\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {Records, ResponseBody} from \"../../../@core/definition/common\";\nimport {Plugin} from \"../../../@core/definition/plugin/type\";\nimport {PLUGIN_ACTIVATE, PLUGIN_DOWN, PLUGIN_DEACTIVATE, PLUGIN_INSTALLED, PLUGIN_UPLOAD} from \"../../../@core/definition/plugin/api\";\nimport {NbDialogService, NbToastrService} from \"@nebular/theme\";\nimport {DialogRef} from \"@angular/cdk/dialog\";\n\n@Component({\n  selector: 'app-plugin-installed',\n  templateUrl: './installed.component.html',\n})\nexport class InstalledComponent implements OnInit {\n\n  plugins: Plugin[] = [];\n\n  title: string = \"\";\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n    public dialog: NbDialogService,\n  ) {\n\n  }\n\n  ngOnInit(): void {\n    this.getPlugins();\n    this.route.data.subscribe((data) => {\n      this.title = data['title'];\n    });\n  }\n\n  private getPlugins() {\n    this.http.get<Records<Plugin>>(PLUGIN_INSTALLED).subscribe(res => {\n      if (res.records.length > 0) {\n        this.plugins = res.records\n      }\n    });\n  }\n\n  inactivate(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_DEACTIVATE, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n\n  activate(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_ACTIVATE, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n\n  upload(files: string[]) {\n    if (files.length < 1) {\n      this.toast.danger('上传的插件文件为空', '上传插件');\n      return ;\n    }\n    this.http.post<ResponseBody>(PLUGIN_UPLOAD, {uri: files.pop()}).subscribe(res => {\n      this.getPlugins()\n    });\n  }\n\n  openDownload(url: string, ref: DialogRef) {\n    let isMatch = /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/.test(url);\n    if (!isMatch) {\n      this.toast.danger( '不合法的url链接', '在线下载');\n      return\n    }\n    this.http.post<ResponseBody>(PLUGIN_UPLOAD, {uri: url}).subscribe(res => {\n      ref.close();\n      this.getPlugins()\n    });\n  }\n\n  remove(alias: string) {\n    this.http.post<ResponseBody>(PLUGIN_DOWN, {name: alias}).subscribe(res => {\n      this.getPlugins()\n    });\n  }\n}\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <nb-card>\n      <nb-card-header>\n        插件市场\n      </nb-card-header>\n    </nb-card>\n  </div>\n  <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\" *ngFor=\"let plugin of plugins\">\n    <nb-card>\n      <nb-card-header>{{plugin.name}}</nb-card-header>\n      <nb-card-body>\n        <img alt=\"{{plugin.name}}\" [src]=\"sanitizer.bypassSecurityTrustResourceUrl(plugin.image)\" *ngIf=\"plugin.image\" width=\"100%\"/>\n      </nb-card-body>\n      <nb-card-footer class=\"d-flex justify-content-end\">\n        <button nbButton status=\"primary\" (click)=\"setup(plugin.alias)\" [disabled]=\"plugin.enabled\">{{ plugin.enabled ? '已安装' : '现在安装' }}</button>\n      </nb-card-footer>\n    </nb-card>\n  </div>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport {Records, ResponseBody} from \"../../../@core/definition/common\";\nimport {Plugin} from \"../../../@core/definition/plugin/type\";\nimport {PLUGIN_MARKET, PLUGIN_SETUP} from \"../../../@core/definition/plugin/api\";\nimport {HttpClient} from \"@angular/common/http\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {NbToastrService} from \"@nebular/theme\";\n\n@Component({\n  selector: 'app-plugin-market',\n  templateUrl: './market.component.html',\n})\nexport class MarketComponent implements OnInit {\n  plugins: Plugin[] = [];\n\n  title: string = \"\";\n\n  constructor(\n    private http: HttpClient,\n    private toast: NbToastrService,\n    private route: ActivatedRoute,\n    public sanitizer: DomSanitizer\n  ) {\n\n  }\n  ngOnInit(): void {\n    this.getPlugins();\n    this.route.data.subscribe((data) => {\n      this.title = data['title'];\n    });\n  }\n\n  private getPlugins() {\n    this.http.get<Records<Plugin>>(PLUGIN_MARKET).subscribe(res => {\n      if (res.records.length > 0) {\n        this.plugins = res.records\n      }\n    });\n  }\n\n  setup(name: string) {\n    this.http.post<ResponseBody>(PLUGIN_SETUP, {name: name}).subscribe(res => {\n      this.getPlugins();\n    });\n  }\n}\n","import {NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\n\nimport {ThemeModule} from \"../../@theme/theme.module\";\nimport {UploadModule} from \"../../shared/upload/upload.module\";\nimport {InstalledComponent} from \"./installed/installed.component\";\nimport {MarketComponent} from \"./market/market.component\";\nimport {NbListModule} from \"@nebular/theme\";\nimport {FeatureComponent} from \"./feature/feature.component\";\nimport {ControlModule} from \"../../shared/control/control.module\";\nimport {Angular2SmartTableModule} from \"angular2-smart-table\";\nimport {RouterModule, Routes} from \"@angular/router\";\n\nconst routes: Routes = [\n  {\n    path: \"market\",\n    title: '插件市场',\n    component: MarketComponent,\n  },\n  {\n    path: \"installed\",\n    title: '已安装插件',\n    component: InstalledComponent,\n  },\n  {\n    path: \"feature\",\n    component: FeatureComponent,\n  },\n];\n\n@NgModule({\n  declarations: [\n    InstalledComponent, MarketComponent, FeatureComponent,\n  ],\n  exports: [\n    FeatureComponent,\n  ],\n  imports: [\n    CommonModule,\n    RouterModule.forChild(routes),\n    ThemeModule,\n    UploadModule,\n    NbListModule,\n    Angular2SmartTableModule,\n    ControlModule,\n  ]\n})\nexport class PluginModule {\n}\n","<div class=\"row\">\n  <div class=\"col-12\">\n    <input type=\"file\" #file style=\"display: none\"  (change)=\"onFilesAdded()\" [multiple]=\"multiple\"/>\n    <nb-card class=\"list-card\">\n      <nb-card-header class=\"d-flex justify-content-between align-items-center\">\n        <span>上传文件</span>\n        <button [disabled]=\"uploading || uploadSuccessful\" nbButton status=\"primary\" (click)=\"addFiles()\">添加文件</button>\n      </nb-card-header>\n      <nb-card-body>\n        <nb-list>\n          <nb-list-item *ngFor=\"let file of files;\">\n            <div class=\"row flex-grow-1 flex-nowrap\">\n              <div class=\"col-1\">\n                <nb-icon status=\"primary\" icon=\"file\"></nb-icon>\n              </div>\n              <div class=\"col-5\">\n                {{file.name}}\n              </div>\n              <div class=\"col-5\">\n                <nb-progress-bar\n                  *ngIf=\"progress\"\n                  [status]=\"messages[file.name] ? 'danger' : 'success'\"\n                  [displayValue]=\"!messages[file.name]\"\n                  [value]=\"progress[file.name].progress | async\">\n                  {{messages[file.name]}}\n                </nb-progress-bar>\n              </div>\n              <div class=\"col-1\" *ngIf=\"!uploading && !uploadSuccessful\">\n                <nb-icon style=\"cursor: pointer\" (click)=\"remove(file)\" icon=\"close\" status=\"danger\"></nb-icon>\n              </div>\n            </div>\n          </nb-list-item>\n        </nb-list>\n      </nb-card-body>\n      <nb-card-footer class=\"actions\">\n        <div class=\"row\">\n          <div class=\"col-12 text-danger py-2\" *ngIf=\"errorMessage.length > 0\">\n            {{ errorMessage }}\n          </div>\n          <div class=\"col-12 d-flex justify-content-between\">\n            <button *ngIf=\"showCancelButton\" nbButton status=\"control\" (click)=\"dialogRef.close();\" class=\"mr-2\">取消</button>\n            <button nbButton status=\"primary\" [disabled]=\"!canBeClosed || files.size < 1\" (click)=\"closeDialog()\">{{primaryButtonText}}</button>\n          </div>\n        </div>\n      </nb-card-footer>\n    </nb-card>\n  </div>\n</div>\n","import {Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild} from '@angular/core';\nimport {forkJoin, Observable} from 'rxjs';\nimport {UploadService} from '../../../@core/services/upload.service';\nimport {NbDialogRef} from '@nebular/theme';\n\n@Component({\n  selector: 'app-dialog',\n  templateUrl: './dialog.component.html',\n  providers: [\n    UploadService,\n  ],\n  styles: [\n    `\n    nb-card {\n      min-width: 290px;\n    }\n    .list-card {\n      nb-card-header {\n        border-bottom: none;\n      }\n      nb-card-footer {\n        border-top: none;\n      }\n      nb-card-body {\n        padding: 0;\n      }\n    }\n    `\n  ]\n})\nexport class DialogComponent implements OnInit {\n\n  constructor(public dialogRef: NbDialogRef<DialogComponent>,\n              private uploadService: UploadService) {\n\n  }\n  @ViewChild('file', { static: false }) file: ElementRef | undefined;\n\n  public files: Set<File> = new Set();\n\n  @Input() multiple: boolean = false;\n  @Input() suffix: string[] = [];\n\n  @Output() finish: EventEmitter<string[]> | undefined;\n\n  progress!: {[key: string]: { progress: Observable<any>, response: Observable<any> }};\n  canBeClosed = true;\n  primaryButtonText = '上传';\n  showCancelButton = true;\n  uploading = false;\n  uploadSuccessful = false;\n  messages: {[key: string]: string} = {};\n  errorMessage = '';\n\n  results: any[] = [];\n\n  ngOnInit() {}\n\n  onFilesAdded() {\n    const files: { [key: string]: File } = this.file?.nativeElement.files;\n    let errorMessage = '';\n    for (const key in files) {\n      if (isNaN(parseInt(key, 10))) {\n        continue;\n      }\n      let file = files[key];\n      console.log(file)\n      let nameArray = file.name.split('.');\n      let suffix = nameArray[nameArray.length - 1];\n      if (this.suffix.length > 0 && !this.suffix.includes(suffix.toLowerCase())) {\n        errorMessage = '此文件类型不支持，只支持: ' + this.suffix.join(',') + '文件格式';\n        continue;\n      }\n      this.files.add(file);\n    }\n    this.errorMessage = errorMessage;\n  }\n\n  addFiles() {\n    this.file?.nativeElement.click();\n  }\n\n  closeDialog() {\n    // if everything was uploaded already, just close the dialog\n    if (this.uploadSuccessful) {\n      this.finish?.emit(this.results);\n      return this.dialogRef.close();\n    }\n    if (this.files.size < 1) {\n      this.errorMessage = '选择需要上传的文件!';\n      return ;\n    }\n\n    // set the component state to \"uploading\"\n    this.uploading = true;\n\n    // start the upload and save the progress map\n    this.progress = this.uploadService.upload(this.files);\n    for (const key in this.progress) {\n      this.progress[key].progress.subscribe((res: any)=> console.log(res));\n      this.progress[key].response.subscribe((res: any) => {\n        if (res.hasOwnProperty('statusText')) {\n          this.messages[key] = res.statusText;\n        } else if (res.hasOwnProperty('status') && res.status != 'ok') {\n          this.messages[key] = res.message;\n        } else {\n          this.results.push(res.filename);\n        }\n      });\n    }\n\n    // convert the progress map into an array\n    const allProgressObservables = [];\n    for (const key in this.progress) {\n      allProgressObservables.push(this.progress[key].progress);\n    }\n\n    // Adjust the state variables\n\n    // The OK-button should have the text \"Finish\" now\n    this.primaryButtonText = '完成';\n\n    // The dialog should not be closed while uploading\n    this.canBeClosed = false;\n    // this.dialogRef.disableClose = true;\n\n    // Hide the cancel-button\n    this.showCancelButton = false;\n\n    // When all progress-observables are completed...\n    forkJoin(allProgressObservables).subscribe(end => {\n      // ... the dialog can be closed again...\n      this.canBeClosed = true;\n      // this.dialogRef.disableClose = false;\n\n      // ... the upload was successful...\n      this.uploadSuccessful = true;\n\n      // ... and the component is no longer uploading\n      this.uploading = false;\n    });\n  }\n\n  remove(file: File) {\n    this.files.delete(file);\n  }\n}\n","import {Component, EventEmitter, Input, OnChanges, Output, SimpleChanges} from '@angular/core';\nimport {DialogComponent} from './dialog/dialog.component';\nimport {NbDialogService} from '@nebular/theme';\nimport {NbComponentStatus} from \"@nebular/theme/components/component-status\";\n\n@Component({\n  selector: 'app-upload',\n  templateUrl: './upload.component.html',\n  styles: [\n    `:host {display: block}`\n  ]\n})\nexport class UploadComponent {\n\n  @Input() multiple = false;\n  @Input() text = '上传';\n  @Input() status: NbComponentStatus = 'primary';\n  @Input() suffix: string[] = [];\n\n  @Output() finish: EventEmitter<string[]> = new EventEmitter();\n\n  constructor(private dialog: NbDialogService) { }\n\n  openUploadDialog() {\n    const dialogRef = this.dialog.open(DialogComponent, {\n      closeOnBackdropClick: false,\n      closeOnEsc: false,\n    });\n    dialogRef.componentRef.instance.multiple = this.multiple;\n    dialogRef.componentRef.instance.finish = this.finish;\n    dialogRef.componentRef.instance.suffix = this.suffix;\n  }\n}\n","<button (click)=\"openUploadDialog()\" type=\"button\" nbButton [status]=\"status\">{{ text }}</button>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {UploadComponent} from './upload.component';\nimport {DialogComponent} from './dialog/dialog.component';\nimport {NbButtonModule, NbCardModule, NbIconModule, NbListModule, NbProgressBarModule} from '@nebular/theme';\nimport {UploadService} from '../../@core/services/upload.service';\n\n\n\n@NgModule({\n  declarations: [UploadComponent, DialogComponent],\n  exports: [\n    UploadComponent\n  ],\n  imports: [\n    CommonModule,\n    NbButtonModule,\n    NbProgressBarModule,\n    NbListModule,\n    NbCardModule,\n    NbIconModule\n  ],\n  providers: [\n    UploadService\n  ]\n})\nexport class UploadModule { }\n"],"x_google_ignoreList":[]}