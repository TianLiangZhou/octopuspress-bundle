import{s as ue}from"./chunk-QJO7QQNE.js";import{Cb as Q,Db as $,Ea as o,Fa as r,Ga as P,Ka as v,La as c,M as B,Ma as u,N,Ob as z,P as T,Pb as J,Qb as G,S as g,T as h,Ta as V,Tb as K,Ua as j,Va as U,Xa as p,Y as O,Ya as w,Za as D,cb as R,ge as re,hb as A,he as le,ia as l,ib as L,j as M,na as x,nd as W,od as X,pa as y,pd as Y,qa as F,qd as Z,rd as ee,s as E,sd as te,td as ie,ua as _,ue as ae,vb as H,vd as S,ve as pe,wb as q,wd as ne,we as ce,ya as a,yd as oe,zd as se}from"./chunk-J7X6RXHA.js";var b=(()=>{class n{constructor(t){this.http=t}upload(t){let e={};return t.forEach(i=>{let s=new FormData;s.append("file",i,i.name);let m=new z("POST",ue,s,{responseType:"json",reportProgress:!0}),f=new M,I=new M,ve=new Date().getTime();this.http.request(m).subscribe({next(d){if(d.type===J.UploadProgress){let de=Math.round(100*d.loaded/d.total);f.next(de)}else d instanceof G&&(I.next(d.body),f.complete())},error(d){I.next(d),f.complete()}}),e[i.name]={response:I,progress:f.asObservable()}}),e}static{this.\u0275fac=function(e){return new(e||n)(T(K))}}static{this.\u0275prov=B({token:n,factory:n.\u0275fac})}}return n})();var he=["file"];function _e(n,C){if(n&1&&(o(0,"nb-progress-bar",18),A(1,"async"),p(2),r()),n&2){let t=u().$implicit,e=u();a("status",e.messages[t.name]?"danger":"success")("displayValue",!e.messages[t.name])("value",L(1,4,e.progress[t.name].progress)),l(2),D(" ",e.messages[t.name]," ")}}function be(n,C){if(n&1){let t=v();o(0,"div",13)(1,"nb-icon",19),c("click",function(){g(t);let i=u().$implicit,s=u();return h(s.remove(i))}),r()()}}function Ce(n,C){if(n&1&&(o(0,"nb-list-item")(1,"div",12)(2,"div",13),P(3,"nb-icon",14),r(),o(4,"div",15),p(5),r(),o(6,"div",15),_(7,_e,3,6,"nb-progress-bar",16),r(),_(8,be,2,0,"div",17),r()()),n&2){let t=C.$implicit,e=u();l(5),D(" ",t.name," "),l(2),a("ngIf",e.progress),l(),a("ngIf",!e.uploading&&!e.uploadSuccessful)}}function xe(n,C){if(n&1&&(o(0,"div",20),p(1),r()),n&2){let t=u();l(),D(" ",t.errorMessage," ")}}function ye(n,C){if(n&1){let t=v();o(0,"button",21),c("click",function(){g(t);let i=u();return h(i.dialogRef.close())}),p(1,"\u53D6\u6D88"),r()}}var me=(()=>{class n{constructor(t,e){this.dialogRef=t,this.uploadService=e,this.files=new Set,this.multiple=!1,this.suffix=[],this.canBeClosed=!0,this.primaryButtonText="\u4E0A\u4F20",this.showCancelButton=!0,this.uploading=!1,this.uploadSuccessful=!1,this.messages={},this.errorMessage="",this.results=[]}ngOnInit(){}onFilesAdded(){let t=this.file?.nativeElement.files,e="";for(let i in t){if(isNaN(parseInt(i,10)))continue;let s=t[i];console.log(s);let m=s.name.split("."),f=m[m.length-1];if(this.suffix.length>0&&!this.suffix.includes(f.toLowerCase())){e="\u6B64\u6587\u4EF6\u7C7B\u578B\u4E0D\u652F\u6301\uFF0C\u53EA\u652F\u6301: "+this.suffix.join(",")+"\u6587\u4EF6\u683C\u5F0F";continue}this.files.add(s)}this.errorMessage=e}addFiles(){this.file?.nativeElement.click()}closeDialog(){if(this.uploadSuccessful)return this.finish?.emit(this.results),this.dialogRef.close();if(this.files.size<1){this.errorMessage="\u9009\u62E9\u9700\u8981\u4E0A\u4F20\u7684\u6587\u4EF6!";return}this.uploading=!0,this.progress=this.uploadService.upload(this.files);for(let e in this.progress)this.progress[e].progress.subscribe(i=>console.log(i)),this.progress[e].response.subscribe(i=>{i.hasOwnProperty("statusText")?this.messages[e]=i.statusText:i.hasOwnProperty("status")&&i.status!="ok"?this.messages[e]=i.message:this.results.push(i.filename)});let t=[];for(let e in this.progress)t.push(this.progress[e].progress);this.primaryButtonText="\u5B8C\u6210",this.canBeClosed=!1,this.showCancelButton=!1,E(t).subscribe(e=>{this.canBeClosed=!0,this.uploadSuccessful=!0,this.uploading=!1})}remove(t){this.files.delete(t)}static{this.\u0275fac=function(e){return new(e||n)(x(pe),x(b))}}static{this.\u0275cmp=y({type:n,selectors:[["app-dialog"]],viewQuery:function(e,i){if(e&1&&V(he,5),e&2){let s;j(s=U())&&(i.file=s.first)}},inputs:{multiple:"multiple",suffix:"suffix"},outputs:{finish:"finish"},standalone:!1,features:[R([b])],decls:20,vars:7,consts:[["file",""],[1,"row"],[1,"col-12"],["type","file",2,"display","none",3,"change","multiple"],[1,"list-card"],[1,"d-flex","justify-content-between","align-items-center"],["nbButton","","status","primary",3,"click","disabled"],[4,"ngFor","ngForOf"],[1,"actions"],["class","col-12 text-danger py-2",4,"ngIf"],[1,"col-12","d-flex","justify-content-between"],["nbButton","","status","control","class","mr-2",3,"click",4,"ngIf"],[1,"row","flex-grow-1","flex-nowrap"],[1,"col-1"],["status","primary","icon","file"],[1,"col-5"],[3,"status","displayValue","value",4,"ngIf"],["class","col-1",4,"ngIf"],[3,"status","displayValue","value"],["icon","close","status","danger",2,"cursor","pointer",3,"click"],[1,"col-12","text-danger","py-2"],["nbButton","","status","control",1,"mr-2",3,"click"]],template:function(e,i){if(e&1){let s=v();o(0,"div",1)(1,"div",2)(2,"input",3,0),c("change",function(){return g(s),h(i.onFilesAdded())}),r(),o(4,"nb-card",4)(5,"nb-card-header",5)(6,"span"),p(7,"\u4E0A\u4F20\u6587\u4EF6"),r(),o(8,"button",6),c("click",function(){return g(s),h(i.addFiles())}),p(9,"\u6DFB\u52A0\u6587\u4EF6"),r()(),o(10,"nb-card-body")(11,"nb-list"),_(12,Ce,9,3,"nb-list-item",7),r()(),o(13,"nb-card-footer",8)(14,"div",1),_(15,xe,2,1,"div",9),o(16,"div",10),_(17,ye,2,0,"button",11),o(18,"button",6),c("click",function(){return g(s),h(i.closeDialog())}),p(19),r()()()()()()()}e&2&&(l(2),a("multiple",i.multiple),l(6),a("disabled",i.uploading||i.uploadSuccessful),l(4),a("ngForOf",i.files),l(3),a("ngIf",i.errorMessage.length>0),l(2),a("ngIf",i.showCancelButton),l(),a("disabled",!i.canBeClosed||i.files.size<1),l(),w(i.primaryButtonText))},dependencies:[H,q,S,re,oe,se,te,Z,ee,Y,W,Q],styles:["nb-card[_ngcontent-%COMP%]{min-width:290px}.list-card[_ngcontent-%COMP%]   nb-card-header[_ngcontent-%COMP%]{border-bottom:none}.list-card[_ngcontent-%COMP%]   nb-card-footer[_ngcontent-%COMP%]{border-top:none}.list-card[_ngcontent-%COMP%]   nb-card-body[_ngcontent-%COMP%]{padding:0}"]})}}return n})();var Ve=(()=>{class n{constructor(t){this.dialog=t,this.multiple=!1,this.text="\u4E0A\u4F20",this.status="primary",this.suffix=[],this.finish=new O}openUploadDialog(){let t=this.dialog.open(me,{closeOnBackdropClick:!1,closeOnEsc:!1});t.componentRef.instance.multiple=this.multiple,t.componentRef.instance.finish=this.finish,t.componentRef.instance.suffix=this.suffix}static{this.\u0275fac=function(e){return new(e||n)(x(ce))}}static{this.\u0275cmp=y({type:n,selectors:[["app-upload"]],inputs:{multiple:"multiple",text:"text",status:"status",suffix:"suffix"},outputs:{finish:"finish"},standalone:!1,decls:2,vars:2,consts:[["type","button","nbButton","",3,"click","status"]],template:function(e,i){e&1&&(o(0,"button",0),c("click",function(){return i.openUploadDialog()}),p(1),r()),e&2&&(a("status",i.status),l(),w(i.text))},dependencies:[S],styles:["[_nghost-%COMP%]{display:block}"]})}}return n})();var $e=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=N({providers:[b],imports:[$,ne,le,ae,ie,X]})}}return n})();export{Ve as a,$e as b};
