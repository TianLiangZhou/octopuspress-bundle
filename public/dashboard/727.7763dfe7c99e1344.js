"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[727],{3727:(S,g,r)=>{r.r(g),r.d(g,{CommentModule:()=>y});var p=r(8692),t=r(4537),c=r(5732),d=r(9598),s=r(92),b=r(9024),h=r(6221),v=r(5729),a=r(9467);function C(o,i){if(1&o&&(t.TgZ(0,"nb-radio",7),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.label)}}function f(o,i){if(1&o&&(t.TgZ(0,"nb-option",7),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.label)}}function _(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"nb-action",2),t.NdJ("click",function(){const m=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.click(m.value))}),t.qZA()}if(2&o){const e=i.$implicit,n=i.index,l=t.oxw();t.ekj("ps-0",0==n),t.Q6J("link","edit"==e.value?"/app/comment/"+l.rowData.id:"")("title",e.title)("icon",e.icon)}}function Z(o,i){if(1&o&&(t.TgZ(0,"nb-radio",19),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.label)}}function M(o,i){if(1&o&&(t.TgZ(0,"div",10)(1,"label",14),t._uU(2,"\u56de\u5e94\u7ed9: "),t.qZA(),t.TgZ(3,"h6",11)(4,"a",20),t._uU(5),t.qZA()()()),2&o){const e=t.oxw();t.xp6(4),t.MGl("href","#/app/content/edit-post/",e.comment.post.id,"",t.LSH),t.xp6(1),t.Oqu(e.comment.post.title)}}let T=(()=>{class o{constructor(e,n,l){this.http=e,this.activatedRoute=n,this.configService=l,this.radioFilter=new s.NI("all"),this.radios=[],this.settings={},this.batches=[{label:"\u6279\u91cf\u64cd\u4f5c",value:""},{label:"\u9a73\u56de",value:"unapproved"},{label:"\u6279\u51c6",value:"approved"},{label:"\u6807\u8bb0\u4e3a\u5783\u573e",value:"spam"},{label:"\u79fb\u81f3\u56de\u6536\u7ad9",value:"trash"}],this.batchMode="",this.spinner=!1,this.route=n.snapshot}ngOnInit(){this.settings=this.buildSettings(),this.loadStatistics(),this.loadSource("all"),this.radioFilter.valueChanges.subscribe(e=>{this.loadSource(e)})}loadStatistics(){this.http.get("/comment/statistics").subscribe(e=>{this.radios=[{label:`\u5168\u90e8 (${e.all})`,value:"all"},{label:`\u6211\u7684 (${e.my})`,value:"my"},{label:`\u5f85\u5ba1 (${e.unapproved})`,value:"unapproved"},{label:`\u5df2\u6279\u51c6 (${e.approved})`,value:"approved"},{label:`\u5783\u573e (${e.spam})`,value:"spam"},{label:`\u56de\u6536\u7ad9 (${e.trash})`,value:"trash"}]})}loadSource(e){this.source=new d.zV(this.http,{endPoint:"/comment?statusFilter="+e,dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}edit(e){}batch(){if(""==this.batchMode)return;const e=[];this.source.getSelectedItems().forEach(n=>{e.push(n.id)}),!(e.length<1)&&this.updateStatus(this.batchMode,e)}updateStatus(e,n){this.http.post("/comment/"+e,{id:n},{context:(new c.qT).set(b.a,this)}).subscribe(()=>{this.loadStatistics(),this.loadSource(this.radioFilter.value)})}buildSettings(){return{selectMode:"multi",actions:{position:"right",add:!1,edit:!1,delete:!1,columnTitle:"\u64cd\u4f5c"},pager:{perPage:30},mode:"external",columns:{author:{title:"\u4f5c\u8005",type:d.Jm.Html,classContent:"d-flex flex-column",valuePrepareFunction:function(e){return e.join("")},filter:!1},content:{title:"\u8bc4\u8bba",filter:!0,type:d.Jm.Custom,renderComponent:A,onComponentInitFunction:e=>{e.onClick().subscribe(n=>{this.updateStatus(n.action,[n.id])})}},post:{title:"\u56de\u590d\u81f3",type:d.Jm.Html,classContent:"d-flex flex-column",valuePrepareFunction:function(e){return e.join("")},filter:!1},createdAt:{title:"\u8bc4\u8bba\u4e8e",filter:!1}}}}onSpinner(e){this.spinner=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.eN),t.Y36(h.gz),t.Y36(v.eB))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-comment"]],decls:13,vars:9,consts:[[1,"d-flex","flex-row","mb-2",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[1,"row","mb-2",3,"ngSubmit"],["name","batchMode",1,"col-auto",3,"ngModel","ngModelChange"],[1,"col-auto"],["nbButton","","status","primary","type","submit",3,"disabled","nbSpinner"],[3,"settings","source","edit"],[3,"value"]],template:function(e,n){1&e&&(t.TgZ(0,"nb-card")(1,"nb-card-header"),t._uU(2),t.qZA(),t.TgZ(3,"nb-card-body")(4,"nb-radio-group",0),t.YNc(5,C,2,2,"nb-radio",1),t.qZA(),t.TgZ(6,"form",2),t.NdJ("ngSubmit",function(){return n.batch()}),t.TgZ(7,"nb-select",3),t.NdJ("ngModelChange",function(m){return n.batchMode=m}),t.YNc(8,f,2,2,"nb-option",1),t.qZA(),t.TgZ(9,"div",4)(10,"button",5),t._uU(11,"\u5e94\u7528"),t.qZA()()(),t.TgZ(12,"angular2-smart-table",6),t.NdJ("edit",function(m){return n.edit(m)}),t.qZA()()()),2&e&&(t.xp6(2),t.Oqu(n.route.title),t.xp6(2),t.Q6J("formControl",n.radioFilter),t.xp6(1),t.Q6J("ngForOf",n.radios),t.xp6(2),t.Q6J("ngModel",n.batchMode),t.xp6(1),t.Q6J("ngForOf",n.batches),t.xp6(2),t.Q6J("disabled",!n.batchMode||n.spinner)("nbSpinner",n.spinner),t.xp6(2),t.Q6J("settings",n.settings)("source",n.source))},dependencies:[p.sg,s._Y,s.JJ,s.JL,s.On,s.F,s.oH,a.Asz,a.yKW,a.ndF,a.DPz,a.Q7R,a.r3g,a.MFI,a.rs,a.q51,d.i0]}),o})(),A=(()=>{class o{constructor(e){this.http=e,this.actionClick=new t.vpe,this.actions=[]}onClick(){return this.actionClick}click(e){return"edit"===e||this.actionClick.emit({action:e,id:this.rowData.id}),!1}ngOnInit(){const n=[];switch(this.rowData.approved){case"approved":n.push({title:"\u9a73\u56de",icon:"slash-outline",value:"unapproved"},{title:"\u7f16\u8f91",icon:"edit-2-outline",value:"edit"},{title:"\u6807\u8bb0\u4e3a\u5783\u573e",icon:"bookmark-outline",value:"spam"},{title:"\u79fb\u81f3\u56de\u6536\u7ad9",icon:"trash-2-outline",value:"trash"});break;case"unapproved":n.push({title:"\u6279\u51c6",icon:"checkmark-circle-outline",value:"approved"},{title:"\u7f16\u8f91",icon:"edit-2-outline",value:"edit"},{title:"\u6807\u8bb0\u4e3a\u5783\u573e",icon:"bookmark-outline",value:"spam"},{title:"\u79fb\u81f3\u56de\u6536\u7ad9",icon:"trash-2-outline",value:"trash"});break;case"spam":n.push({title:"\u4e0d\u662f\u5783\u573e\u8bc4\u8bba",icon:"undo-outline",value:"unapproved"},{title:"\u6c38\u4e45\u5220\u9664",icon:"trash-outline",value:"delete"});break;case"trash":n.push({title:"\u6807\u8bb0\u4e3a\u5783\u573e",icon:"bookmark-outline",value:"spam"},{title:"\u8fd8\u539f",icon:"undo-outline",value:"unapproved"},{title:"\u6c38\u4e45\u5220\u9664",icon:"trash-outline",value:"delete"})}this.actions=n}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.eN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-comment-actions"]],inputs:{value:"value",rowData:"rowData"},decls:4,vars:2,consts:[[1,"py-3"],[3,"ps-0","link","title","icon","click",4,"ngFor","ngForOf"],[3,"link","title","icon","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._uU(1),t.qZA(),t.TgZ(2,"nb-actions"),t.YNc(3,_,1,5,"nb-action",1),t.qZA()),2&e&&(t.xp6(1),t.Oqu(n.value),t.xp6(2),t.Q6J("ngForOf",n.actions))},dependencies:[p.sg,a.Bk3,a.lYD],styles:["[_nghost-%COMP%]   nb-actions[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]:hover   nb-actions[_ngcontent-%COMP%]{visibility:visible}"]}),o})(),F=(()=>{class o{constructor(e,n,l){this.http=e,this.route=n,this.location=l,this.comment={},this.options=[]}ngOnInit(){this.route.paramMap.subscribe(e=>{let n=parseInt(e.get("id"),10);n>0&&this.http.get("/comment/"+n).subscribe(l=>{this.comment=l,this.options=[{label:"\u6279\u51c6",value:"approved"},{label:"unapproved"===this.comment.approved?"\u5f85\u5ba1":"\u9a73\u56de",value:"unapproved"},{label:"\u6807\u8bb0\u4e3a\u5783\u573e",value:"spam"}],("spam"==this.comment.approved||"trash"==this.comment.approved)&&this.location.back()})})}onSubmit(e){console.log(e.invalid,e.valid),!e.invalid&&this.comment.id&&this.http.post("/comment/{id}/update",this.comment).subscribe(()=>{this.location.back()})}getStatus(e){var n;return null===(n=this.options.find(l=>l.value==e))||void 0===n?void 0:n.label}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.eN),t.Y36(h.gz),t.Y36(p.S$))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-comment-edit"]],decls:44,vars:10,consts:[[1,"row",3,"ngSubmit"],["f","ngForm"],[1,"col-9"],[1,"mb-3"],[1,"label","form-label"],["nbInput","","fullWidth","","name","author","status","primary",3,"ngModel","ngModelChange"],["nbInput","","fullWidth","","name","email","type","email","status","primary",3,"ngModel","ngModelChange"],["nbInput","","fullWidth","","name","url","type","url","status","primary",3,"ngModel","ngModelChange"],["nbInput","","fullWidth","","name","content","rows","5","status","primary",3,"ngModel","ngModelChange"],[1,"col-3"],[1,"d-flex","align-items-center"],[1,"ms-2"],["name","approved",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"label"],["class","d-flex align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between"],["href","#"],["nbButton","","status","primary","size","small","type","submit",3,"disabled"],[3,"value"],[3,"href"]],template:function(e,n){if(1&e){const l=t.EpF();t.TgZ(0,"form",0,1),t.NdJ("ngSubmit",function(){t.CHM(l);const u=t.MAs(1);return t.KtG(n.onSubmit(u))}),t.TgZ(2,"div",2)(3,"nb-card")(4,"nb-card-body")(5,"div",3)(6,"label",4),t._uU(7,"\u4f5c\u8005\u663e\u793a\u540d\u79f0:"),t.qZA(),t.TgZ(8,"input",5),t.NdJ("ngModelChange",function(u){return n.comment.author=u}),t.qZA()(),t.TgZ(9,"div",3)(10,"label",4),t._uU(11,"\u4f5c\u8005\u7535\u5b50\u90ae\u7bb1\u5730\u5740:"),t.qZA(),t.TgZ(12,"input",6),t.NdJ("ngModelChange",function(u){return n.comment.email=u}),t.qZA()(),t.TgZ(13,"div",3)(14,"label",4),t._uU(15,"\u4f5c\u8005URL:"),t.qZA(),t.TgZ(16,"input",7),t.NdJ("ngModelChange",function(u){return n.comment.url=u}),t.qZA()(),t.TgZ(17,"div",3)(18,"label",4),t._uU(19,"\u8bc4\u8bba:"),t.qZA(),t.TgZ(20,"textarea",8),t.NdJ("ngModelChange",function(u){return n.comment.content=u}),t.qZA()()()()(),t.TgZ(21,"div",9)(22,"nb-card")(23,"nb-card-header"),t._uU(24,"\u4fdd\u5b58"),t.qZA(),t.TgZ(25,"nb-card-body")(26,"div",10)(27,"label",4),t._uU(28,"\u72b6\u6001: "),t.qZA(),t.TgZ(29,"h6",11),t._uU(30),t.qZA()(),t.TgZ(31,"nb-radio-group",12),t.NdJ("ngModelChange",function(u){return n.comment.approved=u}),t.YNc(32,Z,2,2,"nb-radio",13),t.qZA(),t.TgZ(33,"div",10)(34,"label",14),t._uU(35,"\u63d0\u4ea4\u4e8e: "),t.qZA(),t.TgZ(36,"div",11),t._uU(37),t.qZA()(),t.YNc(38,M,6,2,"div",15),t.qZA(),t.TgZ(39,"nb-card-footer",16)(40,"a",17),t._uU(41,"\u79fb\u81f3\u56de\u6536\u7ad9"),t.qZA(),t.TgZ(42,"button",18),t._uU(43,"\u66f4\u65b0"),t.qZA()()()()()}if(2&e){const l=t.MAs(1);t.xp6(8),t.Q6J("ngModel",n.comment.author),t.xp6(4),t.Q6J("ngModel",n.comment.email),t.xp6(4),t.Q6J("ngModel",n.comment.url),t.xp6(4),t.Q6J("ngModel",n.comment.content),t.xp6(10),t.Oqu(n.getStatus(n.comment.approved)),t.xp6(1),t.Q6J("ngModel",n.comment.approved),t.xp6(1),t.Q6J("ngForOf",n.options),t.xp6(5),t.Oqu(n.comment.createdAt),t.xp6(1),t.Q6J("ngIf",n.comment.post),t.xp6(4),t.Q6J("disabled",l.invalid)}},dependencies:[p.sg,p.O5,s._Y,s.Fj,s.JJ,s.JL,s.On,s.F,a.Asz,a.yKW,a.XWE,a.ndF,a.DPz,a.h8i,a.r3g,a.MFI],encapsulation:2}),o})();var J=r(7595);let y=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[p.ez,h.Bz.forChild([{path:"",component:T,pathMatch:"full"},{path:":id",title:"\u7f16\u8f91\u8bc4\u8bba",component:F}]),J.O,d.Ke]}),o})()}}]);