"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[140],{3140:(Vt,A,l)=>{l.r(A),l.d(A,{DecorationModule:()=>jt});var u=l(7073),h=l(898),f=l(8352),b=l(5249),E=l(3792),k=l(2122),J=l(9754),W=l(4366),N=l(3399),p=l(8665),y=l(8849);const I="/theme/upload";var v=l(9024),t=l(4565),x=l(1245),j=l(5729),d=l(2791),C=l(4862);function V(i,s){if(1&i&&(t.TgZ(0,"nb-option",41),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.name)}}function X(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",2)(1,"span"),t._uU(2," \u9009\u62e9\u8981\u7f16\u8f91\u7684\u5bfc\u822a\uff1a "),t.qZA(),t.TgZ(3,"nb-select",38),t.NdJ("ngModelChange",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.nav.id=o)}),t.YNc(4,V,2,2,"nb-option",39),t.qZA(),t.TgZ(5,"button",40),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.editor())}),t._uU(6,"\u7f16\u8f91"),t.qZA(),t.TgZ(7,"span"),t._uU(8,"\u6216"),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.nav.id),t.xp6(1),t.Q6J("ngForOf",e.navigate),t.xp6(1),t.Q6J("disabled",e.nav.id<1)}}function tt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-checkbox",50),t.NdJ("checkedChange",function(o){const a=t.CHM(e).$implicit;return t.KtG(a.checked=o)}),t._uU(1),t.qZA()}if(2&i){const e=s.$implicit,n=t.oxw().$implicit;t.Q6J("checked",e.checked),t.xp6(1),t.hij(" ","post"==n.type?e.title:e.name," ")}}function et(i,s){if(1&i&&(t.TgZ(0,"nb-option",41),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.title||e.name," ")}}function nt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-accordion-item")(1,"nb-accordion-item-header"),t._uU(2),t.qZA(),t.TgZ(3,"nb-accordion-item-body")(4,"form")(5,"div",42)(6,"nb-tabset")(7,"nb-tab",43)(8,"div",44),t.YNc(9,tt,2,2,"nb-checkbox",32),t.qZA()(),t.TgZ(10,"nb-tab",45)(11,"div")(12,"label"),t._UZ(13,"input",46),t.qZA(),t.TgZ(14,"nb-autocomplete",47,48),t.NdJ("selectedChange",function(o){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.selectSearchItem(a.typeName,o))}),t.YNc(16,et,2,2,"nb-option",39),t.ALo(17,"async"),t.qZA()()()()(),t.TgZ(18,"div",49)(19,"button",15),t.NdJ("click",function(){const r=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.addToNav(r.typeName))}),t._uU(20,"\u6dfb\u52a0\u5230\u5bfc\u822a"),t.qZA()()()()()}if(2&i){const e=s.$implicit,n=t.MAs(15),o=t.oxw();t.xp6(2),t.hij(" ",e.label," "),t.xp6(7),t.Q6J("ngForOf",e.defaultOptions),t.xp6(1),t.Q6J("formGroup",o.searchGroups),t.xp6(3),t.Q6J("formControlName",e.typeName)("nbAutocomplete",n),t.xp6(1),t.Q6J("handleDisplayFn",o.displaySearch),t.xp6(2),t.Q6J("ngForOf",t.lcZ(17,8,o.searchGroupResult[e.typeName])),t.xp6(3),t.Q6J("disabled",o.disabled(e.typeName))}}function ot(i,s){1&i&&(t.TgZ(0,"p",52),t._uU(1," \u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a! "),t.qZA())}function it(i,s){if(1&i&&(t.ynx(0),t.YNc(1,ot,2,0,"p",51),t.BQk()),2&i){t.oxw();const e=t.MAs(50);t.xp6(1),t.Q6J("ngIf",null==e.errors?null:e.errors.required)}}function rt(i,s){1&i&&t.GkF(0)}const M=function(i){return{node:i}};function at(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",53),t.NdJ("cdkDragMoved",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.dragMoved(o))}),t.YNc(1,rt,1,0,"ng-container",54),t.qZA()}if(2&i){const e=s.$implicit;t.oxw();const n=t.MAs(72);t.Q6J("cdkDragData",e.nodeId),t.xp6(1),t.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",t.VKq(3,M,e))}}function st(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-checkbox",50),t.NdJ("checkedChange",function(o){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.nav.themeNavigationLocation[a.alias]=o)}),t._uU(1),t.qZA()}if(2&i){const e=s.$implicit,n=t.oxw();t.Q6J("checked",n.nav.themeNavigationLocation[e.alias]),t.xp6(1),t.Oqu(e.name)}}function dt(i,s){if(1&i&&(t.TgZ(0,"nb-option",41),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.name)}}function ct(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",55)(1,"label",61),t._uU(2),t.qZA(),t.TgZ(3,"div",62)(4,"nb-select",63),t.NdJ("ngModelChange",function(o){const a=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.themeNavigationLocation[a.alias]=o)}),t.YNc(5,dt,2,2,"nb-option",39),t.qZA()()()}if(2&i){const e=s.$implicit,n=s.index,o=t.oxw(2);t.xp6(1),t.MGl("for","nav_location_",n,""),t.xp6(1),t.Oqu(e.name),t.xp6(2),t.MGl("name","nav_location_",n,""),t.Q6J("ngModel",o.themeNavigationLocation[e.alias]),t.xp6(1),t.Q6J("ngForOf",o.navigate)}}function lt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"form",18),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.saveLocation())}),t.TgZ(1,"nb-card")(2,"nb-card-header"),t._uU(3,"\u83dc\u5355\u4f4d\u7f6e"),t.qZA(),t.TgZ(4,"nb-card-body")(5,"div",55)(6,"label",56),t._uU(7,"\u4e3b\u9898\u83dc\u5355\u4f4d\u7f6e"),t.qZA(),t.TgZ(8,"label",57),t._uU(9,"\u5df2\u6307\u6d3e\u7684\u83dc\u5355"),t.qZA()(),t.YNc(10,ct,6,5,"div",58),t.qZA(),t.TgZ(11,"nb-card-footer",59)(12,"button",60),t._uU(13,"\u4fdd\u5b58\u8bbe\u7f6e"),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(10),t.Q6J("ngForOf",e.themeNavigation),t.xp6(2),t.Q6J("disabled",e.submitted)}}function ut(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",69)(1,"label",70),t._uU(2,"URL"),t.qZA(),t.TgZ(3,"input",71),t.NdJ("ngModelChange",function(o){t.CHM(e);const r=t.oxw().node;return t.KtG(r.url=o)}),t.qZA()()}if(2&i){const e=t.oxw().node;t.xp6(1),t.MGl("for","custom_link_id_",e.nodeId,""),t.xp6(2),t.MGl("id","custom_link_id_",e.nodeId,""),t.Q6J("name",e.nodeId)("ngModel",e.url)}}function pt(i,s){1&i&&t.GkF(0)}function gt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",53),t.NdJ("cdkDragMoved",function(o){t.CHM(e);const r=t.oxw(3);return t.KtG(r.dragMoved(o))}),t.YNc(1,pt,1,0,"ng-container",54),t.qZA()}if(2&i){const e=s.$implicit;t.oxw(3);const n=t.MAs(72);t.Q6J("cdkDragData",e.nodeId),t.xp6(1),t.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",t.VKq(3,M,e))}}function mt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",75),t.NdJ("cdkDropListDropped",function(o){t.CHM(e);const r=t.oxw(2);return t.KtG(r.drop(o))}),t.YNc(1,gt,2,5,"div",28),t.qZA()}if(2&i){const e=t.oxw().node,n=t.oxw();t.Q6J("cdkDropListData",e.children)("id",e.nodeId)("cdkDropListConnectedTo",n.dropTargetIds)("cdkDropListSortingDisabled",!0),t.xp6(1),t.Q6J("ngForOf",e.children)}}function ht(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",64)(1,"nb-accordion")(2,"nb-accordion-item")(3,"nb-accordion-item-header",65)(4,"div"),t._uU(5),t.qZA(),t.TgZ(6,"div",66),t._uU(7),t.qZA()(),t.TgZ(8,"nb-accordion-item-body")(9,"form",67),t.YNc(10,ut,4,4,"div",68),t.TgZ(11,"div",69)(12,"label",70),t._uU(13,"\u5bfc\u822a\u540d\u79f0"),t.qZA(),t.TgZ(14,"input",71),t.NdJ("ngModelChange",function(o){const a=t.CHM(e).node;return t.KtG(a.title=o)}),t.qZA()(),t.TgZ(15,"div")(16,"button",72),t.NdJ("click",function(){const r=t.CHM(e).node,a=t.oxw();return t.KtG(a.remove(r.nodeId))}),t._uU(17,"\u79fb\u9664"),t.qZA(),t._uU(18," \xa0|\xa0 "),t.TgZ(19,"button",73),t._uU(20,"\u53d6\u6d88"),t.qZA()()()()()(),t.YNc(21,mt,2,5,"div",74),t.qZA()}if(2&i){const e=s.node,n=t.oxw();t.uIk("data-id",e.nodeId)("id","node-"+e.nodeId),t.xp6(5),t.Oqu(e.title),t.xp6(2),t.Oqu(n.typeMapName[e.type]),t.xp6(3),t.Q6J("ngIf","link"==e.type),t.xp6(2),t.MGl("for","custom_link_name_",e.nodeId,""),t.xp6(2),t.MGl("id","custom_link_name_",e.nodeId,""),t.Q6J("name",e.nodeId)("ngModel",e.title),t.xp6(7),t.Q6J("ngIf",e.children.length>0)}}let _t=(()=>{class i{constructor(e,n,o,r,a){this.route=e,this.http=n,this.document=o,this.config=r,this.sidebar=a,this.searchResult={},this.navigate=[],this.themeNavigation=[],this.themeNavigationLocation={},this.dropTargetIds=[],this.nodeLookup={},this.submitted=!1,this.custom={link:"",title:""},this.typeMapName={page:"\u9875\u9762",post:"\u6587\u7ae0",custom:"\u81ea\u5b9a\u4e49\u94fe\u63a5",category:"\u5206\u7c7b"},this.defaultNode={nodeId:"demo",title:"\u793a\u4f8b1",type:"custom",children:[]},this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.searchGroups=new p.cw({}),this.searchGroupResult={},this.accordionItems=[]}ngAfterViewInit(){(0,f.H)(300).subscribe(e=>{this.sidebar.toggle(!0,"menu-sidebar")})}onSpinner(e){this.submitted=e}ngOnInit(){let e=this.config.taxonomies(),n=this.config.postTypes(),o=[];for(let r in n)n[r].visibility.showNavigation&&(o.push({label:n[r].label,type:"post",name:r,typeName:"post_"+r,defaultOptions:[]}),this.searchGroups.addControl("post_"+r,new p.NI("")));for(let r in e)e[r].visibility.showNavigation&&(o.push({label:e[r].label,type:"taxonomy",name:r,typeName:"taxonomy_"+r,defaultOptions:[]}),this.searchGroups.addControl("taxonomy_"+r,new p.NI("")));for(let r of o)this.searchGroupResult[r.typeName]=this.searchGroups.controls[r.typeName].valueChanges.pipe((0,E.x)(),(0,k.b)(500),(0,J.h)(c=>!!c),(0,W.w)(c=>this.getObjects(c,r.name,r.type)));this.accordionItems=o,this.http.get("/navigate/structure").subscribe(r=>{for(let a in r.dataSet)this.accordionItems.forEach(c=>{c.typeName===a&&(c.defaultOptions=r.dataSet[a])});this.themeNavigation=r.themeNavigation,this.themeNavigationLocation=r.themeNavigationLocation,this.navigate=r.navigate}),this.prepareDragDrop(this.nav.nodes)}editor(){this.http.get("/navigate/{id}",{params:{id:this.nav.id}}).subscribe(e=>{this.nav=e.navigation,this.nav.nodes.length<1&&this.nav.nodes.push(this.defaultNode),this.nav.themeNavigationLocation={},this.themeNavigation.forEach(n=>{this.nav.themeNavigationLocation[n.alias]=this.themeNavigationLocation[n.alias]==this.nav.id}),this.prepareDragDrop(this.nav.nodes)})}prepareDragDrop(e){e.forEach(n=>{this.dropTargetIds.includes(n.nodeId)||this.dropTargetIds.push(n.nodeId),this.nodeLookup[n.nodeId]=n,this.prepareDragDrop(n.children)})}dragMoved(e){(0,b.of)(e).pipe((0,k.b)(50)).subscribe(n=>{var o;let r=this.document.elementFromPoint(n.pointerPosition.x,n.pointerPosition.y);if(!r)return void this.clearDragInfo();let a=r.classList.contains("node-item")?r:r.closest(".node-item");if(!a)return void this.clearDragInfo();this.dropActionTodo={targetId:null!==(o=a.getAttribute("data-id"))&&void 0!==o?o:""};const c=a.getBoundingClientRect(),g=c.height/3;this.dropActionTodo.action=n.pointerPosition.y-c.top<g?"before":n.pointerPosition.y-c.top>2*g?"after":"inside",this.showDragInfo()})}drop(e){if(!this.dropActionTodo)return;const n=e.item.data,o=e.previousContainer.id,r=this.getParentNodeId(this.dropActionTodo.targetId,this.nav.nodes,"main");console.log("\nmoving\n["+n+"] from list ["+o+"]","\n["+this.dropActionTodo.action+"]\n["+this.dropActionTodo.targetId+"] from list ["+r+"]");const a=this.nodeLookup[n],c="main"!=o?this.nodeLookup[o].children:this.nav.nodes,g="main"!=r?this.nodeLookup[r].children:this.nav.nodes;let Z=c.findIndex(_=>_.nodeId===n);switch(c.splice(Z,1),this.dropActionTodo.action){case"before":case"after":const _=g.findIndex(m=>{var w;return m.nodeId===(null===(w=this.dropActionTodo)||void 0===w?void 0:w.targetId)});g.splice("before"==this.dropActionTodo.action?_:_+1,0,a);break;case"inside":this.nodeLookup[this.dropActionTodo.targetId].children.push(a),this.nodeLookup[this.dropActionTodo.targetId].isExpanded=!0}this.clearDragInfo(!0)}getParentNodeId(e,n,o){for(let r of n){if(r.nodeId==e)return o;let a=this.getParentNodeId(e,r.children,r.nodeId);if(a)return a}return""}showDragInfo(){var e;this.clearDragInfo(),this.dropActionTodo&&(null===(e=document.getElementById("node-"+this.dropActionTodo.targetId))||void 0===e||e.classList.add("drop-"+this.dropActionTodo.action))}clearDragInfo(e=!1){e&&(this.dropActionTodo=void 0),this.document.querySelectorAll(".drop-before").forEach(n=>n.classList.remove("drop-before")),this.document.querySelectorAll(".drop-after").forEach(n=>n.classList.remove("drop-after")),this.document.querySelectorAll(".drop-inside").forEach(n=>n.classList.remove("drop-inside"))}delete(){window.confirm("\u786e\u8ba4\u5220\u9664\u83dc\u5355 ["+this.nav.name+"]\u5417\uff1f")&&this.http.post("/navigate/{id}/delete",this.nav).subscribe(e=>{this.create()})}save(){this.http.post("/navigate/save",this.nav,{context:(new h.qT).set(v.a,this)}).subscribe(e=>{})}saveLocation(){this.http.post("/navigate/save/location",{location:this.themeNavigationLocation},{context:(new h.qT).set(v.a,this)}).subscribe(e=>{})}addToNav(e){if("custom"===e){let n="custom-"+this.custom.title,o={nodeId:n,title:this.custom.title,type:e,url:this.custom.link,children:[]};this.custom.title="",this.custom.link="",this.nav.nodes.push(o),this.dropTargetIds.push(n),this.nodeLookup[n]=o}else this.accordionItems.forEach(n=>{n.typeName==e&&n.defaultOptions.forEach(o=>{o.checked&&(this.selectedItem(o),o.checked=!1)})}),this.searchResult[e]&&(this.selectedItem(this.searchResult[e]),this.searchResult[e]=void 0,this.searchGroups.controls[e].setValue(""))}selectedItem(e){let n=e.type||e.taxonomy,o="node-"+n+"-"+e.id;if(null==this.nodeLookup[o]){let r={nodeId:o,title:e.title||e.name,type:n,objectId:e.id,children:[]};this.nav.nodes.push(r),this.dropTargetIds.push(o),this.nodeLookup[o]=r}}remove(e){this.removeNode(e,this.nav.nodes),delete this.dropTargetIds[this.dropTargetIds.indexOf(e)],delete this.nodeLookup[e]}removeNode(e,n){n.forEach((o,r)=>{o.nodeId==e?n.splice(r,1):o.children.length>0&&this.removeNode(e,o.children)})}create(){this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.dropTargetIds=[],this.nodeLookup={},this.prepareDragDrop(this.nav.nodes)}getObjects(e,n,o){switch(o){case"taxonomy":return this.http.get(y.WP,{params:{taxonomy:n,name:e,page:1,size:50}}).pipe((0,N.U)(r=>r.records));case"post":return this.http.get(y.vA,{params:{type:n,title:e,page:1,size:50}}).pipe((0,N.U)(r=>r.records));default:return(0,b.of)([])}}navigationLocation(e){console.log(e)}displaySearch(e){return"string"==typeof e?e:e.title||e.name}selectSearchItem(e,n){this.searchResult[e]=n}disabled(e){let n=!0;return this.accordionItems.forEach(o=>{o.defaultOptions.forEach(r=>{r.checked&&(n=!1)})}),this.searchResult[e]&&(n=!1),n}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(x.gz),t.Y36(h.eN),t.Y36(u.K0),t.Y36(j.eB),t.Y36(d.lzT))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-navigation"]],decls:73,vars:17,consts:[[1,"row"],[1,"col-12"],[1,"d-flex","align-items-center"],["class","d-flex align-items-center",4,"ngIf"],["href","javascript:",3,"click"],[1,"col-5"],["multi","true",1,"interface-complementary-area"],["customForm","ngForm"],[1,"mb-3","row"],["for","custom_link",1,"label","col-sm-3","col-form-label"],[1,"col-sm-9"],["id","custom_link","required","","name","link","placeholder","https://","fullWidth","","status","primary","nbInput","",3,"ngModel","ngModelChange"],["for","custom_link_name",1,"label","col-sm-3","col-form-label"],["id","custom_link_name","required","","name","link_name","fullWidth","","status","primary","nbInput","",3,"ngModel","ngModelChange"],[1,"mb-3","text-right"],["nbButton","","status","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"col-7"],[3,"ngSubmit"],["navForm","ngForm"],[1,"form-group","row"],["for","nav_name",1,"label","col-sm-2","col-form-label"],[1,"col-sm-10"],["id","nav_name","required","required","name","navName","status","primary","nbInput","",3,"status","ngModel","ngModelChange"],["navName","ngModel"],[4,"ngIf"],[1,"pt-4","label"],["cdkDropList","",1,"node_container",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped"],["cdkDrag","",3,"cdkDragData","cdkDragMoved",4,"ngFor","ngForOf"],[1,"py-2",2,"font-size","15px","font-weight","bold"],["for","nav_location",1,"label","col-sm-2","col-form-label"],["id","nav_location",1,"col-sm-10","d-flex","flex-column"],[3,"checked","checkedChange",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","type","button","status","danger",3,"disabled","click"],["type","submit","nbButton","","status","primary",3,"disabled"],[3,"ngSubmit",4,"ngIf"],["tmplNode",""],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["nbButton","","status","primary",1,"mx-2",3,"disabled","click"],[3,"value"],[1,"form-group"],["tabTitle","\u6700\u8fd1",1,"px-0"],[1,"d-flex","flex-column"],["tabTitle","\u641c\u7d22",1,"px-0",3,"formGroup"],["nbInput","","status","primary","fullWidth","",3,"formControlName","nbAutocomplete"],[3,"handleDisplayFn","selectedChange"],["searchAuto",""],[1,"form-group","text-right"],[3,"checked","checkedChange"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],["cdkDrag","",3,"cdkDragData","cdkDragMoved"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"row","mb-3"],[1,"label","col-2","col-form-label"],[1,"label","col-10","col-form-label"],["class","row mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary","type","submit",3,"disabled"],[1,"label","col-2","col-form-label",3,"for"],[1,"col-10"],[3,"name","ngModel","ngModelChange"],[1,"node-item"],[1,"justify-content-between"],[1,"mr-4"],["ngForm",""],["class","mb-2",4,"ngIf"],[1,"mb-2"],[1,"label","col-form-label",3,"for"],["nbInput","","fullWidth","","status","primary",3,"id","name","ngModel","ngModelChange"],["nbButton","","size","tiny","status","danger",3,"click"],["nbButton","","size","tiny","status","primary"],["class","node-children","cdkDropList","",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped",4,"ngIf"],["cdkDropList","",1,"node-children",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-body")(4,"div",2),t.YNc(5,X,9,3,"div",3),t.TgZ(6,"span")(7,"a",4),t.NdJ("click",function(){return n.create()}),t._uU(8,"\u521b\u5efa\u65b0\u5bfc\u822a"),t.qZA(),t._uU(9,"\xa0\xa0"),t.TgZ(10,"span"),t._uU(11,"\u4e0d\u8981\u5fd8\u4e86\u4fdd\u5b58\u60a8\u7684\u4fee\u6539!"),t.qZA()()()()()(),t.TgZ(12,"div",5)(13,"nb-card")(14,"nb-card-header"),t._uU(15," \u6dfb\u52a0\u5bfc\u822a\u9879 "),t.qZA(),t.TgZ(16,"nb-card-body")(17,"nb-accordion",6)(18,"nb-accordion-item")(19,"nb-accordion-item-header"),t._uU(20," \u81ea\u5b9a\u4e49\u94fe\u63a5 "),t.qZA(),t.TgZ(21,"nb-accordion-item-body")(22,"form",null,7)(24,"div",8)(25,"label",9),t._uU(26,"\u94fe\u63a5"),t.qZA(),t.TgZ(27,"div",10)(28,"input",11),t.NdJ("ngModelChange",function(r){return n.custom.link=r}),t.qZA()()(),t.TgZ(29,"div",8)(30,"label",12),t._uU(31,"\u94fe\u63a5\u540d\u79f0"),t.qZA(),t.TgZ(32,"div",10)(33,"input",13),t.NdJ("ngModelChange",function(r){return n.custom.title=r}),t.qZA()()(),t.TgZ(34,"div",14)(35,"button",15),t.NdJ("click",function(){return n.addToNav("custom")}),t._uU(36,"\u6dfb\u52a0\u5230\u5bfc\u822a"),t.qZA()()()()(),t.YNc(37,nt,21,10,"nb-accordion-item",16),t.qZA()()()(),t.TgZ(38,"div",17)(39,"form",18,19),t.NdJ("ngSubmit",function(){return n.save()}),t.TgZ(41,"nb-card")(42,"nb-card-header"),t._uU(43," \u5bfc\u822a\u7ed3\u6784 "),t.qZA(),t.TgZ(44,"nb-card-body")(45,"div",20)(46,"label",21),t._uU(47,"\u83dc\u5355\u540d\u79f0"),t.qZA(),t.TgZ(48,"div",22)(49,"input",23,24),t.NdJ("ngModelChange",function(r){return n.nav.name=r}),t.qZA(),t.YNc(51,it,2,1,"ng-container",25),t.qZA()(),t.TgZ(52,"p",26),t._uU(53,"\u62d6\u653e\u5404\u4e2a\u9879\u76ee\u5230\u60a8\u559c\u6b22\u7684\u987a\u5e8f\uff0c\u70b9\u51fb\u53f3\u4fa7\u7684\u7bad\u5934\u53ef\u8fdb\u884c\u66f4\u8be6\u7ec6\u7684\u8bbe\u7f6e\u3002"),t.qZA(),t.TgZ(54,"div",27),t.NdJ("cdkDropListDropped",function(r){return n.drop(r)}),t.YNc(55,at,2,5,"div",28),t.qZA()(),t.TgZ(56,"nb-card-footer")(57,"div",29),t._uU(58,"\u83dc\u5355\u8bbe\u7f6e"),t.qZA(),t.TgZ(59,"div",20)(60,"label",30),t._uU(61,"\u663e\u793a\u4f4d\u7f6e"),t.qZA(),t.TgZ(62,"div",31),t.YNc(63,st,2,2,"nb-checkbox",32),t.qZA()()(),t.TgZ(64,"nb-card-footer")(65,"div",33)(66,"button",34),t.NdJ("click",function(){return n.delete()}),t._uU(67,"\u5220\u9664\u5bfc\u822a"),t.qZA(),t.TgZ(68,"button",35),t._uU(69,"\u4fdd\u5b58\u5bfc\u822a"),t.qZA()()()()(),t.YNc(70,lt,14,2,"form",36),t.qZA()(),t.YNc(71,ht,22,10,"ng-template",null,37,t.W1O)),2&e){const o=t.MAs(23),r=t.MAs(40),a=t.MAs(50);t.xp6(5),t.Q6J("ngIf",n.navigate.length>0),t.xp6(23),t.Q6J("ngModel",n.custom.link),t.xp6(5),t.Q6J("ngModel",n.custom.title),t.xp6(2),t.Q6J("disabled",!o.valid),t.xp6(2),t.Q6J("ngForOf",n.accordionItems),t.xp6(12),t.Q6J("status",a.dirty?a.invalid?"danger":"success":"primary")("ngModel",n.nav.name),t.xp6(2),t.Q6J("ngIf",a.invalid&&a.touched),t.xp6(3),t.Q6J("cdkDropListData",n.nav.nodes)("id","main")("cdkDropListConnectedTo",n.dropTargetIds)("cdkDropListSortingDisabled",!0),t.xp6(1),t.Q6J("ngForOf",n.nav.nodes),t.xp6(8),t.Q6J("ngForOf",n.themeNavigation),t.xp6(3),t.Q6J("disabled",n.nav.id<1||n.nav.name.length<1),t.xp6(2),t.Q6J("disabled",!r.valid||n.submitted),t.xp6(2),t.Q6J("ngIf",n.themeNavigation.length>0)}},dependencies:[u.sg,u.O5,u.tP,p._Y,p.Fj,p.JJ,p.JL,p.Q7,p.On,p.F,p.sg,p.u,d.Asz,d.yKW,d.XWE,d.ndF,d.kyn,d.TR4,d.NTf,d.DPz,d.h8i,d.qCO,d.SaG,d.YZd,d.AvE,d.rs,d.q51,d.Xh,d.wNd,C.Wj,C.Zt,u.Ov],styles:["/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */.node_container{padding:var(--accordion-padding);border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}.node_container .cdk-drag-placeholder{display:none}.node_container .cdk-drag-preview{box-sizing:border-box;box-shadow:0 3px 3px -2px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#fff;opacity:.3}.node_container .drop-inside{border-width:var(--accordion-header-border-width)!important;border-style:var(--accordion-header-border-style)!important;border-color:var(--text-success-color)!important}.node_container .drop-before{border-top-width:var(--accordion-header-border-width)!important;border-top-style:var(--accordion-header-border-style)!important;border-top-color:var(--text-success-color)!important}.node_container .drop-after{border-bottom-width:var(--accordion-header-border-width)!important;border-bottom-style:var(--accordion-header-border-style)!important;border-bottom-color:var(--text-success-color)!important}.node_container .node-item{background-color:var(--accordion-item-background-color);cursor:move}.node_container .node-children{position:relative;transition:height .2s;margin-left:40px}.node_container .item-notes{margin-left:20px;color:#aaa}.node_container nb-icon{cursor:pointer!important}.node_container nb-accordion-item-header{cursor:move}.node_container nb-accordion{margin:5px;border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}\n"],encapsulation:2}),i})();var bt=l(1682),T=l(3037),F=l(7660),D=l(287);const ft=["widgetSidebarBtn"],vt=["widgetItemComponent"];function xt(i,s){if(1&i&&(t.TgZ(0,"label",44),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.Oqu(e.label)}}function Ct(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",45),t.NdJ("click",function(){const r=t.CHM(e).$implicit,a=t.oxw(3);return t.KtG(a.insertWidget(r.name))}),t._UZ(1,"nb-icon",46),t.TgZ(2,"span",47),t._uU(3),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(1),t.Q6J("pack",e.icon.startsWith("fa-")?"fa":"")("icon",e.icon),t.xp6(2),t.Oqu(e.label)}}function Tt(i,s){if(1&i&&(t.TgZ(0,"div",40),t.YNc(1,xt,2,1,"label",41),t.TgZ(2,"div",42),t.YNc(3,Ct,4,3,"div",43),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",e.slug),t.xp6(2),t.Q6J("ngForOf",e.widgets)}}function Zt(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Tt,4,2,"div",39),t.BQk()),2&i){const e=s.$implicit;t.xp6(1),t.Q6J("ngIf",e.widgets&&e.widgets.length>0)}}function wt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"widget-item",52,53),t.NdJ("focus",function(o){t.CHM(e);const r=t.oxw(2);return t.KtG(r.selectorWidget(o))})("blur",function(o){t.CHM(e);const r=t.oxw(2);return t.KtG(r.unselectWidget(o))}),t.qZA()}2&i&&t.Q6J("product",s.$implicit)}function At(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-accordion",48),t.NdJ("focus",function(o){const a=t.CHM(e).index,c=t.oxw();return t.KtG(c.selectorBlock(o,a))}),t.TgZ(1,"nb-accordion-item")(2,"nb-accordion-item-header",49),t.NdJ("focus",function(o){const a=t.CHM(e).index,c=t.oxw();return t.KtG(c.selectorBlock(o,a))}),t._uU(3),t.qZA(),t.TgZ(4,"nb-accordion-item-body"),t.YNc(5,wt,2,1,"widget-item",50),t.TgZ(6,"button",51),t.NdJ("nbPopoverShowStateChange",function(o){const a=t.CHM(e).index,c=t.oxw();return t.KtG(c.quickToggle(o,a))}),t._UZ(7,"nb-icon",6),t.qZA()()()()}if(2&i){const e=s.$implicit,n=t.oxw(),o=t.MAs(48);t.xp6(3),t.hij(" ",e.label," "),t.xp6(2),t.Q6J("ngForOf",n.getBlockWidgets(e.name)),t.xp6(1),t.Q6J("nbPopover",o)}}function kt(i,s){if(1&i&&(t.TgZ(0,"nb-list-item"),t._UZ(1,"nb-icon",46),t.TgZ(2,"span"),t._uU(3),t.qZA()()),2&i){const e=s.$implicit;t.xp6(1),t.Q6J("pack",e.widget.icon.startsWith("fa-")?"fa":"")("icon",e.widget.icon),t.xp6(2),t.Oqu(e.widget.label)}}function Nt(i,s){if(1&i&&(t.TgZ(0,"nb-tab",54)(1,"nb-list",55),t.YNc(2,kt,4,3,"nb-list-item",21),t.qZA()()),2&i){const e=t.oxw();t.Q6J("tabTitle",e.blocks[e.selectBlockIndex].label||""),t.xp6(2),t.Q6J("ngForOf",e.getBlockWidgets(e.blocks[e.selectBlockIndex].name))}}function yt(i,s){if(1&i&&(t.TgZ(0,"nb-card-header",56),t._UZ(1,"nb-icon",46),t.TgZ(2,"div",57)(3,"span"),t._uU(4),t.qZA(),t.TgZ(5,"label",58),t._uU(6),t.qZA()()()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("pack",e.selectedWidget.product.widget.icon.startsWith("fa-")?"fa":"")("icon",e.selectedWidget.product.widget.icon),t.xp6(3),t.Oqu(e.selectedWidget.product.widget.label),t.xp6(2),t.Oqu(e.selectedWidget.product.widget.description)}}function It(i,s){if(1&i&&(t.TgZ(0,"nb-accordion-item")(1,"nb-accordion-item-header"),t._uU(2),t.qZA(),t.TgZ(3,"nb-accordion-item-body"),t._UZ(4,"control-container",60),t.qZA()()),2&i){const e=s.$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(e.label),t.xp6(2),t.Q6J("form",n.selectedWidget.product.form)("controls",e.controls)}}function Mt(i,s){if(1&i&&(t.TgZ(0,"nb-accordion",59),t.YNc(1,It,5,3,"nb-accordion-item",21),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.selectedWidget.product.widget.sections)}}function Ft(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",45),t.NdJ("click",function(){const r=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.insertWidget(r.name,!0))}),t._UZ(1,"nb-icon",65),t.TgZ(2,"span",47),t._uU(3),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(1),t.Q6J("icon",e.icon),t.xp6(2),t.Oqu(e.label)}}function Dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-card",61)(1,"nb-card-header",62)(2,"nb-form-field")(3,"input",18),t.NdJ("keyup",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.search(o))}),t.qZA(),t._UZ(4,"nb-icon",19),t.qZA()(),t.TgZ(5,"nb-card-body",63)(6,"div",42),t.YNc(7,Ft,4,2,"div",43),t.qZA()(),t.TgZ(8,"nb-card-footer",62)(9,"button",64),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.widgetSidebarBtnRef.nativeElement.click())}),t._uU(10,"\u6d4f\u89c8\u5168\u90e8 "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(7),t.Q6J("ngForOf",e.historyWidgets)}}const Et=["container"];function Jt(i,s){if(1&i&&t._UZ(0,"nb-icon",2),2&i){const e=t.oxw();t.Q6J("pack",e.product.widget.icon.startsWith("fa-")?"fa":"")("icon",e.product.widget.icon)}}let Wt=(()=>{class i{constructor(e,n,o){this.http=e,this.sidebar=n,this.document=o,this.widgets=[],this.widgetCategories=[],this.leftSidebarCompact=!1,this.blocks=[],this.hasHiddenWidgetSidebar=!0,this.hasHiddenSettingSidebar=!0,this.filterWidgetCategories=(0,b.of)([]),this.blockWidgets={},this.historyWidgets=[],this.selectBlockIndex=-1}ngOnInit(){this.sidebar.onToggle().subscribe(o=>{this.leftSidebarCompact=o.compact}),this.sidebar.onExpand().subscribe(o=>{o&&(this.leftSidebarCompact=!1)});const e=this.http.get("/widget/registered"),n=this.http.get("/widget/blocks");(0,bt.a)([e,n]).subscribe(([o,r])=>{this.widgets=o.widgets,o.categories.forEach(a=>{a.widgets=this.widgets.filter(c=>c.category==a.slug),a.widgets.forEach(c=>{c.icon||(c.icon=a.icon)})}),this.widgetCategories=o.categories,this.filterWidgetCategories=(0,b.of)(this.widgetCategories),this.historyWidgets=this.widgets.slice(0,6),this.blocks=r,r.length>0&&(this.selectBlockIndex=0),r.forEach(a=>{this.blockWidgets[a.name]=[],a.widgets.length>0&&a.widgets.forEach(c=>{const g=this.widgets.find(m=>{if(m.name==c.name)return m});if(!g)return;let Z=g.sections.map(m=>m.controls),_={id:c.id,widget:Object.assign({},g),form:(0,T.T)(Z.flat(1))};for(const m in c.attributes)_.form.contains(m)&&_.form.controls[m].setValue(c.attributes[m],{emitEvent:!1});this.blockWidgets[a.name].push(_)})})})}ngAfterViewInit(){(0,f.H)(300).subscribe(e=>{this.sidebar.toggle(!0,"menu-sidebar")})}toggleWidgetSidebar(e){this.hasHiddenWidgetSidebar=!this.hasHiddenWidgetSidebar,this.hasHiddenWidgetSidebar||this.rollbackFilterWidgetCategories(),this.hasHiddenWidgetSidebar||(this.hasHiddenSettingSidebar=!0)}toggleSettingSidebar(e){this.hasHiddenSettingSidebar=!this.hasHiddenSettingSidebar,this.hasHiddenSettingSidebar||(this.hasHiddenWidgetSidebar=!0)}search(e){let n=e?e.target.value:"";if(""==n)return void(this.filterWidgetCategories=(0,b.of)(this.widgetCategories));let o=this.widgets.filter(r=>r.label.includes(n)||r.keywords.flat().includes(n));this.filterWidgetCategories=(0,b.of)([{slug:"",label:"",icon:"",widgets:o}])}quickToggle(e,n){e.isShown?(this.selectBlockIndex=n,this.hasHiddenWidgetSidebar||this.toggleWidgetSidebar(null)):this.rollbackFilterWidgetCategories()}selectorBlock(e,n){this.selectBlockIndex=n}selectorWidget(e){let n=e.target.id;for(let o of this.widgetItems)n==o.Id&&(this.selectedWidget&&this.selectedWidget.Id==n||(this.selectedWidget=o))}unselectWidget(e){if(console.log(e),e.relatedTarget){if("settingSidebarBtn"==e.relatedTarget.id)return;let o=e.relatedTarget.className;if(console.log(o),o.includes("sidebar-setting")||o.includes("tab-link")||o.includes("accordion")||o.includes("control-container"))return}this.selectedWidget=void 0}insertWidget(e,n=!1){let o=this.widgets.filter(r=>r.name===e).pop();if(this.selectBlockIndex>-1&&o){let r=o.sections.map(a=>a.controls);this.blockWidgets[this.blocks[this.selectBlockIndex].name].push({id:this.generateUUID(),widget:Object.assign({},o),form:(0,T.T)(r.flat(1))}),n||(this.historyWidgets.unshift(o),this.historyWidgets.length>6&&this.historyWidgets.pop())}}getBlockWidgets(e){var n;return null!==(n=this.blockWidgets[e])&&void 0!==n?n:[]}save(e){const n={blocks:{},widgets:{}};let o=1;for(let r in this.blockWidgets)n.blocks[r]=[],this.blockWidgets[r].forEach(a=>{const c="widget-"+a.widget.name+"-"+o;n.blocks[r].push(c),n.widgets[c]={id:a.id,name:a.widget.name,attributes:a.form.getRawValue()},o++});this.http.post("/widget/saved",n).subscribe({})}rollbackFilterWidgetCategories(){this.filterWidgetCategories.subscribe(e=>{e.length!=this.widgetCategories.length&&(this.filterWidgetCategories=(0,b.of)(this.widgetCategories))})}generateUUID(){let e=(new Date).getTime();return typeof performance<"u"&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===o?r:3&r|8).toString(16)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.eN),t.Y36(d.lzT),t.Y36(u.K0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-widget"]],viewQuery:function(e,n){if(1&e&&(t.Gf(ft,5,t.SBq),t.Gf(vt,5)),2&e){let o;t.iGM(o=t.CRH())&&(n.widgetSidebarBtnRef=o.first),t.iGM(o=t.CRH())&&(n.widgetItems=o)}},decls:49,vars:16,consts:[[1,"component-skeleton"],[1,"component-skeleton-body"],[1,"mb-0","position-relative"],[1,"d-flex","border-0","justify-content-between","align-items-center"],["nbButton","","id","widgetSidebarBtn",3,"status","click"],["widgetSidebarBtn",""],["icon","plus-outline"],[1,"d-flex","justify-content-end"],["nbButton","","status","danger",3,"click"],[1,"mx-2"],["nbButton","","status","primary","type","button","id","settingSidebarBtn",3,"click"],["icon","settings-2"],[1,"d-flex","flex-grow-1","overflow-auto",2,"overscroll-behavior-y","none"],[1,"col-4","p-0","position-relative",3,"hidden"],[1,"d-flex","flex-column","h-100"],[1,"h-100"],[1,"position-relative","overflow-hidden","h-100"],[1,"h-100","mb-0","border-0","rounded-0","position-relative"],["nbInput","","fullWidth","",3,"keyup"],["nbSuffix","","icon","search-outline"],[1,"d-flex","flex-column","flex-grow-1"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-column","flex-grow-1","overflow-hidden","mx-auto"],[1,"block-list","h-100","position-relative"],[1,"p-0","rounded-0","border-0","bg-transparent","h-100"],[1,"row"],[1,"col-8","mx-auto"],["tabindex","0","class","mt-5",3,"focus",4,"ngFor","ngForOf"],["tabindex","0",1,"col-3","p-0","position-relative","sidebar-setting",3,"hidden","blur"],[1,"position-relative","h-100"],[1,"h-100","mb-0","border-0","rounded-0"],[1,"p-0","h-100","overflow-hidden"],["class","p-0 h-100",3,"tabTitle",4,"ngIf"],["tabTitle","\u6302\u4ef6",1,"p-0","h-100","overflow-hidden"],[1,"p-0","h-100","d-flex","border-0","flex-column"],["class","d-flex",4,"ngIf"],[1,"d-flex","p-0","flex-column","h-100","flex-grow-1"],["multi","",4,"ngIf"],["quickInsertWidgetDialog",""],["class","sidebar-category",4,"ngIf"],[1,"sidebar-category"],["class","label col-form-label py-4",4,"ngIf"],[1,"d-flex","flex-row","flex-wrap"],["class","sidebar-widget-item",3,"click",4,"ngFor","ngForOf"],[1,"label","col-form-label","py-4"],[1,"sidebar-widget-item",3,"click"],[3,"pack","icon"],[1,"py-4"],["tabindex","0",1,"mt-5",3,"focus"],["tabindex","0",3,"focus"],["tabindex","0",3,"product","focus","blur",4,"ngFor","ngForOf"],["tabindex","0","nbButton","","fullWidth","","status","control","nbPopoverTrigger","click",3,"nbPopover","nbPopoverShowStateChange"],["tabindex","0",3,"product","focus","blur"],["widgetItemComponent",""],[1,"p-0","h-100",3,"tabTitle"],[1,"p-0","sidebar-setting-widgets-list"],[1,"d-flex"],[1,"d-flex","flex-column","ps-3"],[1,"label"],["multi",""],["tabindex","0",1,"control-container",3,"form","controls"],[1,"border-0","mb-0",2,"width","22rem"],[1,"border-0"],[1,"p-0"],["status","primary","outline","","fullWidth","","nbButton","",1,"rounded-0",3,"click"],[3,"icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card",2)(3,"nb-card-header",3)(4,"button",4,5),t.NdJ("click",function(r){return n.toggleWidgetSidebar(r)}),t._UZ(6,"nb-icon",6),t.qZA(),t.TgZ(7,"div",7)(8,"button",8),t.NdJ("click",function(r){return n.save(r)}),t._uU(9,"\u66f4\u65b0"),t.qZA(),t._UZ(10,"div",9),t.TgZ(11,"button",10),t.NdJ("click",function(r){return n.toggleSettingSidebar(r)}),t._UZ(12,"nb-icon",11),t.qZA()()()(),t.TgZ(13,"div",12)(14,"div",13)(15,"div",14)(16,"div",15)(17,"div",16)(18,"nb-card",17)(19,"nb-card-header")(20,"nb-form-field")(21,"input",18),t.NdJ("keyup",function(r){return n.search(r)}),t.qZA(),t._UZ(22,"nb-icon",19),t.qZA()(),t.TgZ(23,"nb-card-body",20),t.YNc(24,Zt,2,1,"ng-container",21),t.ALo(25,"async"),t.qZA()()()()()(),t.TgZ(26,"div",22)(27,"div",14)(28,"div",23)(29,"nb-card",24)(30,"nb-card-body")(31,"div",25)(32,"div",26),t.YNc(33,At,8,3,"nb-accordion",27),t.qZA()()()()()()(),t.TgZ(34,"div",28),t.NdJ("blur",function(r){return n.unselectWidget(r)}),t.TgZ(35,"div",14)(36,"div",15)(37,"div",29)(38,"nb-card",30)(39,"nb-card-body",31)(40,"nb-tabset",15),t.YNc(41,Nt,3,2,"nb-tab",32),t.TgZ(42,"nb-tab",33)(43,"nb-card",34),t.YNc(44,yt,7,4,"nb-card-header",35),t.TgZ(45,"nb-card-body",36),t.YNc(46,Mt,2,1,"nb-accordion",37),t.qZA()()()()()()()()()()()()(),t.YNc(47,Dt,11,1,"ng-template",null,38,t.W1O)),2&e&&(t.ekj("sidebar-compact",n.leftSidebarCompact)("sidebar-expanded",!n.leftSidebarCompact),t.xp6(4),t.Q6J("status",n.hasHiddenWidgetSidebar?"primary":"control"),t.xp6(2),t.ekj("sidebar-widget-toggle-animation",!n.hasHiddenWidgetSidebar),t.xp6(8),t.Q6J("hidden",n.hasHiddenWidgetSidebar),t.xp6(10),t.Q6J("ngForOf",t.lcZ(25,14,n.filterWidgetCategories)),t.xp6(9),t.Q6J("ngForOf",n.blocks),t.xp6(1),t.Q6J("hidden",n.hasHiddenSettingSidebar),t.xp6(7),t.Q6J("ngIf",n.blocks.length>0),t.xp6(3),t.Q6J("ngIf",n.selectedWidget),t.xp6(2),t.Q6J("ngIf",n.selectedWidget))},dependencies:function(){return[u.sg,u.O5,d.Asz,d.yKW,d.XWE,d.ndF,d.kyn,d.TR4,d.ydg,d.DPz,d.h8i,d.qCO,d.SaG,d.YZd,d.AvE,d.fMN,d.jBG,d.yyc,d.zP_,d.qBV,F._,Ot,u.Ov]},styles:['.sidebar-widget-item[_ngcontent-%COMP%]{width:33.3%;color:var(--text-basic-color);display:flex;flex-direction:column;align-items:center;cursor:pointer}.sidebar-widget-item[_ngcontent-%COMP%]:focus   span[_ngcontent-%COMP%], .sidebar-widget-item[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:var(--text-hint-color);font-weight:700}[_nghost-%COMP%]{min-height:calc(100vh - var(--header-height) - 60px);overflow:hidden;position:absolute;inset:0}[_nghost-%COMP%]     nb-layout nb-layout-column{padding:0!important}[_nghost-%COMP%]   .scrollable[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;flex:1}[_nghost-%COMP%]   .sidebar-expanded[_ngcontent-%COMP%]{left:var(--sidebar-width)!important}[_nghost-%COMP%]   .sidebar-compact[_ngcontent-%COMP%]{left:var(--sidebar-width-compact)!important}[_nghost-%COMP%]   .component-skeleton[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:auto;max-height:100%;position:fixed;top:var(--header-height);right:0;bottom:0;left:var(--sidebar-width-compact)}[_nghost-%COMP%]   .component-skeleton-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden;flex:0 1 100%;padding-bottom:60px}[_nghost-%COMP%]   .sidebar-widget-toggle-animation[_ngcontent-%COMP%]{transition:transform .3s;transform:rotate(45deg)}[_nghost-%COMP%]   nb-tabset[_ngcontent-%COMP%]   nb-tab[_ngcontent-%COMP%]{padding-bottom:2.875rem!important}[_nghost-%COMP%]   nb-accordion[_ngcontent-%COMP%], [_nghost-%COMP%]   widget-item[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   nb-accordion[_ngcontent-%COMP%]:focus:after, [_nghost-%COMP%]   widget-item[_ngcontent-%COMP%]:focus:after, [_nghost-%COMP%]   nb-accordion-item-header[_ngcontent-%COMP%]:focus:after{content:"";position:absolute;z-index:1;pointer-events:none;inset:1px;box-shadow:0 0 0 1.5px var(--color-danger-focus);border-radius:var(--accordion-border-radius);outline:2px solid transparent}']}),i})(),Ot=(()=>{class i{get Id(){return this.product.id}constructor(e,n){this.http=e,this.ds=n}ngOnInit(){this.render(this.product.form.getRawValue()),this.subscribeChange=this.product.form.valueChanges.subscribe(e=>{this.render(e)})}render(e){e.name=this.product.widget.name,this.http.post("/widget/{name}/rendered",e).subscribe(n=>{n.output&&(this.container.nativeElement.innerHTML=n.output)})}ngAfterViewInit(){}isMedia(){return["image","file","video","audio","cover","gallery"].includes(this.product.widget.name)}ngOnDestroy(){this.subscribeChange&&this.subscribeChange.unsubscribe(),this.subscribeChange=void 0}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.eN),t.Y36(D.H7))},i.\u0275cmp=t.Xpm({type:i,selectors:[["widget-item"]],viewQuery:function(e,n){if(1&e&&t.Gf(Et,5,t.SBq),2&e){let o;t.iGM(o=t.CRH())&&(n.container=o.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.Id)},inputs:{product:"product"},decls:3,vars:4,consts:[["container",""],["style","width: 100px; height: 100px",3,"pack","icon",4,"ngIf"],[2,"width","100px","height","100px",3,"pack","icon"]],template:function(e,n){1&e&&(t.TgZ(0,"div",null,0),t.YNc(2,Jt,1,2,"nb-icon",1),t.qZA()),2&e&&(t.Gre("widget-container widget-",n.product.widget.name,""),t.xp6(2),t.Q6J("ngIf",n.isMedia()))},dependencies:[u.O5,d.fMN],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;margin:1.25rem 0}\n/*# sourceMappingURL=widget.component.ts-angular-inline--10.css.map*/"]}),i})();var qt=l(1784);function Bt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.upgrade(o.alias))}),t._uU(1,"\u5347\u7ea7"),t.qZA()}if(2&i){const e=t.oxw().$implicit,n=t.oxw();t.Q6J("disabled",!e.isUpgrade||n.spinner)}}function St(i,s){if(1&i&&t._UZ(0,"img",16),2&i){const e=t.oxw().$implicit,n=t.oxw();t.s9C("alt",e.name),t.Q6J("src",n.sanitizer.bypassSecurityTrustResourceUrl(e.image),t.LSH)}}function Ut(i,s){if(1&i&&(t.TgZ(0,"div",17),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.description," ")}}function Qt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",8)(1,"nb-card")(2,"nb-card-header",9)(3,"div"),t._uU(4),t.qZA(),t.YNc(5,Bt,2,1,"button",10),t.qZA(),t.TgZ(6,"nb-card-body"),t.YNc(7,St,1,2,"img",11),t.YNc(8,Ut,2,1,"div",12),t.qZA(),t.TgZ(9,"nb-card-footer",9)(10,"button",13),t.NdJ("click",function(){const r=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.delete(r.alias))}),t._uU(11,"\u5220\u9664"),t.qZA(),t.TgZ(12,"button",14),t.NdJ("click",function(){const r=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.activate(r.alias))}),t._uU(13),t.qZA()()()()}if(2&i){const e=s.$implicit,n=t.oxw();t.xp6(4),t.Oqu(e.name),t.xp6(1),t.Q6J("ngIf",e.isUpgrade),t.xp6(2),t.Q6J("ngIf",e.image),t.xp6(1),t.Q6J("ngIf",!e.image),t.xp6(2),t.Q6J("disabled",e.enabled||n.spinner)("nbSpinner",n.spinner),t.xp6(2),t.Q6J("status",e.enabled?"warning":"primary")("nbSpinner",n.spinner)("disabled",n.spinner),t.xp6(1),t.hij(" ",e.enabled?"\u91cd\u88c5":"\u542f\u7528"," ")}}function Lt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"nb-card")(1,"nb-card-header"),t._uU(2,"\u5728\u7ebf\u4e0b\u8f7d"),t.qZA(),t.TgZ(3,"nb-card-body"),t._UZ(4,"input",18,19),t.qZA(),t.TgZ(6,"nb-card-footer",9)(7,"button",20),t.NdJ("click",function(){const r=t.CHM(e).dialogRef;return t.KtG(r.close())}),t._uU(8,"\u53d6\u6d88"),t.qZA(),t.TgZ(9,"button",21),t.NdJ("click",function(){const r=t.CHM(e).dialogRef,a=t.MAs(5),c=t.oxw();return t.KtG(c.openDownload(a.value,r))}),t._uU(10,"\u4e0b\u8f7d"),t.qZA()()()}}const Gt=function(){return["zip"]};let Ht=(()=>{class i{constructor(e,n,o,r,a,c){this.http=e,this.toast=n,this.route=o,this.sanitizer=r,this.dialog=a,this.sidebar=c,this.themes=[],this.title="",this.spinner=!1}onSpinner(e){this.spinner=e}ngOnInit(){this.getThemes(),this.route.data.subscribe(e=>{this.title=e.title})}getThemes(){this.http.get("/theme").subscribe(e=>{e.records.length>0&&(this.themes=e.records)})}activate(e){this.http.post("/theme/{name}/activate",{name:e}).subscribe(n=>{this.getThemes()})}upgrade(e){this.http.post("/theme/{name}/upgrade",{name:e}).subscribe(n=>{this.getThemes()})}upload(e){e.length<1?this.toast.danger("\u4e0a\u4f20\u7684\u4e3b\u9898\u6587\u4ef6\u4e3a\u7a7a","\u4e0a\u4f20\u4e3b\u9898"):this.http.post(I,{uri:e.pop()}).subscribe(n=>{this.getThemes()})}openDownload(e,n){/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(e)?this.http.post(I,{uri:e}).subscribe(r=>{n.close()}):this.toast.danger("\u4e0d\u5408\u6cd5\u7684url\u94fe\u63a5","\u4e0a\u4f20\u4e3b\u9898")}delete(e){this.http.post("/theme/{name}/delete",{name:e}).subscribe(n=>{this.getThemes()})}ngAfterViewInit(){(0,f.H)(300).subscribe(e=>{this.sidebar.toggle(!0,"menu-sidebar")})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.eN),t.Y36(d.quB),t.Y36(x.gz),t.Y36(D.H7),t.Y36(d.Gln),t.Y36(d.lzT))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-theme"]],decls:13,vars:4,consts:[[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex"],["nbButton","","status","danger",1,"me-2",3,"click"],[3,"suffix","status","finish"],["class","col-12 col-md-6 col-lg-4 col-xxl-3",4,"ngFor","ngForOf"],["dialogTpl",""],[1,"col-12","col-md-6","col-lg-4","col-xxl-3"],[1,"d-flex","justify-content-between"],["nbButton","","status","warning",3,"disabled","click",4,"ngIf"],["width","100%",3,"alt","src",4,"ngIf"],["class","description",4,"ngIf"],["nbButton","","status","danger",3,"disabled","nbSpinner","click"],["nbButton","",3,"status","nbSpinner","disabled","click"],["nbButton","","status","warning",3,"disabled","click"],["width","100%",3,"alt","src"],[1,"description"],["nbInput","","name","url","type","url","placeholder","\u4e0b\u8f7d\u5730\u5740"],["url",""],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"click"]],template:function(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header",2)(4,"span"),t._uU(5,"\u4e3b\u9898\u5217\u8868"),t.qZA(),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){t.CHM(o);const a=t.MAs(12);return t.KtG(n.dialog.open(a))}),t._uU(8,"\u5728\u7ebf\u4e0b\u8f7d"),t.qZA(),t.TgZ(9,"app-upload",5),t.NdJ("finish",function(a){return n.upload(a)}),t.qZA()()()()(),t.YNc(10,Qt,14,10,"div",6),t.qZA(),t.YNc(11,Lt,11,0,"ng-template",null,7,t.W1O)}2&e&&(t.xp6(9),t.Q6J("suffix",t.DdM(3,Gt))("status","primary"),t.xp6(1),t.Q6J("ngForOf",n.themes))},dependencies:[u.sg,u.O5,d.Asz,d.yKW,d.XWE,d.ndF,d.DPz,d.h8i,d.Q7R,qt.o],encapsulation:2}),i})();var Yt=l(3911),Pt=l(2521);function Kt(i,s){if(1&i&&(t.TgZ(0,"nb-tab",3)(1,"div",4),t._UZ(2,"control-container",5),t.qZA()()),2&i){const e=s.$implicit,n=s.index,o=t.oxw();t.Q6J("tabId",e.id)("lazyLoad",!1)("active",0==n)("tabTitle",e.label)("tabIndex",n),t.xp6(2),t.Q6J("controls",e.controls)("form",o.formGroup)}}let zt=(()=>{class i{constructor(e,n){this.http=e,this.sidebar=n,this.sections=[],this.spinner=!1,this.theme={},this.data={},this.values={},this.isChanged=!1}ngAfterViewInit(){(0,f.H)(300).subscribe(e=>{this.sidebar.toggle(!0,"menu-sidebar")})}ngOnInit(){this.http.get("/theme/customize").subscribe(e=>{const n=[];e.sections.forEach(o=>{n.push(...o.controls)}),this.formGroup=(0,T.T)(n);for(let o in this.formGroup.controls)this.values[o]=this.formGroup.controls[o].value;this.formGroup.valueChanges.subscribe(o=>{let r=!1;for(let a in o)o[a]!=this.values[a]?(this.data[a]=o[a]||null,r=!0):this.data.hasOwnProperty(a)&&delete this.data[a];this.isChanged=r}),this.sections=e.sections,this.theme=e.theme})}save(e){this.isChanged&&this.http.post("/theme/customized",{customized:this.data},{context:(new h.qT).set(v.a,this)}).subscribe(()=>{this.isChanged=!1;for(const n in this.data)this.values[n]=this.data[n]})}onSpinner(e){this.spinner=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.eN),t.Y36(d.lzT))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-theme-custom"]],decls:9,vars:3,consts:[[1,"float-end"],["size","small","status","success","nbButton","",3,"disabled","click"],[3,"tabId","lazyLoad","active","tabTitle","tabIndex",4,"ngFor","ngForOf"],[3,"tabId","lazyLoad","active","tabTitle","tabIndex"],[1,"col-6","mx-auto"],[3,"controls","form"]],template:function(e,n){1&e&&(t.TgZ(0,"nb-card")(1,"nb-card-header"),t._uU(2),t.TgZ(3,"div",0)(4,"button",1),t.NdJ("click",function(r){return n.save(r)}),t._uU(5,"\u4fdd\u5b58\u53d1\u5e03"),t.qZA()()(),t.TgZ(6,"nb-card-body")(7,"nb-tabset"),t.YNc(8,Kt,3,7,"nb-tab",2),t.qZA()()()),2&e&&(t.xp6(2),t.hij(" \u4f60\u6b63\u5728\u81ea\u4e49 ",n.theme.stylesheet," "),t.xp6(2),t.Q6J("disabled",n.spinner||!n.isChanged),t.xp6(4),t.Q6J("ngForOf",n.sections))},dependencies:[u.sg,d.Asz,d.yKW,d.ndF,d.kyn,d.TR4,d.DPz,F._],encapsulation:2}),i})();var $t=l(4090);const Rt=[{path:"navigation",title:"\u5bfc\u822a",component:_t},{path:"widget",title:"\u6302\u4ef6",component:Wt},{path:"theme",title:"\u4e3b\u9898",component:Ht},{path:"custom",title:"\u81ea\u5b9a\u4e49",component:zt}];let jt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[u.ez,Yt.O,x.Bz.forChild(Rt),C._t,Pt.c,$t.s]}),i})()}}]);
//# sourceMappingURL=140.9a24aacdddd3b1a8.js.map