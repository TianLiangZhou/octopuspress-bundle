import{c as g,g as B,h as te}from"./chunk-EAKQQOR6.js";import{a as V}from"./chunk-VHVIKD6E.js";import{B as ee,t as T}from"./chunk-QJO7QQNE.js";import{Db as W,Ea as p,Fa as u,Ga as c,Ka as $,La as y,Ma as S,N as q,Nb as F,R as z,S as A,T as H,Tb as x,Xa as f,Y as U,Ya as Y,Yb as J,Za as G,af as j,bf as K,cf as Q,df as Z,gc as N,hc as h,ia as a,jc as b,lc as w,na as m,ne as O,oc as I,pa as C,pd as E,qa as R,qd as _,rb as P,sd as D,ua as X,vd as M,wb as L,ya as l}from"./chunk-J7X6RXHA.js";function oe(o,ne){if(o&1){let e=$();p(0,"form",1),y("ngSubmit",function(t){A(e);let n=S();return H(n.onSubmit(t))}),c(1,"control-container",2)(2,"control-container",3),p(3,"div",4),c(4,"label",5),p(5,"button",6),f(6,"\u66F4\u65B0"),u()()()}if(o&2){let e=S();l("formGroup",e.formGroup),a(),l("controls",e.controls)("form",e.formGroup),a(),l("controls",e.metaControls)("form",e.metaGroup),a(3),l("disabled",e.formGroup.invalid||e.spinner)("nbSpinner",e.spinner)}}var Se=(()=>{class o{constructor(e,i){this.http=e,this.config=i,this.create=new U,this.spinner=!1,this.controls=[],this.metaControls=[]}ngOnChanges(e){this.buildForm()}ngOnInit(){}onSpinner(e){this.spinner=e}buildForm(){let e=[];if(this.setting.labels.nameField&&e.push({label:this.setting.labels.nameField,required:!0,id:"name",type:"input",description:this.setting.labels.nameFieldDescription}),this.setting.labels.slugField&&e.push({label:this.setting.labels.slugField,id:"slug",type:"input",value:"",validators:[{key:"pattern",value:"^[a-z0-9]+(?:-[a-z0-9]+)*$"}],description:this.setting.labels.slugFieldDescription}),this.setting.labels.parentField&&this.setting.hierarchical){let n=[{label:"\u65E0",value:""}];e.push({label:this.setting.labels.parentField,id:"parent",required:!1,type:"select",value:"",options:n,description:this.setting.labels.parentFieldDescription}),this.http.get(j.replace("{taxonomy}",this.setting.slug)).subscribe(s=>{s.records.forEach(r=>{let v=r.name;r.level!=null&&r.level>0&&(v="--".repeat(r.level)+r.name),n.push({label:v,value:r.id})})})}this.setting.labels.descField&&e.push({label:this.setting.labels.descField,id:"description",type:"textarea",value:"",description:this.setting.labels.descFieldDescription,required:!1}),this.formGroup=new h(g(e)),this.formGroup.addControl("id",new b(0)),this.formGroup.addControl("taxonomy",new b(this.setting.slug));let i=this.config.taxonomyMeta(this.setting.slug),t=[];i.length>0&&i.forEach(n=>{n.showUi&&n.isUpdated&&n.control&&t.push(n.control)}),this.formGroup.addControl("meta",new h(g(t))),this.metaControls=t,this.controls=e}onSubmit(e){if(this.formGroup?.invalid)return;let i=this.formGroup?.getRawValue();this.http.post(Q.replace("{taxonomy}",this.setting.slug),i,{context:new F().set(V,this)}).subscribe(t=>{this.formGroup?.reset(),this.formGroup?.controls.taxonomy.setValue(this.setting.slug),this.formGroup?.controls.parent?.setValue(""),this.create.emit(t)})}get metaGroup(){return this.formGroup?.controls.meta}static{this.\u0275fac=function(i){return new(i||o)(m(x),m(T))}}static{this.\u0275cmp=C({type:o,selectors:[["app-taxonomy-create"]],inputs:{setting:"setting"},outputs:{create:"create"},standalone:!1,features:[z],decls:11,vars:9,consts:[[3,"ngSubmit","formGroup"],[3,"controls","form"],[1,"my-3","d-flex","justify-content-between"],[1,"label","col-form-label"],["type","submit","status","primary","size","small","nbButton","",3,"disabled","nbSpinner"]],template:function(i,t){i&1&&(p(0,"nb-card")(1,"nb-card-header"),f(2),u(),p(3,"nb-card-body")(4,"form",0),y("ngSubmit",function(s){return t.onSubmit(s)}),c(5,"control-container",1)(6,"control-container",1),p(7,"div",2),c(8,"label",3),p(9,"button",4),f(10),u()()()()()),i&2&&(a(2),G(" ",t.formGroup.controls.id.value<1?t.setting.labels.addNewItem:t.setting.labels.editItem," "),a(2),l("formGroup",t.formGroup),a(),l("controls",t.controls)("form",t.formGroup),a(),l("controls",t.metaControls)("form",t.metaGroup),a(3),l("disabled",t.formGroup.invalid||t.spinner)("nbSpinner",t.spinner),a(),G(" ",t.formGroup.controls.id.value<1?t.setting.labels.addNewItem:"\u66F4\u65B0"," "))},dependencies:[w,N,I,D,_,E,M,O,B],encapsulation:2})}}return o})(),Ge=(()=>{class o{constructor(e,i,t,n){this.http=e,this.route=i,this.location=t,this.config=n,this.controls=[],this.spinner=!1,this.metaControls=[]}ngOnInit(){this.route.paramMap.subscribe(e=>{let i=parseInt(e.get("id")||"0",10);if(i<1){this.location.back();return}this.http.get(K,{params:{id:i}}).subscribe(t=>{let s=this.config.taxonomies()[t.taxonomy];if(!s){this.location.back();return}this.buildSetting(s,t)},t=>{this.location.back()})})}onSpinner(e){this.spinner=e}buildSetting(e,i){if(!e.visibility.showUi){this.location.back();return}let t=[];if(e.labels.nameField&&t.push({label:e.labels.nameField,required:!0,value:i.name,id:"name",type:"input",description:e.labels.nameFieldDescription}),e.labels.slugField&&t.push({label:e.labels.slugField,id:"slug",type:"input",value:i.slug,validators:[{key:"pattern",value:"^[a-z0-9]+(?:-[a-z0-9]+)*$"}],description:e.labels.slugFieldDescription}),e.labels.parentField&&e.hierarchical){let r=[{label:"\u65E0",value:""}];t.push({label:e.labels.parentField,id:"parent",required:!1,type:"select",value:i.parent||"",options:r,description:e.labels.parentFieldDescription}),this.http.get(j.replace("{taxonomy}",i.taxonomy)).subscribe(v=>{v.records.forEach(d=>{let k=d.name;d.level!=null&&d.level>0&&(k="--".repeat(d.level)+d.name),r.push({label:k,value:d.id})})})}e.labels.descField&&t.push({label:e.labels.descField,id:"description",type:"textarea",value:i.description,description:e.labels.descFieldDescription,required:!1}),this.formGroup=new h(g(t)),this.formGroup.addControl("id",new b(i.id)),this.formGroup.addControl("taxonomy",new b(i.taxonomy));let n=this.config.taxonomyMeta(i.taxonomy),s=[];n.length>0&&n.forEach(r=>{r.showUi&&r.isUpdated&&r.control&&s.push(r.control)}),this.formGroup.addControl("meta",new h(g(s,i.meta))),this.controls=t,this.metaControls=s,this.taxonomySetting=e}get metaGroup(){return this.formGroup?.controls.meta}onSubmit(e){if(this.formGroup?.invalid)return;let i=this.formGroup?.getRawValue();this.http.post(Z.replace("{taxonomy}",i.taxonomy),i,{context:new F().set(V,this)}).subscribe(t=>{this.location.back()})}static{this.\u0275fac=function(i){return new(i||o)(m(x),m(J),m(P),m(T))}}static{this.\u0275cmp=C({type:o,selectors:[["app-taxonomy-edit"]],standalone:!1,decls:5,vars:2,consts:[[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["direction","",3,"controls","form"],[3,"controls","form"],[1,"my-3","d-flex","justify-content-between"],[1,"label","col-form-label"],["type","submit","status","primary","size","small","nbButton","",3,"disabled","nbSpinner"]],template:function(i,t){i&1&&(p(0,"nb-card")(1,"nb-card-header"),f(2),u(),p(3,"nb-card-body"),X(4,oe,7,7,"form",0),u()()),i&2&&(a(2),Y(t.taxonomySetting?t.taxonomySetting.labels.editItem:""),a(2),l("ngIf",t.formGroup))},dependencies:[L,w,N,I,D,_,E,M,O,B],encapsulation:2})}}return o})();var De=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=R({type:o})}static{this.\u0275inj=q({imports:[W,ee,te]})}}return o})();export{Se as a,Ge as b,De as c};
