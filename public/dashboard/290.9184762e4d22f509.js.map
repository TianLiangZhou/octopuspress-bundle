{"version":3,"file":"290.9184762e4d22f509.js","mappings":"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","names":["i0","MemberComponent","constructor","http","activatedRoute","configService","this","label","value","route","snapshot","ngOnInit","roles","settings","buildSettings","source","ServerDataSource","endPoint","USER_MEMBER","dataKey","totalKey","pagerPageKey","pagerLimitKey","filterFieldKey","selectMode","actions","position","add","edit","delete","columnTitle","editButtonContent","saveButtonContent","cancelButtonContent","deleteButtonContent","confirmDelete","pager","perPage","mode","rowClassFunction","columns","account","title","type","IColumnType","filter","valuePrepareFunction","user","avatar","id","nickname","length","name","forEach","val","push","join","email","registeredAt","$event","data","window","confirm","deleteUser","post","USER_DELETE_MEMBER","subscribe","_","_a","refresh","alert","batch","getSelectedItems","item","batchMode","resetEmail","context","HttpContext","set","SPINNER","USER_RESET_EMAIL","onSpinner","spinner","core","selectors","ctx","NewComponent","router","ckfinder","FormGroup","FormControl","Validators","url","password","meta","ngOnDestroy","subscription","unsubscribe","onChoose","files","formGroup","controls","setValue","metaGroup","addControl","paramMap","map","path","USER_SELF_PROFILE","has","userId","parseInt","get","isNaN","navigateByUrl","then","USER_MEMBER_PROFILE","response","buildEditorForm","onSubmit","body","getRawValue","USER_CREATE_MEMBER","USER_UPDATE_MEMBER","getInputType","showPassword","toggleShowPassword","removeValidators","disable","patchValue","getBtnName","replace","popup","resourceType","multi","routes","component","pathMatch","UserModule","CommonModule","ThemeModule","RouterModule","Angular2SmartTableModule","ControlModule","UploadModule"],"sourceRoot":"webpack:///","sources":["./dashboard/app/pages/user/member.component.html","./dashboard/app/pages/user/member.component.ts","./dashboard/app/pages/user/new.component.html","./dashboard/app/pages/user/new.component.ts","./dashboard/app/pages/user/user.module.ts"],"sourcesContent":["<nb-card>\n  <nb-card-header class=\"d-flex justify-content-between align-items-center\">\n    <span>{{route.title}}</span>\n    <a routerLink=\"/app/user/new\" nbButton size=\"small\" status=\"primary\"><nb-icon icon=\"plus-outline\"></nb-icon></a>\n  </nb-card-header>\n  <nb-card-body>\n    <form (ngSubmit)=\"batch()\" class=\"mb-2\">\n      <div class=\"row\">\n        <nb-select class=\"col\" name=\"batchMode\" [(ngModel)]=\"batchMode\">\n          <nb-option [value]=\"option.value\" *ngFor=\"let option of batches\">{{option.label}}</nb-option>\n        </nb-select>\n        <div class=\"col-1 ms-2\">\n          <button nbButton status=\"primary\" [disabled]=\"!batchMode || spinner\" [nbSpinner]=\"spinner\" type=\"submit\">应用</button>\n        </div>\n      </div>\n    </form>\n    <angular2-smart-table\n      [settings]=\"settings\"\n      [source]=\"source\"\n      (delete)=\"delete($event)\">\n    </angular2-smart-table>\n  </nb-card-body>\n</nb-card>\n","import {Component, OnInit} from '@angular/core';\nimport {User} from \"../../@core/definition/user/type\";\nimport {USER_DELETE_MEMBER, USER_MEMBER, USER_RESET_EMAIL} from '../../@core/definition/user/api';\nimport {HttpClient, HttpContext} from \"@angular/common/http\";\nimport {IColumnType, ServerDataSource} from \"angular2-smart-table\";\nimport {DeleteEvent} from \"angular2-smart-table/lib/lib/events\";\nimport {Settings} from \"angular2-smart-table/lib/lib/settings\";\nimport {ConfigurationService} from \"../../@core/services/configuration.service\";\nimport {ActivatedRoute, ActivatedRouteSnapshot} from \"@angular/router\";\nimport {OnSpinner} from \"../../@core/definition/common\";\nimport {SPINNER} from \"../../@core/interceptor/authorization\";\n\n@Component({\n  selector: 'app-user',\n  templateUrl: './member.component.html',\n})\nexport class MemberComponent implements OnInit, OnSpinner {\n  settings = {};\n  source: ServerDataSource | undefined;\n  batches = [\n    {'label': '批量操作', 'value': ''},\n    {'label': '删除', 'value': 'delete'},\n    {'label': '发送密码重置邮件', 'value': 'reset'},\n  ];\n  batchMode: string = '';\n  private roles: {label: string}[] = [];\n  route: ActivatedRouteSnapshot;\n  spinner: boolean = false;\n\n  constructor(private http: HttpClient,\n              protected activatedRoute: ActivatedRoute,\n              protected configService: ConfigurationService) {\n\n    this.route = activatedRoute.snapshot;\n  }\n\n\n  ngOnInit(): void {\n    this.roles = this.configService.roles();\n    this.settings = this.buildSettings()\n    this.source = new ServerDataSource(this.http, {\n      endPoint: USER_MEMBER,\n      dataKey: 'records',\n      totalKey: 'total',\n      pagerPageKey: 'page',\n      pagerLimitKey: 'limit',\n      filterFieldKey: '#field#',\n    });\n  }\n\n\n  private buildSettings(): Settings {\n    return {\n      selectMode: 'multi',\n      actions: {\n        position: 'right',\n        add: false,\n        edit: false,\n        delete: true,\n        columnTitle: '操作',\n      },\n      edit: {\n        editButtonContent: '<i class=\"nb-edit\"></i>',\n        saveButtonContent: '<i class=\"nb-checkmark\"></i>',\n        cancelButtonContent: '<i class=\"nb-close\"></i>',\n      },\n      delete: {\n        deleteButtonContent: '<i class=\"nb-trash\"></i>',\n        confirmDelete: true,\n      },\n      pager: {\n        perPage: 30,\n      },\n      mode: 'external',\n      rowClassFunction: () => {\n        return 'text-break';\n      },\n      columns: {\n        account: {\n          title: '用户名',\n          type: IColumnType.Html,\n          filter: true,\n          valuePrepareFunction: (account: string, user: User) => {\n            return `<img width=\"50\" alt=\"\" src=\"${user.avatar}\" />\n            <a href=\"#/app/user/${user.id}\">${account}</a>`\n          }\n        },\n        nickname: {\n          title: '显示名称',\n          type: IColumnType.Text,\n          filter: true,\n          valuePrepareFunction: (nickname: string, user: User) => {\n            return nickname == user.account ? '-' : nickname;\n          }\n        },\n        roles: {\n          title: '角色',\n          type: IColumnType.Text,\n          valuePrepareFunction: (roles: number[], user: User) => {\n            if (roles.length < 1) {\n              return '-';\n            }\n            let name: string[] = [];\n            roles.forEach(val => {\n              if (this.roles[val - 1]) {\n                name.push(this.roles[val - 1].label)\n              }\n            });\n            return name.join(',');\n          },\n        },\n        email: {\n          title: '邮箱',\n          type: IColumnType.Html,\n          filter: true,\n          valuePrepareFunction: (email: string, user: User) => {\n            return `<a href=\"mailto:${email}\">${email}</a>`\n          }\n        },\n        registeredAt: {\n          title: '加入时间',\n          type: IColumnType.Text,\n          filter: false,\n        },\n      }\n    }\n  }\n\n  delete($event: DeleteEvent) {\n    let user: User = $event.data;\n    if (user.id == 1) {\n      window.alert(\"此用户不能被删除!\");\n      return ;\n    }\n    if (window.confirm(\"确认删除用户: \" + user.account)) {\n      this.deleteUser([user.id]);\n      this.http.post(USER_DELETE_MEMBER, {id: user.id})\n        .subscribe(_ => {\n          this.source?.refresh();\n        });\n    }\n  }\n\n  batch() {\n    let id: number[] = [];\n    this.source?.getSelectedItems().forEach((item: User) => {\n      id.push(item.id);\n    });\n    switch (this.batchMode) {\n      case 'delete':\n        if (id.length > 0 && window.confirm(\"确认删除已选择的用户?\")) {\n          this.deleteUser(id);\n        }\n        break;\n      case 'reset':\n        if (id.length > 0 && window.confirm(\"确认给已选择的用户发送重置密码邮件?\")) {\n          this.resetEmail(id);\n        }\n        break;\n    }\n  }\n\n  private deleteUser(id: number[]) {\n    this.http.post(USER_DELETE_MEMBER, {id: id}, {context:new HttpContext().set(SPINNER, this)})\n      .subscribe(_ => {\n        this.source?.refresh();\n      });\n  }\n  private resetEmail(id: number[]) {\n    this.http.post(USER_RESET_EMAIL, {id: id}, {context:new HttpContext().set(SPINNER, this)}).subscribe();\n  }\n\n  onSpinner(spinner: boolean): void {\n    this.spinner = spinner;\n  }\n}\n","<nb-card>\n  <nb-card-header>{{route.title}}</nb-card-header>\n  <nb-card-body>\n    <form (ngSubmit)=\"onSubmit($event)\" [formGroup]=\"formGroup\">\n      <div class=\"mb-3 row\">\n        <label for=\"inputName\" class=\"label col-form-label col-12 col-md-2\">用户名</label>\n        <div class=\"col-12 col-md-5\">\n          <input nbInput id=\"inputName\" fullWidth status=\"primary\" formControlName=\"account\" />\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">用户名在站点登陆中使用，不可以修改。</label>\n      </div>\n\n      <div class=\"mb-3 row\">\n        <label for=\"inputEmail\" class=\"label col-form-label col-12 col-md-2\">邮箱</label>\n        <div class=\"col-12 col-md-5\">\n          <input nbInput id=\"inputEmail\" fullWidth status=\"primary\" type=\"email\" formControlName=\"email\" />\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">在忘记密码的时候可以通过邮箱找回密码。</label>\n      </div>\n\n      <div class=\"mb-3 row\">\n        <label for=\"inputNickname\" class=\"label col-form-label col-12 col-md-2\">显示名称</label>\n        <div class=\"col-12 col-md-5\">\n          <input nbInput id=\"inputNickname\" fullWidth status=\"primary\" formControlName=\"nickname\" />\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">显示在站点的任何地方。</label>\n      </div>\n\n      <div class=\"mb-3 row\">\n        <label for=\"inputUrl\" class=\"label col-form-label col-12 col-md-2\">网站地址</label>\n        <div class=\"col-12 col-md-5\">\n          <input nbInput id=\"inputUrl\" fullWidth status=\"primary\" type=\"url\" formControlName=\"url\" />\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">个人网页地址。</label>\n      </div>\n\n      <div class=\"mb-3 row\">\n        <label for=\"inputPassword\" class=\"label col-form-label col-12 col-md-2\">密码</label>\n        <div class=\"col-12 col-md-5\">\n          <nb-form-field>\n            <input nbInput id=\"inputPassword\"   fullWidth status=\"primary\" [type]=\"getInputType()\" formControlName=\"password\" />\n            <button nbSuffix nbButton ghost type=\"button\" (click)=\"toggleShowPassword()\">\n              <nb-icon [icon]=\"showPassword ? 'eye-outline' : 'eye-off-2-outline'\"\n                       pack=\"eva\"\n                       [attr.aria-label]=\"showPassword ? 'hide password' : 'show password'\">\n              </nb-icon>\n            </button>\n          </nb-form-field>\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">\n          必须是数字字母组合，不修改密码保持为空即可。\n        </label>\n      </div>\n      <div class=\"mb-3 row\">\n        <label class=\"label col-form-label col-12 col-md-2\">个性头像</label>\n        <div class=\"col-12 col-md-5\">\n          <div class=\" d-flex justify-content-between align-items-center\">\n            <img alt=\"头像\" [src]=\"formGroup.controls['avatar'].value\" width=\"128\" />\n            <button type=\"button\" size=\"medium\" nbButton (click)=\"avatar()\">选择头像</button>\n          </div>\n        </div>\n        <label class=\"label offset-md-2 col-form-label\">请使用相同比例正方形图片。</label>\n      </div>\n\n      <div class=\"mb-3 row\">\n        <label for=\"inputRole\" class=\"label col-form-label col-12 col-md-2\">角色</label>\n        <div class=\"col-12 col-md-5\">\n          <nb-select multiple id=\"inputRole\" fullWidth formControlName=\"roles\">\n            <nb-option *ngFor=\"let option of roles\" [value]=\"option.value\">{{option.label}}</nb-option>\n          </nb-select>\n        </div>\n      </div>\n\n      <nb-card class=\"px-0 border-0\">\n        <nb-card-header class=\"px-0\">其它设置</nb-card-header>\n      </nb-card>\n      <div class=\"mb-3 row\" [formGroup]=\"metaGroup\">\n        <label for=\"inputEditor\" class=\"label col-form-label col-12 col-md-2\">可视化编辑器</label>\n        <div class=\"col-12 col-md-5\">\n          <nb-checkbox id=\"inputEditor\" formControlName=\"rich_editing\">撰写文章时不使用可视化编辑器</nb-checkbox>\n        </div>\n      </div>\n\n\n      <div class=\"mb-3 row\" [formGroup]=\"metaGroup\">\n        <label for=\"inputDescription\" class=\"label col-form-label col-12 col-md-2\">个人说明</label>\n        <div class=\"col-12 col-md-5\">\n          <textarea id=\"inputDescription\" formControlName=\"description\" fullWidth rows=\"5\" nbInput></textarea>\n        </div>\n      </div>\n\n\n      <control-container [controls]=\"controls\" [form]=\"metaGroup\"></control-container>\n      <div class=\"mb-3 row\">\n        <label class=\"label col-form-label col-12 col-md-2\"></label>\n        <div class=\"col-12 col-md-5\">\n          <button nbButton status=\"primary\" [disabled]=\"formGroup.invalid || spinner\" [nbSpinner]=\"spinner\" type=\"submit\">\n            {{ getBtnName() }}\n          </button>\n        </div>\n      </div>\n    </form>\n  </nb-card-body>\n</nb-card>\n","import {ChangeDetectorRef, Component, OnDestroy, OnInit} from '@angular/core';\nimport {\n  USER_CREATE_MEMBER,\n  USER_MEMBER_PROFILE,\n  USER_SELF_PROFILE,\n  USER_UPDATE_MEMBER\n} from '../../@core/definition/user/api';\nimport {FormControl, FormGroup, Validators} from \"@angular/forms\";\nimport {OnSpinner} from \"../../@core/definition/common\";\nimport {HttpClient, HttpContext} from \"@angular/common/http\";\nimport {ConfigurationService} from \"../../@core/services/configuration.service\";\nimport {ActivatedRoute, ActivatedRouteSnapshot, Router} from \"@angular/router\";\nimport {SPINNER} from \"../../@core/interceptor/authorization\";\nimport {User} from \"../../@core/definition/user/type\";\nimport {CKFinderService} from \"../../@core/services/ckfinder.service\";\nimport { Subscription } from 'rxjs';\n\n@Component({\n  selector: 'app-user-new',\n  templateUrl: './new.component.html',\n})\nexport class NewComponent implements OnInit, OnSpinner, OnDestroy {\n  formGroup: FormGroup = new FormGroup<any>({\n    id: new FormControl<number>(0),\n    account: new FormControl('', [Validators.required]),\n    email: new FormControl('', [Validators.required, Validators.email]),\n    nickname: new FormControl(''),\n    url: new FormControl('', [Validators.pattern('')]),\n    password: new FormControl('', [Validators.required, Validators.minLength(6), Validators.maxLength(32)]),\n    roles: new FormControl<number[]>([]),\n    avatar: new FormControl<string>(''),\n    meta: new FormGroup({}),\n  });\n  spinner: boolean = false;\n  roles: {value: string, label: string}[] = [\n    {value: '', label: '无'}\n  ];\n\n  controls = [];\n\n  showPassword = true;\n\n  route: ActivatedRouteSnapshot;\n  private subscription: Subscription | undefined;\n\n\n  constructor(private http: HttpClient,\n              private activatedRoute: ActivatedRoute,\n              private router: Router,\n              private ckfinder: CKFinderService,\n              private configService: ConfigurationService) {\n      this.route = activatedRoute.snapshot;\n  }\n\n  ngOnDestroy(): void {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n\n  ngOnInit(): void {\n    this.roles.push(...this.configService.roles());\n    this.subscription = this.ckfinder.onChoose().subscribe((files) => {\n      if (files.length < 1) {\n        return ;\n      }\n      this.formGroup.controls.avatar.setValue(files[0].url);\n    });\n    this.metaGroup.addControl('description', new FormControl(''));\n    this.metaGroup.addControl('rich_editing', new FormControl<boolean>(false));\n    this.activatedRoute.paramMap.subscribe(map => {\n      if (this.activatedRoute.snapshot.url[0].path !== 'new') {\n        let url = USER_SELF_PROFILE;\n        if (map.has('id')) {\n          let userId = parseInt(map.get('id') || '0', 10)\n          if (isNaN(userId) || userId < 1) {\n            this.router.navigateByUrl(\"/app/user\").then();\n            return;\n          }\n          url = USER_MEMBER_PROFILE.replace('{id}', userId + '');\n        }\n        this.http.get<User>(url).subscribe(response => {\n          this.buildEditorForm(response);\n        });\n      }\n    });\n  }\n\n  onSpinner(spinner: boolean): void {\n    this.spinner = spinner;\n  }\n\n  onSubmit($event: any) {\n    const body = this.formGroup.getRawValue();\n    let url = USER_CREATE_MEMBER;\n    if (body.id > 0) {\n      url = USER_UPDATE_MEMBER;\n    }\n    this.http.post(url, body, {\n      context: new HttpContext().set(SPINNER, this)\n    }).subscribe(() => {\n      this.router.navigateByUrl(\"/app/user\").then();\n    });\n  }\n  getInputType() {\n    if (this.showPassword) {\n      return 'text';\n    }\n    return 'password';\n  }\n\n  toggleShowPassword() {\n    this.showPassword = !this.showPassword;\n  }\n\n  get metaGroup() {\n    return this.formGroup.controls['meta'] as FormGroup;\n  }\n\n  private buildEditorForm(user: User) {\n    this.formGroup.controls['password'].removeValidators(Validators.required);\n    this.formGroup.controls['account'].disable();\n    this.formGroup.patchValue({\n      id: user.id,\n      avatar: user.avatar,\n      account: user.account,\n      nickname: user.nickname,\n      email: user.email,\n      url: user.url,\n      password: user.password,\n      roles: user.roles,\n      meta: user.meta\n    });\n  }\n\n  getBtnName() {\n    return this.formGroup.controls['id'].value < 1\n          ? '添加新用户'\n          : '更新' + this.route.title?.replace('编辑', '');\n  }\n\n  avatar() {\n    this.ckfinder.popup({\n      resourceType: 'Images',\n      multi: false,\n    });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport {MemberComponent} from './member.component';\nimport {ThemeModule} from '../../@theme/theme.module';\nimport {Angular2SmartTableModule} from \"angular2-smart-table\";\nimport {RouterModule, Routes} from \"@angular/router\";\nimport {NewComponent} from \"./new.component\";\nimport {ControlModule} from \"../../shared/control/control.module\";\nimport {UploadModule} from \"../../shared/upload/upload.module\";\n\n\nconst routes: Routes = [\n  {\n    path: '',\n    title: '所有用户',\n    component: MemberComponent,\n  },\n  {\n    path: 'new',\n    title: '添加新用户',\n    pathMatch: 'full',\n    component: NewComponent,\n  },\n  {\n    path: 'profile',\n    title: '个人资料',\n    component: NewComponent,\n  },\n  {\n    path: ':id',\n    title: '编辑用户',\n    component: NewComponent,\n  },\n];\n\n\n\n@NgModule({\n  declarations: [\n    MemberComponent,\n    NewComponent,\n  ],\n  imports: [\n    CommonModule,\n    ThemeModule,\n    RouterModule.forChild(routes),\n    Angular2SmartTableModule,\n    ControlModule,\n    UploadModule,\n  ],\n})\nexport class UserModule { }\n"],"x_google_ignoreList":[]}