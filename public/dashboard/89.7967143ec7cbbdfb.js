"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[89],{9089:(w,h,r)=>{r.r(h),r.d(h,{TaxonomyModule:()=>J});var m=r(3223),f=r(5805),d=r(512),p=r(450),t=r(3714),g=r(575),v=r(3250),b=r(8934),s=r(24),u=r(9223),y=r(612);function x(n,l){if(1&n&&(t.TgZ(0,"nb-option",11),t._uU(1),t.qZA()),2&n){const a=l.$implicit;t.Q6J("value",a.value),t.xp6(1),t.Oqu(a.label)}}function C(n,l){if(1&n&&(t.TgZ(0,"strong",9),t._uU(1),t.qZA()),2&n){const a=t.oxw();t.xp6(1),t.Oqu(a.taxonomy.name)}}function T(n,l){if(1&n&&(t.TgZ(0,"nb-option",10),t._uU(1),t.qZA()),2&n){const a=l.$implicit;t.Q6J("value",a.value),t.xp6(1),t.Oqu(a.label)}}let Z=(()=>{var n;class l{constructor(e,o,i,c,_){this.http=e,this.route=o,this.router=i,this.config=c,this.dialog=_,this.taxonomy="",this.settings={columns:{}},this.spinner=!1,this.batches=[{label:"\u6279\u91cf\u64cd\u4f5c",value:""},{label:"\u5220\u9664",value:"delete"}],this.batchMode=""}onSpinner(e){this.spinner=e}ngOnInit(){let e=this.config.taxonomies();this.route.paramMap.subscribe(o=>{let i=o.get("taxonomy")??"";if(!i||!Object.keys(e).includes(i))return void this.router.navigateByUrl("/404").then();if(!e[i].visibility.showUi)return;this.taxonomy=i;const c=e[i]||{};c.visibility.showUi&&(this.taxonomySetting=c,this.buildSetting())})}delete(e){this.deleteTaxonomy([e.id],"\u786e\u8ba4\u5220\u9664\u7c7b\u76ee: "+e.name+"?")}buildSetting(){this.settings=this.buildSettings(),this.source=new d.zV(this.http,{endPoint:g.WP.replace("{taxonomy}",this.taxonomy),dataKey:"records",totalKey:"total",pagerPageKey:"page",pagerLimitKey:"limit",filterFieldKey:"#field#"})}buildSettings(){return{selectMode:"multi",actions:{position:"right",add:!1,edit:!1,delete:!1,columnTitle:"\u64cd\u4f5c"},pager:{perPage:30},mode:"external",rowClassFunction:()=>"text-break",columns:{name:{title:"\u540d\u79f0",type:"custom",isFilterable:!0,renderComponent:D,componentInitFunction:(e,o)=>{e.value=o.getValue(),e.rowData=o.getRow().getData(),e.onClick().subscribe(i=>{switch(i.action){case"delete":this.delete(i.taxonomy);break;case"convert":this.convertDialog(i.taxonomy)}})},isSortable:!1},slug:{title:"\u522b\u540d",type:"text",isFilterable:!0,isSortable:!1},description:{title:"\u5185\u5bb9\u63cf\u8ff0",type:"text",isFilterable:!1,isSortable:!1},count:{title:"\u603b\u6570",type:"text",isFilterable:!1}}}}batch(){const e=this.source?.getSelectedItems().map(o=>o.id);void 0===e||e.length<1||"delete"!==this.batchMode||this.deleteTaxonomy(e,"\u786e\u8ba4\u5220\u9664\u5df2\u9009\u62e9\u7684\u7c7b\u76ee?")}deleteTaxonomy(e,o){window.confirm(o)&&this.http.post(g.db.replace("{taxonomy}",this.taxonomy),{sets:e}).subscribe(()=>{this.source?.refresh()})}convertDialog(e){this.dialog.open(F,{context:{taxonomy:e}}).onClose.subscribe(o=>{void 0!==o&&o&&this.convert(e.id,o)})}convert(e,o){this.http.post(g.rI,{id:e,toTaxonomy:o}).subscribe(()=>{this.source?.refresh()})}}return(n=l).\u0275fac=function(e){return new(e||n)(t.Y36(v.eN),t.Y36(p.gz),t.Y36(p.F0),t.Y36(b.eB),t.Y36(s.Gln))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-taxonomy"]],decls:13,vars:6,consts:[[1,"row"],[1,"col-12","col-md-4"],[3,"setting"],[1,"col-12","col-md-8"],[1,"border-0"],[1,"row","mb-2",3,"ngSubmit"],["name","batchMode",1,"col-auto",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto"],["nbButton","","status","primary","type","submit",3,"disabled"],[3,"settings","source"],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"app-taxonomy-create",2),t.qZA(),t.TgZ(3,"div",3)(4,"nb-card")(5,"nb-card-body",4)(6,"form",5),t.NdJ("ngSubmit",function(){return o.batch()}),t.TgZ(7,"nb-select",6),t.NdJ("ngModelChange",function(c){return o.batchMode=c}),t.YNc(8,x,2,2,"nb-option",7),t.qZA(),t.TgZ(9,"div",8)(10,"button",9),t._uU(11,"\u5e94\u7528"),t.qZA()()(),t._UZ(12,"angular2-smart-table",10),t.qZA()()()()),2&e&&(t.xp6(2),t.Q6J("setting",o.taxonomySetting),t.xp6(5),t.Q6J("ngModel",o.batchMode),t.xp6(1),t.Q6J("ngForOf",o.batches),t.xp6(2),t.Q6J("disabled",!o.batchMode),t.xp6(2),t.Q6J("settings",o.settings)("source",o.source))},dependencies:[m.sg,d.i0,u._Y,u.JJ,u.JL,u.On,u.F,s.Asz,s.yKW,s.DPz,s.rs,s.q51,y.s],encapsulation:2}),l})(),D=(()=>{var n;class l{constructor(){this.actionClick=new t.vpe}ngOnInit(){null!=this.rowData.level&&this.rowData.level>0&&(this.value="--".repeat(this.rowData.level)+this.value)}onClick(){return this.actionClick}delete(){this.actionClick.next({action:"delete",taxonomy:this.rowData})}convert(){this.actionClick.next({action:"convert",taxonomy:this.rowData})}}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-taxonomy-actions"]],inputs:{value:"value",rowData:"rowData"},decls:6,vars:3,consts:[[1,"py-3","text-break","fs-6"],["title","\u7f16\u8f91","icon","edit-2-outline",1,"ps-0",3,"link"],["title","\u5220\u9664","icon","trash-outline",3,"click"],["title","\u8fc1\u79fb","icon","swap-outline",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._uU(1),t.qZA(),t.TgZ(2,"nb-actions"),t._UZ(3,"nb-action",1),t.TgZ(4,"nb-action",2),t.NdJ("click",function(){return o.delete()}),t.qZA(),t.TgZ(5,"nb-action",3),t.NdJ("click",function(){return o.convert()}),t.qZA()()),2&e&&(t.xp6(1),t.hij(" ",o.value," "),t.xp6(2),t.hYB("link","/app/taxonomy/",o.rowData.taxonomy,"/",o.rowData.id,""))},dependencies:[s.Bk3,s.lYD],styles:["[_nghost-%COMP%]   nb-actions[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]:hover   nb-actions[_ngcontent-%COMP%]{visibility:visible}"]}),l})(),F=(()=>{var n;class l{constructor(e,o){this.dialogRef=e,this.config=o,this.options=[],this.selectedTaxonomy=""}ngOnInit(){const e=this.config.taxonomies();let o=[{label:"--\u9009\u62e9--",value:""}];for(let i in e){let c=e[i];c.visibility.showUi&&c.slug!=this.taxonomy?.taxonomy&&o.push({label:c.label,value:c.slug})}this.options=o}convert(){this.dialogRef.close(this.selectedTaxonomy)}}return(n=l).\u0275fac=function(e){return new(e||n)(t.Y36(s.X4l),t.Y36(b.eB))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-taxonomy-convert-dialog"]],decls:16,vars:4,consts:[["class","fw-bolder text-danger",4,"ngIf"],[1,"mb-3","d-flex","align-items-center"],[1,"label","col-form-label"],[1,"px-2"],["fullWidth","","id","taxonomies",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"disabled","click"],[1,"fw-bolder","text-danger"],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"nb-card")(1,"nb-card-header"),t.YNc(2,C,2,1,"strong",0),t._uU(3,"--\u6b63\u5728\u8f6c\u6362\u7c7b\u522b "),t.qZA(),t.TgZ(4,"nb-card-body")(5,"div",1)(6,"label",2),t._uU(7,"\u9009\u62e9\u9700\u8981\u8f6c\u6362\u7684\u7c7b\u522b: "),t.qZA(),t.TgZ(8,"div",3)(9,"nb-select",4),t.NdJ("ngModelChange",function(c){return o.selectedTaxonomy=c}),t.YNc(10,T,2,2,"nb-option",5),t.qZA()()()(),t.TgZ(11,"nb-card-footer",6)(12,"button",7),t.NdJ("click",function(){return o.dialogRef.close()}),t._uU(13,"\u53d6\u6d88"),t.qZA(),t.TgZ(14,"button",8),t.NdJ("click",function(){return o.convert()}),t._uU(15,"\u8f6c\u6362"),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("ngIf",o.taxonomy),t.xp6(7),t.Q6J("ngModel",o.selectedTaxonomy),t.xp6(1),t.Q6J("ngForOf",o.options),t.xp6(4),t.Q6J("disabled",o.selectedTaxonomy.length<1))},dependencies:[m.sg,m.O5,u.JJ,u.On,s.Asz,s.yKW,s.XWE,s.ndF,s.DPz,s.rs,s.q51],encapsulation:2}),l})();var M=r(8849);let A=[{path:":taxonomy",component:Z},{path:":taxonomy/:id",component:y.o}],J=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.ez,p.Bz.forChild(A),d.Ke,f.O,M.a]}),l})()}}]);