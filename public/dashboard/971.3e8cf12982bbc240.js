"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[971],{5403:(P,I,p)=>{p.d(I,{C:()=>y});var a=p(2939),b=p(8748),k=p(6796),f=p(4966);let y=(()=>{var T;class N{constructor(w){this.http=w}upload(w){const C={};return w.forEach(O=>{const E=new FormData;E.append("file",O,O.name);const q=new a.aW("POST",k.UE,E,{responseType:"json",reportProgress:!0}),_=new b.x,Z=new b.x;(new Date).getTime(),this.http.request(q).subscribe({next(u){if(u.type===a.dt.UploadProgress){const m=Math.round(100*u.loaded/u.total);_.next(m)}else u instanceof a.Zn&&(Z.next(u.body),_.complete())},error(u){Z.next(u),_.complete()}}),C[O.name]={response:Z,progress:_.asObservable()}}),C}}return(T=N).\u0275fac=function(w){return new(w||T)(f.LFG(a.eN))},T.\u0275prov=f.Yz7({token:T,factory:T.\u0275fac}),N})()},5971:(P,I,p)=>{p.r(I),p.d(I,{DecorationModule:()=>_e});var a=p(6733),b=p(2939),k=p(1925),f=p(1209),y=p(8004),T=p(155),N=p(5333),W=p(4787),w=p(2425),C=p(3226),O=p(99);const H="/theme/upload";var D=p(3361),t=p(4966),J=p(9089),rt=p(9913),d=p(2526),G=p(7635);function at(s,c){if(1&s&&(t.TgZ(0,"nb-option",44),t._uU(1),t.qZA()),2&s){const o=c.$implicit;t.Q6J("value",o.id),t.xp6(),t.Oqu(o.name)}}function ct(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",40)(1,"nb-select",41),t.NdJ("ngModelChange",function(n){t.CHM(o);const i=t.oxw();return t.KtG(i.nav.id=n)}),t.YNc(2,at,2,2,"nb-option",42),t.qZA(),t.TgZ(3,"button",43),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.editor())}),t._uU(4,"\u7f16\u8f91"),t.qZA()()}if(2&s){const o=t.oxw();t.xp6(),t.Q6J("ngModel",o.nav.id),t.xp6(),t.Q6J("ngForOf",o.navigate),t.xp6(),t.Q6J("disabled",o.nav.id<1)}}function dt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-checkbox",53),t.NdJ("checkedChange",function(n){const r=t.CHM(o).$implicit;return t.KtG(r.checked=n)}),t._uU(1),t.qZA()}if(2&s){const o=c.$implicit,e=t.oxw().$implicit;t.Q6J("checked",o.checked),t.xp6(),t.hij(" ","post"==e.type?o.title:o.name," ")}}function lt(s,c){if(1&s&&(t.TgZ(0,"nb-option",44),t._uU(1),t.qZA()),2&s){const o=c.$implicit;t.Q6J("value",o),t.xp6(),t.hij(" ",o.title||o.name," ")}}function ut(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-accordion-item")(1,"nb-accordion-item-header"),t._uU(2),t.qZA(),t.TgZ(3,"nb-accordion-item-body")(4,"form")(5,"div",45)(6,"nb-tabset")(7,"nb-tab",46)(8,"div",47),t.YNc(9,dt,2,2,"nb-checkbox",34),t.qZA()(),t.TgZ(10,"nb-tab",48)(11,"div")(12,"label"),t._UZ(13,"input",49),t.qZA(),t.TgZ(14,"nb-autocomplete",50,51),t.NdJ("selectedChange",function(n){const r=t.CHM(o).$implicit,l=t.oxw();return t.KtG(l.selectSearchItem(r.typeName,n))}),t.YNc(16,lt,2,2,"nb-option",42),t.ALo(17,"async"),t.qZA()()()()(),t.TgZ(18,"div",52)(19,"button",17),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.addToNav(i.typeName))}),t._uU(20,"\u6dfb\u52a0\u5230\u5bfc\u822a"),t.qZA()()()()()}if(2&s){const o=c.$implicit,e=t.MAs(15),n=t.oxw();t.xp6(2),t.hij(" ",o.label," "),t.xp6(7),t.Q6J("ngForOf",o.defaultOptions),t.xp6(),t.Q6J("formGroup",n.searchGroups),t.xp6(3),t.Q6J("formControlName",o.typeName)("nbAutocomplete",e),t.xp6(),t.Q6J("handleDisplayFn",n.displaySearch),t.xp6(2),t.Q6J("ngForOf",t.lcZ(17,8,n.searchGroupResult[o.typeName])),t.xp6(3),t.Q6J("disabled",n.disabled(o.typeName))}}function pt(s,c){1&s&&(t.TgZ(0,"p",55),t._uU(1," \u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a! "),t.qZA())}function gt(s,c){if(1&s&&(t.ynx(0),t.YNc(1,pt,2,0,"p",54),t.BQk()),2&s){t.oxw();const o=t.MAs(48);t.xp6(),t.Q6J("ngIf",null==o.errors?null:o.errors.required)}}function mt(s,c){1&s&&t.GkF(0)}const Y=s=>({node:s});function _t(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",56),t.NdJ("cdkDragMoved",function(n){t.CHM(o);const i=t.oxw();return t.KtG(i.dragMoved(n))}),t.YNc(1,mt,1,0,"ng-container",57),t.qZA()}if(2&s){const o=c.$implicit;t.oxw();const e=t.MAs(70);t.Q6J("cdkDragData",o.nodeId),t.xp6(),t.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",t.VKq(3,Y,o))}}function ht(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-checkbox",53),t.NdJ("checkedChange",function(n){const r=t.CHM(o).$implicit,l=t.oxw();return t.KtG(l.nav.themeNavigationLocation[r.alias]=n)}),t._uU(1),t.qZA()}if(2&s){const o=c.$implicit,e=t.oxw();t.Q6J("checked",e.nav.themeNavigationLocation[o.alias]),t.xp6(),t.Oqu(o.name)}}function ft(s,c){if(1&s&&(t.TgZ(0,"nb-option",44),t._uU(1),t.qZA()),2&s){const o=c.$implicit;t.Q6J("value",o.id),t.xp6(),t.Oqu(o.name)}}function bt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",58)(1,"label",64),t._uU(2),t.qZA(),t.TgZ(3,"div",65)(4,"nb-select",66),t.NdJ("ngModelChange",function(n){const r=t.CHM(o).$implicit,l=t.oxw(2);return t.KtG(l.themeNavigationLocation[r.alias]=n)}),t.YNc(5,ft,2,2,"nb-option",42),t.qZA()()()}if(2&s){const o=c.$implicit,e=c.index,n=t.oxw(2);t.xp6(),t.MGl("for","nav_location_",e,""),t.xp6(),t.Oqu(o.name),t.xp6(2),t.MGl("name","nav_location_",e,""),t.Q6J("ngModel",n.themeNavigationLocation[o.alias]),t.xp6(),t.Q6J("ngForOf",n.navigate)}}function xt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"form",20),t.NdJ("ngSubmit",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.saveLocation())}),t.TgZ(1,"nb-card")(2,"nb-card-header"),t._uU(3,"\u83dc\u5355\u4f4d\u7f6e"),t.qZA(),t.TgZ(4,"nb-card-body")(5,"div",58)(6,"label",59),t._uU(7,"\u4e3b\u9898\u83dc\u5355\u4f4d\u7f6e"),t.qZA(),t.TgZ(8,"label",60),t._uU(9,"\u5df2\u6307\u6d3e\u7684\u83dc\u5355"),t.qZA()(),t.YNc(10,bt,6,5,"div",61),t.qZA(),t.TgZ(11,"nb-card-footer",62)(12,"button",63),t._uU(13,"\u4fdd\u5b58\u8bbe\u7f6e"),t.qZA()()()()}if(2&s){const o=t.oxw();t.xp6(10),t.Q6J("ngForOf",o.themeNavigation),t.xp6(2),t.Q6J("disabled",o.submitted)}}function vt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",72)(1,"label",73),t._uU(2,"URL"),t.qZA(),t.TgZ(3,"input",74),t.NdJ("ngModelChange",function(n){t.CHM(o);const i=t.oxw().node;return t.KtG(i.url=n)}),t.qZA()()}if(2&s){const o=t.oxw().node;t.xp6(),t.MGl("for","custom_link_id_",o.nodeId,""),t.xp6(2),t.MGl("id","custom_link_id_",o.nodeId,""),t.Q6J("name",o.nodeId+"_url")("ngModel",o.url)}}function Ct(s,c){1&s&&t.GkF(0)}function Tt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",56),t.NdJ("cdkDragMoved",function(n){t.CHM(o);const i=t.oxw(3);return t.KtG(i.dragMoved(n))}),t.YNc(1,Ct,1,0,"ng-container",57),t.qZA()}if(2&s){const o=c.$implicit;t.oxw(3);const e=t.MAs(70);t.Q6J("cdkDragData",o.nodeId),t.xp6(),t.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",t.VKq(3,Y,o))}}function Zt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",78),t.NdJ("cdkDropListDropped",function(n){t.CHM(o);const i=t.oxw(2);return t.KtG(i.drop(n))}),t.YNc(1,Tt,2,5,"div",30),t.qZA()}if(2&s){const o=t.oxw().node,e=t.oxw();t.Q6J("cdkDropListData",o.children)("id",o.nodeId)("cdkDropListConnectedTo",e.dropTargetIds)("cdkDropListSortingDisabled",!0),t.xp6(),t.Q6J("ngForOf",o.children)}}function kt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",67)(1,"nb-accordion")(2,"nb-accordion-item")(3,"nb-accordion-item-header",68)(4,"div"),t._uU(5),t.qZA(),t.TgZ(6,"div",69),t._uU(7),t.qZA()(),t.TgZ(8,"nb-accordion-item-body")(9,"form",70),t.YNc(10,vt,4,4,"div",71),t.TgZ(11,"div",72)(12,"label",73),t._uU(13,"\u5bfc\u822a\u540d\u79f0"),t.qZA(),t.TgZ(14,"input",74),t.NdJ("ngModelChange",function(n){const r=t.CHM(o).node;return t.KtG(r.title=n)}),t.qZA()(),t.TgZ(15,"div")(16,"button",75),t.NdJ("click",function(){const i=t.CHM(o).node,r=t.oxw();return t.KtG(r.remove(i.nodeId))}),t._uU(17,"\u79fb\u9664"),t.qZA(),t._uU(18," \xa0|\xa0 "),t.TgZ(19,"button",76),t._uU(20,"\u53d6\u6d88"),t.qZA()()()()()(),t.YNc(21,Zt,2,5,"div",77),t.qZA()}if(2&s){const o=c.node,e=t.oxw();t.uIk("data-id",o.nodeId)("id","node-"+o.nodeId),t.xp6(5),t.Oqu(o.title),t.xp6(2),t.Oqu(e.typeMapName[o.type]),t.xp6(3),t.Q6J("ngIf","custom"==o.type),t.xp6(2),t.MGl("for","custom_link_name_",o.nodeId,""),t.xp6(2),t.MGl("id","custom_link_name_",o.nodeId,""),t.Q6J("name",o.nodeId)("ngModel",o.title),t.xp6(7),t.Q6J("ngIf",o.children.length>0)}}let wt=(()=>{var s;class c{constructor(e,n,i,r,l){this.route=e,this.http=n,this.document=i,this.config=r,this.sidebar=l,this.searchResult={},this.navigate=[],this.themeNavigation=[],this.themeNavigationLocation={},this.dropTargetIds=[],this.nodeLookup={},this.submitted=!1,this.custom={link:"",title:""},this.typeMapName={page:"\u9875\u9762",post:"\u6587\u7ae0",custom:"\u81ea\u5b9a\u4e49\u94fe\u63a5",category:"\u5206\u7c7b"},this.defaultNode={nodeId:"demo",title:"\u793a\u4f8b1",type:"custom",children:[]},this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.searchGroups=new C.cw({}),this.searchGroupResult={},this.accordionItems=[]}ngAfterViewInit(){(0,k.H)(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(n=>{"expanded"==n&&this.sidebar.compact("menu-sidebar")})})}onSpinner(e){this.submitted=e}ngOnInit(){let e=this.config.taxonomies(),n=this.config.postTypes(),i=[];for(let r in n)n[r].visibility.showNavigation&&(i.push({label:n[r].label,type:"post",name:r,typeName:"post_"+r,defaultOptions:[]}),this.searchGroups.addControl("post_"+r,new C.NI("")));for(let r in e)e[r].visibility.showNavigation&&(i.push({label:e[r].label,type:"taxonomy",name:r,typeName:"taxonomy_"+r,defaultOptions:[]}),this.searchGroups.addControl("taxonomy_"+r,new C.NI("")));for(let r of i)this.searchGroupResult[r.typeName]=this.searchGroups.controls[r.typeName].valueChanges.pipe((0,y.x)(),(0,T.b)(500),(0,N.h)(g=>!!g),(0,W.w)(g=>this.getObjects(g,r.name,r.type)));this.accordionItems=i,this.http.get("/navigate/structure").subscribe(r=>{for(let l in r.dataSet)this.accordionItems.forEach(g=>{g.typeName===l&&(g.defaultOptions=r.dataSet[l])});this.themeNavigation=r.themeNavigation,this.themeNavigationLocation=r.themeNavigationLocation,this.navigate=r.navigate}),this.prepareDragDrop(this.nav.nodes)}editor(){this.http.get("/navigate/{id}",{params:{id:this.nav.id}}).subscribe(e=>{this.nav=e.navigation,this.nav.nodes.length<1&&this.nav.nodes.push(this.defaultNode),this.nav.themeNavigationLocation={},this.themeNavigation.forEach(n=>{this.nav.themeNavigationLocation[n.alias]=this.themeNavigationLocation[n.alias]==this.nav.id}),this.prepareDragDrop(this.nav.nodes)})}prepareDragDrop(e){e.forEach(n=>{this.dropTargetIds.includes(n.nodeId)||this.dropTargetIds.push(n.nodeId),this.nodeLookup[n.nodeId]=n,this.prepareDragDrop(n.children)})}dragMoved(e){(0,f.of)(e).pipe((0,T.b)(50)).subscribe(n=>{let i=this.document.elementFromPoint(n.pointerPosition.x,n.pointerPosition.y);if(!i)return void this.clearDragInfo();let r=i.classList.contains("node-item")?i:i.closest(".node-item");if(!r)return void this.clearDragInfo();this.dropActionTodo={targetId:r.getAttribute("data-id")??""};const l=r.getBoundingClientRect(),g=l.height/3;this.dropActionTodo.action=n.pointerPosition.y-l.top<g?"before":n.pointerPosition.y-l.top>2*g?"after":"inside",this.showDragInfo()})}drop(e){if(!this.dropActionTodo)return;const n=e.item.data,i=e.previousContainer.id,r=this.getParentNodeId(this.dropActionTodo.targetId,this.nav.nodes,"main");console.log("\nmoving\n["+n+"] from list ["+i+"]","\n["+this.dropActionTodo.action+"]\n["+this.dropActionTodo.targetId+"] from list ["+r+"]");const l=this.nodeLookup[n],g="main"!=i?this.nodeLookup[i].children:this.nav.nodes,h="main"!=r?this.nodeLookup[r].children:this.nav.nodes;let F=g.findIndex(M=>M.nodeId===n);switch(g.splice(F,1),this.dropActionTodo.action){case"before":case"after":const M=h.findIndex(A=>A.nodeId===this.dropActionTodo?.targetId);h.splice("before"==this.dropActionTodo.action?M:M+1,0,l);break;case"inside":this.nodeLookup[this.dropActionTodo.targetId].children.push(l),this.nodeLookup[this.dropActionTodo.targetId].isExpanded=!0}this.clearDragInfo(!0)}getParentNodeId(e,n,i){for(let r of n){if(r.nodeId==e)return i;let l=this.getParentNodeId(e,r.children,r.nodeId);if(l)return l}return""}showDragInfo(){this.clearDragInfo(),this.dropActionTodo&&document.getElementById("node-"+this.dropActionTodo.targetId)?.classList.add("drop-"+this.dropActionTodo.action)}clearDragInfo(e=!1){e&&(this.dropActionTodo=void 0),this.document.querySelectorAll(".drop-before").forEach(n=>n.classList.remove("drop-before")),this.document.querySelectorAll(".drop-after").forEach(n=>n.classList.remove("drop-after")),this.document.querySelectorAll(".drop-inside").forEach(n=>n.classList.remove("drop-inside"))}delete(){window.confirm("\u786e\u8ba4\u5220\u9664\u83dc\u5355 ["+this.nav.name+"]\u5417\uff1f")&&this.http.post("/navigate/{id}/delete",this.nav).subscribe(e=>{this.create()})}save(){this.http.post("/navigate/save",this.nav,{context:(new b.qT).set(D.a,this)}).subscribe(e=>{})}saveLocation(){this.http.post("/navigate/save/location",{location:this.themeNavigationLocation},{context:(new b.qT).set(D.a,this)}).subscribe(e=>{})}addToNav(e){if("custom"===e){let n="custom-"+this.custom.title,i={nodeId:n,title:this.custom.title,type:e,url:this.custom.link,children:[]};this.custom.title="",this.custom.link="",this.nav.nodes.push(i),this.dropTargetIds.push(n),this.nodeLookup[n]=i}else this.accordionItems.forEach(n=>{n.typeName==e&&n.defaultOptions.forEach(i=>{i.checked&&(this.selectedItem(i),i.checked=!1)})}),this.searchResult[e]&&(this.selectedItem(this.searchResult[e]),this.searchResult[e]=void 0,this.searchGroups.controls[e].setValue(""))}selectedItem(e){let n=e.type||e.taxonomy,i="node-"+n+"-"+e.id;if(null==this.nodeLookup[i]){let r={nodeId:i,title:e.title||e.name,type:n,objectId:e.id,children:[]};this.nav.nodes.push(r),this.dropTargetIds.push(i),this.nodeLookup[i]=r}}remove(e){this.removeNode(e,this.nav.nodes),delete this.dropTargetIds[this.dropTargetIds.indexOf(e)],delete this.nodeLookup[e]}removeNode(e,n){n.forEach((i,r)=>{i.nodeId==e?n.splice(r,1):i.children.length>0&&this.removeNode(e,i.children)})}create(){this.nav={id:0,name:"",nodes:[this.defaultNode],themeNavigationLocation:{}},this.dropTargetIds=[],this.nodeLookup={},this.prepareDragDrop(this.nav.nodes)}getObjects(e,n,i){switch(i){case"taxonomy":return this.http.get(O.WP,{params:{taxonomy:n,name:e,page:1,size:50}}).pipe((0,w.U)(r=>r.records));case"post":return this.http.get(O.vA,{params:{type:n,title:e,page:1,size:50}}).pipe((0,w.U)(r=>r.records));default:return(0,f.of)([])}}navigationLocation(e){console.log(e)}displaySearch(e){return"string"==typeof e?e:e.title||e.name}selectSearchItem(e,n){this.searchResult[e]=n}disabled(e){let n=!0;return this.accordionItems.forEach(i=>{i.defaultOptions.forEach(r=>{r.checked&&(n=!1)})}),this.searchResult[e]&&(n=!1),n}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(J.gz),t.Y36(b.eN),t.Y36(a.K0),t.Y36(rt.eB),t.Y36(d.lzT))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-navigation"]],decls:71,vars:17,consts:[[1,"row"],[1,"col-12"],[1,"d-flex","flex-md-row","justify-content-between"],["class","d-flex",4,"ngIf"],[1,""],["nbButton","","status","primary"],["icon","plus-outline"],[1,"col-12","col-xl-5"],["multi","true",1,"interface-complementary-area"],["customForm","ngForm"],[1,"mb-3","row"],["for","custom_link",1,"label","col-sm-3","col-form-label"],[1,"col-sm-9"],["id","custom_link","required","","name","link","placeholder","https://","fullWidth","","status","primary","nbInput","",3,"ngModel","ngModelChange"],["for","custom_link_name",1,"label","col-sm-3","col-form-label"],["id","custom_link_name","required","","name","link_name","fullWidth","","status","primary","nbInput","",3,"ngModel","ngModelChange"],[1,"mb-3","text-right"],["nbButton","","status","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"col-12","col-xl-7"],[3,"ngSubmit"],["navForm","ngForm"],[1,"form-group","row"],["for","nav_name",1,"label","col-sm-2","col-form-label"],[1,"col-sm-10"],["id","nav_name","required","required","name","navName","status","primary","nbInput","",3,"status","ngModel","ngModelChange"],["navName","ngModel"],[4,"ngIf"],[1,"pt-4","label"],["cdkDropList","",1,"node_container",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped"],["cdkDrag","",3,"cdkDragData","cdkDragMoved",4,"ngFor","ngForOf"],[1,"py-2",2,"font-size","15px","font-weight","bold"],["for","nav_location",1,"label","col-sm-2","col-form-label"],["id","nav_location",1,"col-sm-10","d-flex","flex-column"],[3,"checked","checkedChange",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","type","button","status","danger",3,"disabled","click"],["type","submit","nbButton","","status","primary",3,"disabled"],[3,"ngSubmit",4,"ngIf"],["tmplNode",""],[1,"d-flex"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["nbButton","","status","control",1,"mx-2",3,"disabled","click"],[3,"value"],[1,"form-group"],["tabTitle","\u6700\u8fd1",1,"px-0"],[1,"d-flex","flex-column"],["tabTitle","\u641c\u7d22",1,"px-0",3,"formGroup"],["nbInput","","status","primary","fullWidth","",3,"formControlName","nbAutocomplete"],[3,"handleDisplayFn","selectedChange"],["searchAuto",""],[1,"form-group","text-right"],[3,"checked","checkedChange"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],["cdkDrag","",3,"cdkDragData","cdkDragMoved"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"row","mb-3"],[1,"label","col-2","col-form-label"],[1,"label","col-10","col-form-label"],["class","row mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary","type","submit",3,"disabled"],[1,"label","col-2","col-form-label",3,"for"],[1,"col-10"],[3,"name","ngModel","ngModelChange"],[1,"node-item"],[1,"justify-content-between"],[1,"mr-4"],["ngForm",""],["class","mb-2",4,"ngIf"],[1,"mb-2"],[1,"label","col-form-label",3,"for"],["nbInput","","fullWidth","","status","primary",3,"id","name","ngModel","ngModelChange"],["nbButton","","size","tiny","status","danger",3,"click"],["nbButton","","size","tiny","status","primary"],["class","node-children","cdkDropList","",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped",4,"ngIf"],["cdkDropList","",1,"node-children",3,"cdkDropListData","id","cdkDropListConnectedTo","cdkDropListSortingDisabled","cdkDropListDropped"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-body")(4,"div",2),t.YNc(5,ct,5,3,"div",3),t.TgZ(6,"div",4)(7,"button",5),t._UZ(8,"nb-icon",6),t._uU(9," \u521b\u5efa\u65b0\u5bfc\u822a "),t.qZA()()()()()(),t.TgZ(10,"div",7)(11,"nb-card")(12,"nb-card-header"),t._uU(13," \u6dfb\u52a0\u5bfc\u822a\u9879 "),t.qZA(),t.TgZ(14,"nb-card-body")(15,"nb-accordion",8)(16,"nb-accordion-item")(17,"nb-accordion-item-header"),t._uU(18," \u81ea\u5b9a\u4e49\u94fe\u63a5 "),t.qZA(),t.TgZ(19,"nb-accordion-item-body")(20,"form",null,9)(22,"div",10)(23,"label",11),t._uU(24,"\u94fe\u63a5"),t.qZA(),t.TgZ(25,"div",12)(26,"input",13),t.NdJ("ngModelChange",function(r){return n.custom.link=r}),t.qZA()()(),t.TgZ(27,"div",10)(28,"label",14),t._uU(29,"\u94fe\u63a5\u540d\u79f0"),t.qZA(),t.TgZ(30,"div",12)(31,"input",15),t.NdJ("ngModelChange",function(r){return n.custom.title=r}),t.qZA()()(),t.TgZ(32,"div",16)(33,"button",17),t.NdJ("click",function(){return n.addToNav("custom")}),t._uU(34,"\u6dfb\u52a0\u5230\u5bfc\u822a"),t.qZA()()()()(),t.YNc(35,ut,21,10,"nb-accordion-item",18),t.qZA()()()(),t.TgZ(36,"div",19)(37,"form",20,21),t.NdJ("ngSubmit",function(){return n.save()}),t.TgZ(39,"nb-card")(40,"nb-card-header"),t._uU(41," \u5bfc\u822a\u7ed3\u6784 "),t.qZA(),t.TgZ(42,"nb-card-body")(43,"div",22)(44,"label",23),t._uU(45,"\u83dc\u5355\u540d\u79f0"),t.qZA(),t.TgZ(46,"div",24)(47,"input",25,26),t.NdJ("ngModelChange",function(r){return n.nav.name=r}),t.qZA(),t.YNc(49,gt,2,1,"ng-container",27),t.qZA()(),t.TgZ(50,"p",28),t._uU(51,"\u62d6\u653e\u5404\u4e2a\u9879\u76ee\u5230\u60a8\u559c\u6b22\u7684\u987a\u5e8f\uff0c\u70b9\u51fb\u53f3\u4fa7\u7684\u7bad\u5934\u53ef\u8fdb\u884c\u66f4\u8be6\u7ec6\u7684\u8bbe\u7f6e\u3002"),t.qZA(),t.TgZ(52,"div",29),t.NdJ("cdkDropListDropped",function(r){return n.drop(r)}),t.YNc(53,_t,2,5,"div",30),t.qZA()(),t.TgZ(54,"nb-card-footer")(55,"div",31),t._uU(56,"\u83dc\u5355\u8bbe\u7f6e"),t.qZA(),t.TgZ(57,"div",22)(58,"label",32),t._uU(59,"\u663e\u793a\u4f4d\u7f6e"),t.qZA(),t.TgZ(60,"div",33),t.YNc(61,ht,2,2,"nb-checkbox",34),t.qZA()()(),t.TgZ(62,"nb-card-footer")(63,"div",35)(64,"button",36),t.NdJ("click",function(){return n.delete()}),t._uU(65,"\u5220\u9664\u5bfc\u822a"),t.qZA(),t.TgZ(66,"button",37),t._uU(67,"\u4fdd\u5b58\u5bfc\u822a"),t.qZA()()()()(),t.YNc(68,xt,14,2,"form",38),t.qZA()(),t.YNc(69,kt,22,10,"ng-template",null,39,t.W1O)),2&e){const i=t.MAs(21),r=t.MAs(38),l=t.MAs(48);t.xp6(5),t.Q6J("ngIf",n.navigate.length>0),t.xp6(21),t.Q6J("ngModel",n.custom.link),t.xp6(5),t.Q6J("ngModel",n.custom.title),t.xp6(2),t.Q6J("disabled",!i.valid),t.xp6(2),t.Q6J("ngForOf",n.accordionItems),t.xp6(12),t.Q6J("status",l.dirty?l.invalid?"danger":"success":"primary")("ngModel",n.nav.name),t.xp6(2),t.Q6J("ngIf",l.invalid&&l.touched),t.xp6(3),t.Q6J("cdkDropListData",n.nav.nodes)("id","main")("cdkDropListConnectedTo",n.dropTargetIds)("cdkDropListSortingDisabled",!0),t.xp6(),t.Q6J("ngForOf",n.nav.nodes),t.xp6(8),t.Q6J("ngForOf",n.themeNavigation),t.xp6(3),t.Q6J("disabled",n.nav.id<1||n.nav.name.length<1),t.xp6(2),t.Q6J("disabled",!r.valid||n.submitted),t.xp6(2),t.Q6J("ngIf",n.themeNavigation.length>0)}},dependencies:[a.sg,a.O5,a.tP,C._Y,C.Fj,C.JJ,C.JL,C.Q7,C.On,C.F,C.sg,C.u,d.Asz,d.yKW,d.XWE,d.ndF,d.kyn,d.TR4,d.NTf,d.DPz,d.h8i,d.qCO,d.SaG,d.YZd,d.AvE,d.rs,d.q51,d.fMN,d.Xh,d.wNd,G.Wj,G.Zt,a.Ov],styles:["/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */.node_container{padding:var(--accordion-padding);border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}.node_container .cdk-drag-placeholder{display:none}.node_container .cdk-drag-preview{box-sizing:border-box;box-shadow:0 3px 3px -2px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#fff;opacity:.3}.node_container .drop-inside{border-width:var(--accordion-header-border-width)!important;border-style:var(--accordion-header-border-style)!important;border-color:var(--text-success-color)!important}.node_container .drop-before{border-top-width:var(--accordion-header-border-width)!important;border-top-style:var(--accordion-header-border-style)!important;border-top-color:var(--text-success-color)!important}.node_container .drop-after{border-bottom-width:var(--accordion-header-border-width)!important;border-bottom-style:var(--accordion-header-border-style)!important;border-bottom-color:var(--text-success-color)!important}.node_container .node-item{background-color:var(--accordion-item-background-color);cursor:move}.node_container .node-children{position:relative;transition:height .2s;margin-left:40px}.node_container .item-notes{margin-left:20px;color:#aaa}.node_container nb-icon{cursor:pointer!important}.node_container nb-accordion-item-header{cursor:move}.node_container nb-accordion{margin:5px;border-width:var(--accordion-header-border-width);border-style:var(--accordion-header-border-style);border-color:var(--accordion-header-border-color)}\n"],encapsulation:2}),c})();var At=p(8442),L=p(4014),K=p(7285),S=p(3232);const yt=["widgetSidebarBtn"],Nt=["quickInsertWidgetDialog"],R=["widgetItemComponent"];function Mt(s,c){if(1&s&&(t.TgZ(0,"label",46),t._uU(1),t.qZA()),2&s){const o=t.oxw(2).$implicit;t.xp6(),t.Oqu(o.label)}}function It(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",47),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw(3);return t.KtG(r.insertWidget(i.name))}),t._UZ(1,"nb-icon",48),t.TgZ(2,"span",49),t._uU(3),t.qZA()()}if(2&s){const o=c.$implicit,e=t.oxw(3);t.xp6(),t.Q6J("pack",e.pack(o))("icon",o.icon),t.xp6(2),t.Oqu(o.label)}}function Ot(s,c){if(1&s&&(t.TgZ(0,"div",42),t.YNc(1,Mt,2,1,"label",43),t.TgZ(2,"div",44),t.YNc(3,It,4,3,"div",45),t.qZA()()),2&s){const o=t.oxw().$implicit;t.xp6(),t.Q6J("ngIf",o.slug),t.xp6(2),t.Q6J("ngForOf",o.widgets)}}function Ft(s,c){if(1&s&&(t.ynx(0),t.YNc(1,Ot,4,2,"div",41),t.BQk()),2&s){const o=c.$implicit;t.xp6(),t.Q6J("ngIf",o.widgets&&o.widgets.length>0)}}function Wt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"widget-item",54,55),t.NdJ("focus",function(){t.CHM(o);const n=t.MAs(1),i=t.oxw(2);return t.KtG(i.selectorWidget(n))})("blur",function(n){t.CHM(o);const i=t.oxw(2);return t.KtG(i.unselectWidget(n))}),t.qZA()}if(2&s){const o=c.$implicit,e=c.index,n=t.oxw().index;t.ekj("selected",o.selected),t.Q6J("id",o.id)("product",o)("blockIndex",n)("index",e)}}function Dt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-accordion",50),t.NdJ("focus",function(){const i=t.CHM(o).index,r=t.oxw();return t.KtG(r.selectorBlock(i))}),t.TgZ(1,"nb-accordion-item")(2,"nb-accordion-item-header",51),t.NdJ("focus",function(){const i=t.CHM(o).index,r=t.oxw();return t.KtG(r.selectorBlock(i))}),t._uU(3),t.qZA(),t.TgZ(4,"nb-accordion-item-body"),t.YNc(5,Wt,2,6,"widget-item",52),t.TgZ(6,"button",53),t.NdJ("nbPopoverShowStateChange",function(n){const r=t.CHM(o).index,l=t.oxw();return t.KtG(l.quickToggle(n,r))}),t._UZ(7,"nb-icon",6),t.qZA()()()()}if(2&s){const o=c.$implicit,e=t.oxw(),n=t.MAs(50);t.xp6(3),t.hij(" ",o.label," "),t.xp6(2),t.Q6J("ngForOf",e.getBlockWidgets(o.name)),t.xp6(),t.Q6J("nbPopover",n)}}const z=s=>({products:s});function Et(s,c){if(1&s&&(t.TgZ(0,"nb-tab",56),t.GkF(1,57),t.qZA()),2&s){const o=t.oxw(),e=t.MAs(48);t.Q6J("tabTitle",o.blocks[o.selectBlockIndex].label||""),t.xp6(),t.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",t.VKq(3,z,o.getBlockWidgetsForIndex()))}}function Jt(s,c){if(1&s&&(t.TgZ(0,"nb-card-header",58),t._UZ(1,"nb-icon",48),t.TgZ(2,"div",59)(3,"span"),t._uU(4),t.qZA(),t.TgZ(5,"label",60),t._uU(6),t.qZA()()()),2&s){const o=t.oxw();t.xp6(),t.Q6J("pack",o.pack(o.lastedWidget.product.widget))("icon",o.lastedWidget.product.widget.icon),t.xp6(3),t.Oqu(o.lastedWidget.product.widget.label),t.xp6(2),t.Oqu(o.lastedWidget.product.widget.description)}}function qt(s,c){if(1&s&&(t.TgZ(0,"nb-accordion-item")(1,"nb-accordion-item-header"),t._uU(2),t.qZA(),t.TgZ(3,"nb-accordion-item-body"),t._UZ(4,"control-container",62),t.qZA()()),2&s){const o=c.$implicit,e=t.oxw(2);t.xp6(2),t.Oqu(o.label),t.xp6(2),t.Q6J("form",e.lastedWidget.product.form)("controls",o.controls)}}function Bt(s,c){if(1&s&&(t.TgZ(0,"nb-accordion",61),t.YNc(1,qt,5,3,"nb-accordion-item",21),t.qZA()),2&s){const o=t.oxw();t.xp6(),t.Q6J("ngForOf",o.lastedWidget.product.widget.sections)}}function Ut(s,c){if(1&s&&t.GkF(0,57),2&s){const o=t.oxw().$implicit;t.oxw(2);const e=t.MAs(48);t.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",t.VKq(2,z,o.children))}}const St=(s,c)=>({item:s,name:c});function Pt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-list-item",65)(1,"a",66),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw(2);return t.KtG(r.selected(i))}),t.TgZ(2,"div",67)(3,"span"),t._UZ(4,"nb-icon",48),t.qZA(),t.TgZ(5,"span",68),t._uU(6),t.qZA()(),t.TgZ(7,"button",69),t._UZ(8,"nb-icon",70),t.qZA()(),t.YNc(9,Ut,1,4,"ng-container",71),t.qZA()}if(2&s){const o=c.$implicit,e=t.oxw(2),n=t.MAs(52);t.ekj("selected",o.selected),t.xp6(),t.Q6J("fragment",o.id),t.xp6(3),t.Q6J("pack",e.pack(o.widget))("icon",o.widget.icon),t.xp6(2),t.Oqu(o.widget.label),t.xp6(),t.Q6J("nbPopover",n)("nbPopoverContext",t.WLB(9,St,o,e.blocks[e.selectBlockIndex].name)),t.xp6(2),t.Q6J("ngIf",o.children.length>0)}}function Qt(s,c){if(1&s&&(t.TgZ(0,"nb-list",63),t.YNc(1,Pt,10,12,"nb-list-item",64),t.qZA()),2&s){const o=c.products;t.xp6(),t.Q6J("ngForOf",o)}}function Gt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",47),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw(2);return t.KtG(r.insertWidget(i.name,!0))}),t._UZ(1,"nb-icon",48),t.TgZ(2,"span",49),t._uU(3),t.qZA()()}if(2&s){const o=c.$implicit,e=t.oxw(2);t.xp6(),t.Q6J("pack",e.pack(o))("icon",o.icon),t.xp6(2),t.Oqu(o.label)}}function Lt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-card",72)(1,"nb-card-header",73)(2,"nb-form-field")(3,"input",18),t.NdJ("keyup",function(n){t.CHM(o);const i=t.oxw();return t.KtG(i.search(n))}),t.qZA(),t._UZ(4,"nb-icon",19),t.qZA()(),t.TgZ(5,"nb-card-body",74)(6,"div",44),t.YNc(7,Gt,4,3,"div",45),t.qZA()(),t.TgZ(8,"nb-card-footer",73)(9,"button",75),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.widgetSidebarBtnRef.nativeElement.click())}),t._uU(10,"\u6d4f\u89c8\u5168\u90e8 "),t.qZA()()()}if(2&s){const o=t.oxw();t.xp6(7),t.Q6J("ngForOf",o.historyWidgets)}}function Ht(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-card",72)(1,"nb-card-body",74)(2,"nb-list",74)(3,"nb-list-item")(4,"a",76),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.onPrevious(i.item))}),t._uU(5,"\u5411\u4e0a\u79fb\u52a8"),t.qZA()(),t.TgZ(6,"nb-list-item")(7,"a",76),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.onNext(i.item))}),t._uU(8,"\u5411\u4e0b\u79fb\u52a8"),t.qZA()(),t.TgZ(9,"nb-list-item")(10,"a",76),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.onRemove(i.item))}),t._uU(11,"\u5220\u9664"),t.qZA()()()()()}}const Yt=["groupComponent"],Kt=["container"];function Rt(s,c){if(1&s&&t._UZ(0,"nb-icon",5),2&s){const o=t.oxw(2);t.Q6J("pack",o.pack())("icon",o.product.widget.icon)}}function zt(s,c){if(1&s&&(t.TgZ(0,"div",2)(1,"div",null,3),t.YNc(3,Rt,1,2,"nb-icon",4),t.qZA()()),2&s){const o=t.oxw();t.xp6(),t.Gre("widget-",o.product.widget.name,""),t.xp6(2),t.Q6J("ngIf",o.isMedia())}}function $t(s,c){if(1&s&&t._UZ(0,"widget-group",6,7),2&s){const o=t.oxw();t.Q6J("widgets",o.product.children)("parent",o)}}function jt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"widget-item",3,4),t.NdJ("focus",function(){t.CHM(o);const n=t.MAs(1),i=t.oxw();return t.KtG(i.parent.parent.selectorWidget(n))})("blur",function(n){t.CHM(o);const i=t.oxw();return t.KtG(i.parent.parent.unselectWidget(n))}),t.qZA()}if(2&s){const o=c.$implicit,e=c.index,n=t.oxw();t.ekj("selected",o.selected),t.Q6J("id",o.id)("product",o)("blockIndex",n.parent.blockIndex)("index",e)("pre",n.parent)}}function Vt(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("nbPopoverShowStateChange",function(n){t.CHM(o);const i=t.oxw();return t.KtG(i.parent.parent.quickToggle(n,i.parent.blockIndex))}),t._UZ(2,"nb-icon",7),t.qZA()()}if(2&s){const o=t.oxw();t.xp6(),t.Q6J("nbPopover",o.parent.parent.quickInsertWidgetDialog)}}const $=s=>s.icon.startsWith("fa-")?"fa":s.icon.startsWith("op-")?"op":"";let j=(()=>{var s;class c{constructor(e,n,i){this.http=e,this.sidebar=n,this.document=i,this.widgets=[],this.widgetCategories=[],this.leftSidebarCompact=!1,this.blocks=[],this.hasHiddenWidgetSidebar=!0,this.hasHiddenSettingSidebar=!0,this.filterWidgetCategories=(0,f.of)([]),this.blockWidgets={},this.historyWidgets=[],this.selectBlockIndex=-1,this.leftSidebarCollapse=!1}ngOnInit(){const e=this.http.get("/widget/registered"),n=this.http.get("/widget/blocks");(0,At.a)([e,n]).subscribe(([i,r])=>{this.widgets=i.widgets,i.categories.forEach(g=>{g.widgets=this.widgets.filter(h=>h.category==g.slug),g.widgets.forEach(h=>{h.icon||(h.icon=g.icon)})}),this.widgetCategories=i.categories,this.filterWidgetCategories=(0,f.of)(this.widgetCategories),this.historyWidgets=this.widgets.slice(0,6),this.blocks=r,r.length>0&&(this.selectBlockIndex=0);let l=g=>{const h=this.widgets.find(A=>{if(A.name==g.name)return A});if(!h)return;let F=h.sections.map(A=>A.controls),M={id:g.id,widget:Object.assign({},h),form:new C.cw((0,L.T)(F.flat(1))),name:h.name,selected:!1,children:[]};for(const A in g.attributes)M.form.contains(A)&&M.form.controls[A].setValue(g.attributes[A],{emitEvent:!1});return g.children.length>0&&g.children.forEach(A=>{let X=l(A);X&&M.children.push(X)}),M};r.forEach(g=>{this.blockWidgets[g.name]=[],g.widgets.length>0&&g.widgets.forEach(h=>{let F=l(h);F&&this.blockWidgets[g.name].push(F)})})})}ngAfterViewInit(){(0,k.H)(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(n=>{"compacted"==n?(this.leftSidebarCollapse=!1,this.leftSidebarCompact=!0):"collapsed"==n?(this.leftSidebarCompact=!1,this.leftSidebarCollapse=!0):this.sidebar.compact("menu-sidebar")})}),this.widgetItems.changes.subscribe(e=>{this.selectorWidget(e.last)})}toggleWidgetSidebar(e){this.hasHiddenWidgetSidebar=!this.hasHiddenWidgetSidebar,this.hasHiddenWidgetSidebar||this.rollbackFilterWidgetCategories(),this.hasHiddenWidgetSidebar||(this.hasHiddenSettingSidebar=!0)}toggleSettingSidebar(e){this.hasHiddenSettingSidebar=!this.hasHiddenSettingSidebar,this.hasHiddenSettingSidebar||(this.hasHiddenWidgetSidebar=!0)}search(e){let n=e?e.target.value:"";if(""==n)return void(this.filterWidgetCategories=(0,f.of)(this.widgetCategories));let i=this.widgets.filter(r=>r.label.includes(n)||r.keywords.flat().includes(n));this.filterWidgetCategories=(0,f.of)([{slug:"",label:"",icon:"",widgets:i}])}quickToggle(e,n){e.isShown?(this.selectBlockIndex=n,this.hasHiddenWidgetSidebar||this.toggleWidgetSidebar(null)):this.rollbackFilterWidgetCategories()}selectorBlock(e){this.selectBlockIndex=e,void 0!==this.lastedWidget&&(this.lastedWidget.product.selected=!1),this.lastedWidget=void 0}selectorWidget(e){this.lastedWidget&&this.lastedWidget.Id==e.Id||(void 0!==this.lastedWidget&&(this.lastedWidget.product.selected=!1),e.product.selected=!0,this.lastedWidget=e)}selectedWidgetComponent(e,n){for(let i of n){if(null!=this.lastedWidget&&this.lastedWidget.Id==e)break;if(i.Id==e){null!=this.lastedWidget&&(this.lastedWidget.product.selected=!1),i.product.selected=!0,this.lastedWidget=i;break}null!=i.groupComponent&&this.selectedWidgetComponent(e,i.groupComponent.widgetItems)}for(let i of this.widgetItems)if(e==i.Id){if(this.lastedWidget&&this.lastedWidget.Id==e)break;void 0!==this.lastedWidget&&(this.lastedWidget.product.selected=!1),i.product.selected=!0,this.lastedWidget=i;break}}unselectWidget(e){}insertWidget(e,n=!1,i=0){let r=this.widgets.filter(l=>l.name===e).pop();if(this.selectBlockIndex>-1&&r){let l=r.sections.map(F=>F.controls);const g=this.blocks[this.selectBlockIndex].name,h={id:this.generateUUID(),widget:Object.assign({},r),form:new C.cw((0,L.T)(l.flat(1))),selected:!0,name:r.name,children:[]};this.lastedWidget?this.lastedWidget.isGroup()?this.lastedWidget.addChildren(h):this.lastedWidget.pre&&this.lastedWidget.pre.isGroup()&&this.lastedWidget.pre.addChildren(h):this.blockWidgets[g].push(h),n||(this.historyWidgets.unshift(r),this.historyWidgets.length>6&&this.historyWidgets.pop())}}getBlockWidgetsForIndex(){return this.getBlockWidgets(this.blocks[this.selectBlockIndex].name)}getBlockWidgets(e){return this.blockWidgets[e]??[]}save(e){const n={blocks:{},widgets:{}};let i=1,r=l=>{if(l.length<1)return[];let g=[];return l.forEach(h=>{g.push({id:h.id,name:h.widget.name,attributes:h.form.getRawValue(),children:r(h.children)})}),g};Object.keys(this.blockWidgets).forEach(l=>{n.blocks[l]=[],this.blockWidgets[l].forEach(g=>{const h="widget-"+g.widget.name+"-"+i;n.blocks[l].push(h),n.widgets[h]={id:g.id,name:g.widget.name,attributes:g.form.getRawValue(),children:r(g.children)},i++})}),this.http.post("/widget/saved",n).subscribe({})}rollbackFilterWidgetCategories(){this.filterWidgetCategories.subscribe(e=>{e.length!=this.widgetCategories.length&&(this.filterWidgetCategories=(0,f.of)(this.widgetCategories))})}generateUUID(){let e=(new Date).getTime();return typeof performance<"u"&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?i:3&i|8).toString(16)})}selected(e){e.selected||this.selectedWidgetComponent(e.id,this.widgetItems)}onNext(e){const n=i=>{for(let r=0;r<i.length;r++){if(i[r].id==e.id){const l=i[r+1]||null;l&&(i[r+1]=i[r],i[r]=l);break}i[r].children.length>0&&n(i[r].children)}};n(this.getBlockWidgetsForIndex())}onPrevious(e){const n=i=>{for(let r=0;r<i.length;r++){if(i[r].id==e.id){const l=i[r-1]||null;l&&(i[r-1]=i[r],i[r]=l);break}i[r].children.length>0&&n(i[r].children)}};n(this.getBlockWidgetsForIndex())}onRemove(e){const n=i=>{for(let r=0;r<i.length;r++){if(i[r].id==e.id){i.splice(r,1);break}i[r].children.length>0&&n(i[r].children)}};n(this.getBlockWidgetsForIndex())}pack(e){return $(e)}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(d.lzT),t.Y36(a.K0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-widget"]],viewQuery:function(e,n){if(1&e&&(t.Gf(yt,5,t.SBq),t.Gf(Nt,5,t.Rgc),t.Gf(R,5)),2&e){let i;t.iGM(i=t.CRH())&&(n.widgetSidebarBtnRef=i.first),t.iGM(i=t.CRH())&&(n.quickInsertWidgetDialog=i.first),t.iGM(i=t.CRH())&&(n.widgetItems=i)}},decls:53,vars:16,consts:[[1,"component-skeleton"],[1,"component-skeleton-body"],[1,"mb-0","position-relative"],[1,"d-flex","border-0","justify-content-between","align-items-center"],["nbButton","","id","widgetSidebarBtn",3,"status","click"],["widgetSidebarBtn",""],["icon","plus-outline"],[1,"d-flex","justify-content-end"],["nbButton","","status","success",3,"click"],[1,"mx-2"],["nbButton","","status","primary","type","button","id","settingSidebarBtn",3,"click"],["icon","settings-2"],[1,"d-flex","flex-grow-1","overflow-auto",2,"overscroll-behavior-y","none"],[1,"col-12","col-xl-4","p-0","position-relative",3,"hidden"],[1,"d-flex","flex-column","h-100"],[1,"h-100"],[1,"position-relative","overflow-hidden","h-100"],[1,"h-100","mb-0","border-0","rounded-0","position-relative"],["nbInput","","fullWidth","",3,"keyup"],["nbSuffix","","icon","search-outline"],[1,"d-flex","flex-column","flex-grow-1"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-column","flex-grow-1","overflow-hidden","mx-auto"],[1,"block-list","h-100","position-relative"],[1,"p-0","rounded-0","border-0","bg-transparent","h-100"],[1,"row"],[1,"col-12","col-lg-10","col-xl-8","mx-auto"],["tabindex","0","class","mt-5",3,"focus",4,"ngFor","ngForOf"],["tabindex","0",1,"col-12","col-xl-3","p-0","position-relative","sidebar-setting",3,"hidden","blur"],[1,"position-relative","h-100"],[1,"h-100","mb-0","border-0","rounded-0"],[1,"p-0","h-100","overflow-hidden"],["class","p-0 h-100",3,"tabTitle",4,"ngIf"],["tabTitle","\u6302\u4ef6",1,"p-0","h-100","overflow-hidden"],[1,"p-0","h-100","d-flex","border-0","flex-column"],["class","d-flex",4,"ngIf"],[1,"d-flex","p-0","flex-column","h-100","flex-grow-1"],["multi","",4,"ngIf"],["rightSidebarWidgets",""],["quickInsertWidgetDialog",""],["itemMore",""],["class","sidebar-category",4,"ngIf"],[1,"sidebar-category"],["class","label col-form-label py-4",4,"ngIf"],[1,"d-flex","flex-row","flex-wrap"],["class","sidebar-widget-item",3,"click",4,"ngFor","ngForOf"],[1,"label","col-form-label","py-4"],[1,"sidebar-widget-item",3,"click"],[3,"pack","icon"],[1,"py-4"],["tabindex","0",1,"mt-5",3,"focus"],["tabindex","0",3,"focus"],["tabindex","0",3,"selected","id","product","blockIndex","index","focus","blur",4,"ngFor","ngForOf"],["nbButton","","fullWidth","","status","basic","nbPopoverTrigger","click",3,"nbPopover","nbPopoverShowStateChange"],["tabindex","0",3,"id","product","blockIndex","index","focus","blur"],["widgetItemComponent",""],[1,"p-0","h-100",3,"tabTitle"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"d-flex"],[1,"d-flex","flex-column","ps-3"],[1,"label"],["multi",""],["tabindex","0",1,"control-container",3,"form","controls"],[1,"p-0","sidebar-setting-widgets-list","w-100"],["class","d-flex flex-column align-items-start","tabindex","0",3,"selected",4,"ngFor","ngForOf"],["tabindex","0",1,"d-flex","flex-column","align-items-start"],["routerLink","./",1,"d-flex","w-100","justify-content-between","text-decoration-none","flex-grow-1",3,"fragment","click"],[1,"d-flex","align-items-center"],[1,"ms-2"],["nbButton","","outline","","nbPopoverPlacement","bottom",1,"more",3,"nbPopover","nbPopoverContext"],["icon","more-vertical-outline"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[1,"border-0","mb-0",2,"width","22rem"],[1,"border-0"],[1,"p-0"],["status","primary","outline","","fullWidth","","nbButton","",1,"rounded-0",3,"click"],["role","button",1,"d-block","text-basic","text-decoration-none","w-100",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card",2)(3,"nb-card-header",3)(4,"button",4,5),t.NdJ("click",function(r){return n.toggleWidgetSidebar(r)}),t._UZ(6,"nb-icon",6),t.qZA(),t.TgZ(7,"div",7)(8,"button",8),t.NdJ("click",function(r){return n.save(r)}),t._uU(9,"\u66f4\u65b0"),t.qZA(),t._UZ(10,"div",9),t.TgZ(11,"button",10),t.NdJ("click",function(r){return n.toggleSettingSidebar(r)}),t._UZ(12,"nb-icon",11),t.qZA()()()(),t.TgZ(13,"div",12)(14,"div",13)(15,"div",14)(16,"div",15)(17,"div",16)(18,"nb-card",17)(19,"nb-card-header")(20,"nb-form-field")(21,"input",18),t.NdJ("keyup",function(r){return n.search(r)}),t.qZA(),t._UZ(22,"nb-icon",19),t.qZA()(),t.TgZ(23,"nb-card-body",20),t.YNc(24,Ft,2,1,"ng-container",21),t.ALo(25,"async"),t.qZA()()()()()(),t.TgZ(26,"div",22)(27,"div",14)(28,"div",23)(29,"nb-card",24)(30,"nb-card-body")(31,"div",25)(32,"div",26),t.YNc(33,Dt,8,3,"nb-accordion",27),t.qZA()()()()()()(),t.TgZ(34,"div",28),t.NdJ("blur",function(r){return n.unselectWidget(r)}),t.TgZ(35,"div",14)(36,"div",15)(37,"div",29)(38,"nb-card",30)(39,"nb-card-body",31)(40,"nb-tabset",15),t.YNc(41,Et,2,5,"nb-tab",32),t.TgZ(42,"nb-tab",33)(43,"nb-card",34),t.YNc(44,Jt,7,4,"nb-card-header",35),t.TgZ(45,"nb-card-body",36),t.YNc(46,Bt,2,1,"nb-accordion",37),t.qZA()()()()()()()()()()()()(),t.YNc(47,Qt,2,1,"ng-template",null,38,t.W1O)(49,Lt,11,1,"ng-template",null,39,t.W1O)(51,Ht,12,0,"ng-template",null,40,t.W1O)),2&e&&(t.ekj("sidebar-compact",n.leftSidebarCompact)("sidebar-collapse",n.leftSidebarCollapse),t.xp6(4),t.Q6J("status",n.hasHiddenWidgetSidebar?"primary":"control"),t.xp6(2),t.ekj("sidebar-widget-toggle-animation",!n.hasHiddenWidgetSidebar),t.xp6(8),t.Q6J("hidden",n.hasHiddenWidgetSidebar),t.xp6(10),t.Q6J("ngForOf",t.lcZ(25,14,n.filterWidgetCategories)),t.xp6(9),t.Q6J("ngForOf",n.blocks),t.xp6(),t.Q6J("hidden",n.hasHiddenSettingSidebar),t.xp6(7),t.Q6J("ngIf",n.blocks.length>0),t.xp6(3),t.Q6J("ngIf",n.lastedWidget&&n.lastedWidget.product.selected),t.xp6(2),t.Q6J("ngIf",n.lastedWidget&&n.lastedWidget.product.selected))},dependencies:()=>[a.sg,a.O5,a.tP,d.Asz,d.yKW,d.XWE,d.ndF,d.kyn,d.TR4,d.ydg,d.DPz,d.h8i,d.qCO,d.SaG,d.YZd,d.AvE,d.fMN,d.jBG,d.yyc,d.zP_,d.qBV,J.rH,K._,V,a.Ov],styles:['.sidebar-widget-item[_ngcontent-%COMP%]{width:33.3%;color:var(--text-basic-color);display:flex;flex-direction:column;align-items:center;cursor:pointer}.sidebar-widget-item[_ngcontent-%COMP%]:focus   span[_ngcontent-%COMP%], .sidebar-widget-item[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{color:var(--text-hint-color);font-weight:700}[_nghost-%COMP%]{min-height:calc(100vh - var(--header-height) - 60px);overflow:hidden;position:absolute;inset:0}[_nghost-%COMP%]     nb-layout nb-layout-column{padding:0!important}[_nghost-%COMP%]     nb-accordion:focus:after, [_nghost-%COMP%]     widget-item:focus:after, [_nghost-%COMP%]     nb-accordion-item-header:focus:after, [_nghost-%COMP%]     widget-item.selected:after{content:"";position:absolute;z-index:1;pointer-events:none;inset:1px;box-shadow:0 0 0 1.5px var(--color-success-focus);border-radius:var(--accordion-border-radius);outline:2px solid transparent}[_nghost-%COMP%]   .scrollable[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;flex:1}[_nghost-%COMP%]   .sidebar-expanded[_ngcontent-%COMP%]{left:var(--sidebar-width)!important}[_nghost-%COMP%]   .sidebar-compact[_ngcontent-%COMP%]{left:var(--sidebar-width-compact)!important}[_nghost-%COMP%]   .sidebar-collapse[_ngcontent-%COMP%]{left:0!important}[_nghost-%COMP%]   .component-skeleton[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:auto;max-height:100%;position:fixed;top:var(--header-height);right:0;bottom:0;left:var(--sidebar-width-compact)}[_nghost-%COMP%]   .component-skeleton-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden;flex:0 1 100%;padding-bottom:60px}[_nghost-%COMP%]   .sidebar-widget-toggle-animation[_ngcontent-%COMP%]{transition:transform .3s;transform:rotate(45deg)}[_nghost-%COMP%]   nb-tabset[_ngcontent-%COMP%]   nb-tab[_ngcontent-%COMP%]{padding-bottom:2.875rem!important}[_nghost-%COMP%]   nb-accordion[_ngcontent-%COMP%], [_nghost-%COMP%]   widget-item[_ngcontent-%COMP%]{position:relative}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--text-basic-color)}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{visibility:hidden;background-color:inherit;border:none}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--text-primary-color)}[_nghost-%COMP%]   nb-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover   more[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]   nb-list-item.selected[_ngcontent-%COMP%]{background-color:var(--background-basic-color-3)}[_nghost-%COMP%]   nb-list-item.selected[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{visibility:visible}']}),c})(),V=(()=>{var s;class c{get Id(){return this.product.id}constructor(e,n,i){this.http=e,this.ds=n,this.parent=i,this.blockIndex=0,this.index=0}pack(){return $(this.product.widget)}ngOnInit(){this.render(this.product.form.getRawValue()),this.subscribeChange=this.product.form.valueChanges.subscribe(e=>{this.render(e)})}addChildren(e){this.product.children.push(e)}render(e){e.name=this.product.widget.name,this.http.post("/widget/{name}/rendered",e).subscribe(n=>{n.output&&(this.container?this.container.nativeElement.innerHTML=n.output:this.groupComponent&&(this.groupComponent.groupRenderClassName=n.output))})}ngAfterViewInit(){}isMedia(){return["image","file","video","audio","cover","gallery"].includes(this.product.widget.name)}isGroup(){return"group"===this.product.name}ngOnDestroy(){this.subscribeChange&&this.subscribeChange.unsubscribe(),this.subscribeChange=void 0}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(S.H7),t.Y36(j))},s.\u0275cmp=t.Xpm({type:s,selectors:[["widget-item"]],viewQuery:function(e,n){if(1&e&&(t.Gf(Yt,5),t.Gf(Kt,5,t.SBq)),2&e){let i;t.iGM(i=t.CRH())&&(n.groupComponent=i.first),t.iGM(i=t.CRH())&&(n.container=i.first)}},hostVars:1,hostBindings:function(e,n){2&e&&t.uIk("id",n.Id)},inputs:{product:"product",blockIndex:"blockIndex",index:"index",pre:"pre"},decls:2,vars:2,consts:[["class","position-relative widget-container",4,"ngIf"],[3,"widgets","parent",4,"ngIf"],[1,"position-relative","widget-container"],["container",""],["style","width: 100px; height: 100px",3,"pack","icon",4,"ngIf"],[2,"width","100px","height","100px",3,"pack","icon"],[3,"widgets","parent"],["groupComponent",""]],template:function(e,n){1&e&&t.YNc(0,zt,4,4,"div",0)(1,$t,2,2,"widget-group",1),2&e&&(t.Q6J("ngIf","group"!==n.product.widget.name),t.xp6(),t.Q6J("ngIf","group"===n.product.widget.name))},dependencies:()=>[a.O5,d.fMN,Xt],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;margin:1.25rem 0}"]}),c})(),Xt=(()=>{var s;class c{constructor(e,n){this.http=e,this.ds=n,this.widgets=[],this.groupRenderClassName=""}ngOnInit(){}ngOnDestroy(){}ngAfterViewInit(){this.widgetItems.changes.subscribe(e=>{this.parent.parent.selectorWidget(e.last)})}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(S.H7))},s.\u0275cmp=t.Xpm({type:s,selectors:[["widget-group"]],viewQuery:function(e,n){if(1&e&&t.Gf(R,5),2&e){let i;t.iGM(i=t.CRH())&&(n.widgetItems=i)}},inputs:{widgets:"widgets",parent:"parent",groupRenderClassName:"groupRenderClassName"},decls:3,vars:3,consts:[[1,"op-widget-group",3,"className"],["tabindex","0",3,"selected","id","product","blockIndex","index","pre","focus","blur",4,"ngFor","ngForOf"],["class","d-flex flex-column py-5 px-3",4,"ngIf"],["tabindex","0",3,"id","product","blockIndex","index","pre","focus","blur"],["widgetItemComponent",""],[1,"d-flex","flex-column","py-5","px-3"],["nbButton","","fullWidth","","status","basic","nbPopoverTrigger","click",3,"nbPopover","nbPopoverShowStateChange"],["icon","plus-outline"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,jt,2,7,"widget-item",1),t.qZA(),t.YNc(2,Vt,3,1,"div",2)),2&e&&(t.Q6J("className",n.groupRenderClassName),t.xp6(),t.Q6J("ngForOf",n.widgets),t.xp6(),t.Q6J("ngIf",n.widgets.length<1))},dependencies:[a.sg,a.O5,d.ydg,d.DPz,d.fMN,V],encapsulation:2}),c})();var te=p(2890);function ee(s,c){if(1&s&&(t.TgZ(0,"a",18),t._uU(1),t.qZA()),2&s){const o=c.$implicit;t.Q6J("href",o.homepage?o.homepage:"#",t.LSH),t.xp6(),t.hij(" ",o.name," ")}}function ne(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(o);const n=t.oxw().$implicit,i=t.oxw();return t.KtG(i.upgrade(n.packageName))}),t._UZ(1,"nb-icon",20),t.qZA()}}function oe(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",10)(1,"nb-card")(2,"nb-card-header"),t._uU(3),t.qZA(),t.TgZ(4,"nb-card-body")(5,"div",11),t._uU(6),t.qZA(),t.TgZ(7,"div",12)(8,"span"),t._uU(9,"\u4f5c\u8005:"),t.qZA(),t.TgZ(10,"span"),t.YNc(11,ee,2,2,"a",13),t.qZA()(),t.TgZ(12,"div",12)(13,"span"),t._uU(14,"\u7248\u672c:"),t.qZA(),t.TgZ(15,"span"),t._uU(16),t.qZA()()(),t.TgZ(17,"nb-card-footer",14)(18,"button",15),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.delete(i.packageName))}),t._uU(19,"\u5220\u9664"),t.qZA(),t.TgZ(20,"div",5)(21,"button",16),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.activate(i.packageName))}),t._uU(22,"\u542f\u7528"),t.qZA(),t.YNc(23,ne,2,0,"button",17),t.qZA()()()()}if(2&s){const o=c.$implicit,e=t.oxw();t.xp6(3),t.Oqu(o.name),t.xp6(3),t.hij(" ",o.description," "),t.xp6(5),t.Q6J("ngForOf",o.authors),t.xp6(5),t.Oqu(o.version),t.xp6(2),t.Q6J("disabled",o.enabled||e.spinner)("nbSpinner",e.spinner),t.xp6(3),t.Q6J("nbSpinner",e.spinner)("disabled",e.spinner||o.enabled),t.xp6(2),t.Q6J("ngIf",o.upgradeable)}}function ie(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"nb-card")(1,"nb-card-header"),t._uU(2,"\u5728\u7ebf\u4e0b\u8f7d"),t.qZA(),t.TgZ(3,"nb-card-body"),t._UZ(4,"input",21,22),t.qZA(),t.TgZ(6,"nb-card-footer",14)(7,"button",23),t.NdJ("click",function(){const i=t.CHM(o).dialogRef;return t.KtG(i.close())}),t._uU(8,"\u53d6\u6d88"),t.qZA(),t.TgZ(9,"button",24),t.NdJ("click",function(){const i=t.CHM(o).dialogRef,r=t.MAs(5),l=t.oxw();return t.KtG(l.openDownload(r.value,i))}),t._uU(10,"\u4e0b\u8f7d"),t.qZA()()()}}const se=()=>["zip"];let re=(()=>{var s;class c{constructor(e,n,i,r,l,g){this.http=e,this.toast=n,this.route=i,this.sanitizer=r,this.dialog=l,this.sidebar=g,this.themes=[],this.title="",this.spinner=!1}onSpinner(e){this.spinner=e}ngOnInit(){this.getThemes(),this.route.data.subscribe(e=>{this.title=e.title})}getThemes(){this.http.get("/theme/installed").subscribe(e=>{e.records.length>0&&(this.themes=e.records)})}activate(e){this.http.post("/theme/{name}/activate",{name:e},{context:(new b.qT).set(D.a,this)}).subscribe(n=>{this.getThemes()})}upgrade(e){this.http.post("/theme/{name}/upgrade",{name:e},{context:(new b.qT).set(D.a,this)}).subscribe(n=>{this.getThemes()})}upload(e){e.length<1?this.toast.danger("\u4e0a\u4f20\u7684\u4e3b\u9898\u6587\u4ef6\u4e3a\u7a7a","\u4e0a\u4f20\u4e3b\u9898"):this.http.post(H,{uri:e.pop()}).subscribe(n=>{this.getThemes()})}openDownload(e,n){/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(e)?this.http.post(H,{uri:e}).subscribe(r=>{n.close()}):this.toast.danger("\u4e0d\u5408\u6cd5\u7684url\u94fe\u63a5","\u4e0a\u4f20\u4e3b\u9898")}delete(e){this.http.post("/theme/{name}/delete",{name:e},{context:(new b.qT).set(D.a,this)}).subscribe(n=>{this.getThemes()})}ngAfterViewInit(){(0,k.H)(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(n=>{"compacted"!==n&&this.sidebar.compact("menu-sidebar")})})}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(d.quB),t.Y36(J.gz),t.Y36(S.H7),t.Y36(d.Gln),t.Y36(d.lzT))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-theme"]],decls:16,vars:4,consts:[[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center"],["nbButton","","status","success","routerLink","/app/decoration/theme/market",1,"ms-2"],[1,"d-flex"],["nbButton","","status","danger",1,"mx-2",3,"click"],[3,"suffix","status","finish"],["class","col-12 col-md-6 col-lg-4 col-xxl-3",4,"ngFor","ngForOf"],["dialogTpl",""],[1,"col-12","col-md-6","col-lg-4","col-xxl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["nbButton","","status","danger",3,"disabled","nbSpinner","click"],["nbButton","","status","primary",3,"nbSpinner","disabled","click"],["class","ms-2","nbButton","","status","control",3,"click",4,"ngIf"],["target","_blank",1,"d-inline-block","mr-1",3,"href"],["nbButton","","status","control",1,"ms-2",3,"click"],["icon","sync-outline"],["nbInput","","name","url","type","url","placeholder","\u4e0b\u8f7d\u5730\u5740"],["url",""],["nbButton","","status","basic",3,"click"],["nbButton","","status","primary",3,"click"]],template:function(e,n){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header",2)(4,"div",3)(5,"span"),t._uU(6,"\u4e3b\u9898\u5217\u8868"),t.qZA(),t.TgZ(7,"a",4),t._uU(8,"\u4e3b\u9898\u5e02\u573a"),t.qZA()(),t.TgZ(9,"div",5)(10,"button",6),t.NdJ("click",function(){t.CHM(i);const l=t.MAs(15);return t.KtG(n.dialog.open(l))}),t._uU(11,"\u5728\u7ebf\u4e0b\u8f7d"),t.qZA(),t.TgZ(12,"app-upload",7),t.NdJ("finish",function(l){return n.upload(l)}),t.qZA()()()()(),t.YNc(13,oe,24,9,"div",8),t.qZA(),t.YNc(14,ie,11,0,"ng-template",null,9,t.W1O)}2&e&&(t.xp6(12),t.Q6J("suffix",t.DdM(3,se))("status","primary"),t.xp6(),t.Q6J("ngForOf",n.themes))},dependencies:[a.sg,a.O5,d.Asz,d.yKW,d.XWE,d.ndF,d.DPz,d.h8i,d.Q7R,d.fMN,J.rH,te.o],encapsulation:2}),c})();var ae=p(2953),ce=p(3507);function de(s,c){if(1&s&&(t.TgZ(0,"nb-tab",3)(1,"div",4),t._UZ(2,"control-container",5),t.qZA()()),2&s){const o=c.$implicit,e=c.index,n=t.oxw();t.Q6J("tabId",o.id)("lazyLoad",!1)("active",0==e)("tabTitle",o.label)("tabIndex",e),t.xp6(2),t.Q6J("controls",o.controls)("form",n.formGroup)}}let le=(()=>{var s;class c{constructor(e,n){this.http=e,this.sidebar=n,this.sections=[],this.spinner=!1,this.theme={},this.data={},this.values={},this.isChanged=!1}ngAfterViewInit(){(0,k.H)(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(n=>{"expanded"===n&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.http.get("/theme/customize").subscribe(e=>{const n=[];e.sections.forEach(i=>{n.push(...i.controls)}),this.formGroup=new C.cw((0,L.T)(n));for(let i in this.formGroup.controls)this.values[i]=this.formGroup.controls[i].value;this.formGroup.valueChanges.subscribe(i=>{let r=!1;for(let l in i)i[l]!=this.values[l]?(this.data[l]=i[l]||null,r=!0):this.data.hasOwnProperty(l)&&delete this.data[l];this.isChanged=r}),this.sections=e.sections,this.theme=e.theme})}save(e){this.isChanged&&this.http.post("/theme/customized",{customized:this.data},{context:(new b.qT).set(D.a,this)}).subscribe(()=>{this.isChanged=!1;for(const n in this.data)this.values[n]=this.data[n]})}onSpinner(e){this.spinner=e}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(d.lzT))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-theme-custom"]],decls:10,vars:3,consts:[[1,"d-flex","justify-content-between"],["size","small","status","success","nbButton","",3,"disabled","click"],["class","px-0",3,"tabId","lazyLoad","active","tabTitle","tabIndex",4,"ngFor","ngForOf"],[1,"px-0",3,"tabId","lazyLoad","active","tabTitle","tabIndex"],[1,"col-12","col-xl-6","mx-auto"],[3,"controls","form"]],template:function(e,n){1&e&&(t.TgZ(0,"nb-card")(1,"nb-card-header")(2,"div",0)(3,"span"),t._uU(4),t.qZA(),t.TgZ(5,"button",1),t.NdJ("click",function(r){return n.save(r)}),t._uU(6,"\u4fdd\u5b58\u53d1\u5e03"),t.qZA()()(),t.TgZ(7,"nb-card-body")(8,"nb-tabset"),t.YNc(9,de,3,7,"nb-tab",2),t.qZA()()()),2&e&&(t.xp6(4),t.hij(" \u4f60\u6b63\u5728\u81ea\u4e49 ",n.theme.stylesheet," "),t.xp6(),t.Q6J("disabled",n.spinner||!n.isChanged),t.xp6(4),t.Q6J("ngForOf",n.sections))},dependencies:[a.sg,d.Asz,d.yKW,d.ndF,d.kyn,d.TR4,d.DPz,K._],encapsulation:2}),c})();var ue=p(3235);function pe(s,c){if(1&s&&(t.TgZ(0,"a",9),t._uU(1),t.qZA()),2&s){const o=c.$implicit;t.Q6J("href",o.homepage?o.homepage:"#",t.LSH),t.xp6(),t.hij(" ",o.name," ")}}function ge(s,c){if(1&s){const o=t.EpF();t.TgZ(0,"div",3)(1,"nb-card")(2,"nb-card-header"),t._uU(3),t.qZA(),t.TgZ(4,"nb-card-body")(5,"div",4),t._uU(6),t.qZA(),t.TgZ(7,"div",5)(8,"span"),t._uU(9,"\u4f5c\u8005:"),t.qZA(),t.TgZ(10,"span"),t.YNc(11,pe,2,2,"a",6),t.qZA()(),t.TgZ(12,"div",5)(13,"span"),t._uU(14,"\u7248\u672c:"),t.qZA(),t.TgZ(15,"span"),t._uU(16),t.qZA()()(),t.TgZ(17,"nb-card-footer",7)(18,"button",8),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.setup(i.packageName))}),t._uU(19),t.qZA()()()()}if(2&s){const o=c.$implicit,e=t.oxw();t.xp6(3),t.Oqu(o.name),t.xp6(3),t.hij(" ",o.description," "),t.xp6(5),t.Q6J("ngForOf",o.authors),t.xp6(5),t.Oqu(o.version),t.xp6(2),t.Q6J("disabled",o.installed||e.spinner)("nbSpinner",e.spinner),t.xp6(),t.Oqu(o.installed?"\u5df2\u5b89\u88c5":"\u5b89\u88c5")}}const me=[{path:"navigation",title:"\u5bfc\u822a",component:wt},{path:"widget",title:"\u6302\u4ef6",component:j},{path:"theme",title:"\u4e3b\u9898",component:re},{path:"theme/market",title:"\u4e3b\u9898\u5e02\u573a",component:(()=>{var s;class c{constructor(e,n,i,r,l){this.http=e,this.toast=n,this.route=i,this.sanitizer=r,this.sidebar=l,this.themes=[],this.title="",this.spinner=!1}onSpinner(e){this.spinner=e}ngAfterViewInit(){(0,k.H)(0).subscribe(e=>{this.sidebar.getSidebarState("menu-sidebar").subscribe(n=>{"compacted"!==n&&this.sidebar.compact("menu-sidebar")})})}ngOnInit(){this.getThemes(),this.route.data.subscribe(e=>{this.title=e.title})}getThemes(){this.http.get("/theme/market").subscribe(e=>{e.records.length>0&&(this.themes=e.records)})}setup(e){this.http.post("/theme/{name}/setup",{name:e},{context:(new b.qT).set(D.a,this)}).subscribe(n=>{this.getThemes()})}}return(s=c).\u0275fac=function(e){return new(e||s)(t.Y36(b.eN),t.Y36(d.quB),t.Y36(J.gz),t.Y36(S.H7),t.Y36(d.lzT))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-theme-market"]],decls:6,vars:1,consts:[[1,"row"],[1,"col-12"],["class","col-12 col-md-6 col-lg-4 col-xl-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4","col-xl-3"],[1,"description"],[1,"d-flex","py-3","justify-content-between"],["class","d-inline-block mr-1","target","_blank",3,"href",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","status","primary",3,"disabled","nbSpinner","click"],["target","_blank",1,"d-inline-block","mr-1",3,"href"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header"),t._uU(4," \u4e3b\u9898\u5e02\u573a "),t.qZA()()(),t.YNc(5,ge,20,7,"div",2),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngForOf",n.themes))},dependencies:[a.sg,d.Asz,d.yKW,d.XWE,d.ndF,d.DPz,d.Q7R],encapsulation:2}),c})()},{path:"custom",title:"\u81ea\u5b9a\u4e49",component:le}];let _e=(()=>{var s;class c{}return(s=c).\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[a.ez,ae.O,J.Bz.forChild(me),G._t,ce.c,ue.s,d.HKp]}),c})()},2890:(P,I,p)=>{p.d(I,{o:()=>q});var a=p(4966),b=p(319),k=p(5403),f=p(2526),y=p(6733);const T=["file"];function N(_,Z){if(1&_&&(a.TgZ(0,"nb-progress-bar",18),a.ALo(1,"async"),a._uU(2),a.qZA()),2&_){const x=a.oxw().$implicit,u=a.oxw();a.Q6J("status",u.messages[x.name]?"danger":"success")("displayValue",!u.messages[x.name])("value",a.lcZ(1,4,u.progress[x.name].progress)),a.xp6(2),a.hij(" ",u.messages[x.name]," ")}}function W(_,Z){if(1&_){const x=a.EpF();a.TgZ(0,"div",13)(1,"nb-icon",19),a.NdJ("click",function(){a.CHM(x);const m=a.oxw().$implicit,v=a.oxw();return a.KtG(v.remove(m))}),a.qZA()()}}function w(_,Z){if(1&_&&(a.TgZ(0,"nb-list-item")(1,"div",12)(2,"div",13),a._UZ(3,"nb-icon",14),a.qZA(),a.TgZ(4,"div",15),a._uU(5),a.qZA(),a.TgZ(6,"div",15),a.YNc(7,N,3,6,"nb-progress-bar",16),a.qZA(),a.YNc(8,W,2,0,"div",17),a.qZA()()),2&_){const x=Z.$implicit,u=a.oxw();a.xp6(5),a.hij(" ",x.name," "),a.xp6(2),a.Q6J("ngIf",u.progress),a.xp6(),a.Q6J("ngIf",!u.uploading&&!u.uploadSuccessful)}}function C(_,Z){if(1&_&&(a.TgZ(0,"div",20),a._uU(1),a.qZA()),2&_){const x=a.oxw();a.xp6(),a.hij(" ",x.errorMessage," ")}}function O(_,Z){if(1&_){const x=a.EpF();a.TgZ(0,"button",21),a.NdJ("click",function(){a.CHM(x);const m=a.oxw();return a.KtG(m.dialogRef.close())}),a._uU(1,"\u53d6\u6d88"),a.qZA()}}let E=(()=>{var _;class Z{constructor(u,m){this.dialogRef=u,this.uploadService=m,this.files=new Set,this.multiple=!1,this.suffix=[],this.canBeClosed=!0,this.primaryButtonText="\u4e0a\u4f20",this.showCancelButton=!0,this.uploading=!1,this.uploadSuccessful=!1,this.messages={},this.errorMessage="",this.results=[]}ngOnInit(){}onFilesAdded(){const u=this.file?.nativeElement.files;let m="";for(const v in u){if(isNaN(parseInt(v,10)))continue;let B=u[v];console.log(B);let U=B.name.split(".");this.suffix.length>0&&!this.suffix.includes(U[U.length-1].toLowerCase())?m="\u6b64\u6587\u4ef6\u7c7b\u578b\u4e0d\u652f\u6301\uff0c\u53ea\u652f\u6301: "+this.suffix.join(",")+"\u6587\u4ef6\u683c\u5f0f":this.files.add(B)}this.errorMessage=m}addFiles(){this.file?.nativeElement.click()}closeDialog(){if(this.uploadSuccessful)return this.finish?.emit(this.results),this.dialogRef.close();if(this.files.size<1)return void(this.errorMessage="\u9009\u62e9\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6!");this.uploading=!0,this.progress=this.uploadService.upload(this.files);for(const m in this.progress)this.progress[m].progress.subscribe(v=>console.log(v)),this.progress[m].response.subscribe(v=>{v.hasOwnProperty("statusText")?this.messages[m]=v.statusText:v.hasOwnProperty("status")&&"ok"!=v.status?this.messages[m]=v.message:this.results.push(v.filename)});const u=[];for(const m in this.progress)u.push(this.progress[m].progress);this.primaryButtonText="\u5b8c\u6210",this.canBeClosed=!1,this.showCancelButton=!1,(0,b.D)(u).subscribe(m=>{this.canBeClosed=!0,this.uploadSuccessful=!0,this.uploading=!1})}remove(u){this.files.delete(u)}}return(_=Z).\u0275fac=function(u){return new(u||_)(a.Y36(f.X4l),a.Y36(k.C))},_.\u0275cmp=a.Xpm({type:_,selectors:[["app-dialog"]],viewQuery:function(u,m){if(1&u&&a.Gf(T,5),2&u){let v;a.iGM(v=a.CRH())&&(m.file=v.first)}},inputs:{multiple:"multiple",suffix:"suffix"},outputs:{finish:"finish"},features:[a._Bn([k.C])],decls:20,vars:7,consts:[[1,"row"],[1,"col-12"],["type","file",2,"display","none",3,"multiple","change"],["file",""],[1,"list-card"],[1,"d-flex","justify-content-between","align-items-center"],["nbButton","","status","primary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"actions"],["class","col-12 text-danger py-2",4,"ngIf"],[1,"col-12","d-flex","justify-content-between"],["nbButton","","status","control","class","mr-2",3,"click",4,"ngIf"],[1,"row","flex-grow-1","flex-nowrap"],[1,"col-1"],["status","primary","icon","file"],[1,"col-5"],[3,"status","displayValue","value",4,"ngIf"],["class","col-1",4,"ngIf"],[3,"status","displayValue","value"],["icon","close","status","danger",2,"cursor","pointer",3,"click"],[1,"col-12","text-danger","py-2"],["nbButton","","status","control",1,"mr-2",3,"click"]],template:function(u,m){1&u&&(a.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),a.NdJ("change",function(){return m.onFilesAdded()}),a.qZA(),a.TgZ(4,"nb-card",4)(5,"nb-card-header",5)(6,"span"),a._uU(7,"\u4e0a\u4f20\u6587\u4ef6"),a.qZA(),a.TgZ(8,"button",6),a.NdJ("click",function(){return m.addFiles()}),a._uU(9,"\u6dfb\u52a0\u6587\u4ef6"),a.qZA()(),a.TgZ(10,"nb-card-body")(11,"nb-list"),a.YNc(12,w,9,3,"nb-list-item",7),a.qZA()(),a.TgZ(13,"nb-card-footer",8)(14,"div",0),a.YNc(15,C,2,1,"div",9),a.TgZ(16,"div",10),a.YNc(17,O,2,0,"button",11),a.TgZ(18,"button",6),a.NdJ("click",function(){return m.closeDialog()}),a._uU(19),a.qZA()()()()()()()),2&u&&(a.xp6(2),a.Q6J("multiple",m.multiple),a.xp6(6),a.Q6J("disabled",m.uploading||m.uploadSuccessful),a.xp6(4),a.Q6J("ngForOf",m.files),a.xp6(3),a.Q6J("ngIf",m.errorMessage.length>0),a.xp6(2),a.Q6J("ngIf",m.showCancelButton),a.xp6(),a.Q6J("disabled",!m.canBeClosed||m.files.size<1),a.xp6(),a.Oqu(m.primaryButtonText))},dependencies:[y.sg,y.O5,f.DPz,f.bSZ,f.zP_,f.qBV,f.Asz,f.yKW,f.XWE,f.ndF,f.fMN,y.Ov],styles:["nb-card[_ngcontent-%COMP%]{min-width:290px}.list-card[_ngcontent-%COMP%]   nb-card-header[_ngcontent-%COMP%]{border-bottom:none}.list-card[_ngcontent-%COMP%]   nb-card-footer[_ngcontent-%COMP%]{border-top:none}.list-card[_ngcontent-%COMP%]   nb-card-body[_ngcontent-%COMP%]{padding:0}"]}),Z})(),q=(()=>{var _;class Z{constructor(u){this.dialog=u,this.multiple=!1,this.text="\u4e0a\u4f20",this.status="primary",this.suffix=[],this.finish=new a.vpe}openUploadDialog(){const u=this.dialog.open(E,{closeOnBackdropClick:!1,closeOnEsc:!1});u.componentRef.instance.multiple=this.multiple,u.componentRef.instance.finish=this.finish,u.componentRef.instance.suffix=this.suffix}}return(_=Z).\u0275fac=function(u){return new(u||_)(a.Y36(f.Gln))},_.\u0275cmp=a.Xpm({type:_,selectors:[["app-upload"]],inputs:{multiple:"multiple",text:"text",status:"status",suffix:"suffix"},outputs:{finish:"finish"},decls:2,vars:2,consts:[["type","button","nbButton","",3,"status","click"]],template:function(u,m){1&u&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return m.openUploadDialog()}),a._uU(1),a.qZA()),2&u&&(a.Q6J("status",m.status),a.xp6(),a.Oqu(m.text))},dependencies:[f.DPz],styles:["[_nghost-%COMP%]{display:block}"]}),Z})()},3507:(P,I,p)=>{p.d(I,{c:()=>y});var a=p(6733),b=p(2526),k=p(5403),f=p(4966);let y=(()=>{var T;class N{}return(T=N).\u0275fac=function(w){return new(w||T)},T.\u0275mod=f.oAB({type:T}),T.\u0275inj=f.cJS({providers:[k.C],imports:[a.ez,b.T2N,b.DfH,b.COg,b.zyh,b.KdK]}),N})()}}]);