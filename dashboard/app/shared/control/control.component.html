<div class="mb-3" [class]="direction !== 'column' ? 'row' : ''" [formGroup]="form!">
  <label class="label col-form-label" [class]="direction !== 'column' ? 'col-12 col-md-2' : ''" for="{{control.id}}">
    {{ control.label}}
  </label>
  <div [class]="direction !== 'column' ? 'col-12 col-md-10' : ''" class="d-flex flex-column">
    <ng-container [ngSwitch]="control.type">
      <input *ngSwitchCase="'input'"
         [id]="control.id"
         status="primary"
         nbInput fullWidth
         [placeholder]="control.placeholder!"
         [status]="status"
         (ngModelChange)="writeValue($event)"
         [type]="control.inputType!"
         [formControlName]="control.id"/>

      <textarea *ngSwitchCase="'textarea'"
        nbInput fullWidth [rows]="control.settings!['rows']??2"
        status="primary"
        [id]="control.id"
        [placeholder]="control.placeholder!"
        [status]="status"
        (ngModelChange)="writeValue($event)"
        [formControlName]="control.id"></textarea>

      <div class="d-flex flex-column" *ngSwitchCase="control.type == 'file' || control.type == 'video' || control.type == 'audio' || control.type == 'image' ? control.type : ''">
        <div class="flex-column d-flex align-items-center">
          <span *ngIf="control.type != 'image' && !control.multiple && control.attachment" class="d-inline text-break">
            {{ control.attachment.url }}
          </span>
          <div *ngIf="control.type == 'image' && !control.multiple && control.attachment"
               [style.width]="control.settings?.cropped ? control.settings?.cropped.width + 'px' : null"
               [style.height.px]="control.settings?.cropped ? control.settings?.cropped.height + 'px' : null">
            <img alt="{{control.label}}" width="100%" src="{{ control.attachment.url }}"/>
          </div>
          <ng-container *ngIf="control.type != 'image' && control.multiple && control.attachment && control.attachment.length > 0">
            <span class="d-inline my-1 text-break" *ngFor="let file of control.attachment">{{ file.url }}"</span>
          </ng-container>
          <ng-container *ngIf="control.type == 'image' && control.multiple && control.attachment && control.attachment.length > 0">
          <div class="my-1" *ngFor="let image of control.attachment; let i = index;" [style.width]="control.settings?.cropped ? control.settings?.cropped.width + 'px' : null" [style.height.px]="control.settings?.cropped ? control.settings?.cropped.height+ 'px' : null">
            <img alt="{{control.label + i}}" width="100%" src="{{ image.url }}"/>
          </div>
          </ng-container>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <ng-container *ngIf="(!control.multiple ? !!control.value : control.value.length > 0) && control.settings?.is_upload">
            <button nbButton type="button"  status="danger" (click)="removeMedia()">{{control.settings?.button_labels.remove}}</button>
            <button nbButton type="button"  status="warning" (click)="openMedia()">{{control.settings?.button_labels.change}}</button>
          </ng-container>
          <button *ngIf="(!control.multiple ? !!!control.value : control.value.length < 1) && control.settings?.is_upload" nbButton fullWidth type="button" status="primary" (click)="openMedia()">
            {{control.settings?.button_labels.select}}
          </button>
        </div>
      </div>

      <nb-select [id]="control.id"
         status="primary" fullWidth
         *ngSwitchCase="'select'"
         [placeholder]="control.placeholder!"
         [multiple]="control.multiple"
         [selected]="control.value"
         (selectedChange)="writeValue($event)"
         [formControlName]="control.id">
        <nb-option *ngFor="let option of control.options" [value]="option.value">{{option.label}}</nb-option>
      </nb-select>


      <nb-radio-group class="d-flex" *ngSwitchCase="'radio'" [formControlName]="control.id" [id]="control.id" status="primary">
        <nb-radio [value]="option.value" *ngFor="let option of control.options">{{option.label}}</nb-radio>
      </nb-radio-group>


      <nb-checkbox *ngSwitchCase="'checkbox'" [id]="control.id"
        status="primary"
        [checked]="!!control.value"
        (checkedChange)="writeValue($event)"
        [formControlName]="control.id"></nb-checkbox>

      <div *ngSwitchCase="'date'">
        <input nbInput fullWidth status="primary" [id]="control.id" id="{{ control.id }}"
           (ngModelChange)="writeValue($event)"
           [placeholder]="control.placeholder"
           [formControlName]="control.id"
           [nbDatepicker]="datePicker"/>
        <nb-datepicker [format]="control.format!" #datePicker></nb-datepicker>
      </div>

      <div *ngSwitchCase="'datetime'">
        <input nbInput fullWidth status="primary" [id]="control.id" id="{{ control.id }}"
               [placeholder]="control.placeholder"
               (ngModelChange)="writeValue($event)"
               [formControlName]="control.id"
               [nbDatepicker]="dateTimePicker"/>
        <nb-date-timepicker withSeconds [format]="control.format!" #dateTimePicker></nb-date-timepicker>
      </div>


      <div *ngSwitchCase="'range_date'">
        <input nbInput fullWidth status="primary" [id]="control.id"
         [placeholder]="control.placeholder"
         (ngModelChange)="writeValue($event)"
         [formControlName]="control.id"
         [nbDatepicker]="rangeDatePicker"
        />
        <nb-rangepicker [format]="control.format!" #rangeDatePicker></nb-rangepicker>
      </div>

      <div *ngSwitchCase="'autocomplete'">
        <input nbInput fullWidth status="primary" [id]="control.id"
         [placeholder]="control.placeholder"
         (ngModelChange)="writeValue($event)"
         [formControlName]="control.id"
         [nbAutocomplete]="autocomplete"
        />
        <nb-autocomplete #autocomplete></nb-autocomplete>
      </div>

      <div class="d-flex justify-content-between align-items-center" *ngSwitchCase="'color'">
        <input disabled nbInput [value]="control.value ? control.value : ''" />
        <ngx-colors (ngModelChange)="writeValue($event)" ngx-colors-trigger [formControlName]="control.id"></ngx-colors>
      </div>

      <div *ngSwitchCase="'custom'" [innerHTML]="dom.bypassSecurityTrustHtml(control.template!)"></div>

      <nb-toggle *ngSwitchCase="'switch'" [formControlName]="control.id" [id]="control.id" (ngModelChange)="writeValue($event)" status="primary"></nb-toggle>

      <group-control *ngSwitchCase="'group'" [element]="control" [formControlName]="control.id" (ngModelChange)="writeValue($event)"></group-control>

    </ng-container>
    <p class="caption col-form-label status-danger" *ngIf="invalid">{{error}}</p>
    <p class="label col-form-label" *ngIf="control.description && control.description.length > 0" [innerHTML]="dom.bypassSecurityTrustHtml(control.description)"></p>
  </div>
</div>
